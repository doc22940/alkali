!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.alkali=t():e.alkali=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,i;r=[n(1),n(2),n(5),n(4),n(6),n(7)],i=function(e,t,n,r,i,o){var a=Object.create(e);return a.Copy=o,a.Element=e,a.Variable=t,a.VMap=t.VMap,a.VArray=t.VArray,a.VPromised=t.VPromised,a.all=t.all,a.react=n,a.spawn=function(e){return n(e).valueOf()},a.Renderer=r,Object.assign(a,r),Object.assign(a,i),a}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(2),n(4),n(3)],i=function(e,t,n){function r(e){return function(t,n,r){"boolean"==typeof n&&(n=e[n?0:1]),t.style[r]=n}}function i(e,t,n){"number"==typeof t&&(t+="px"),e.style[n]=t}function o(e,t,n){e.style[n]=t}function a(e,t,n,r){for(var i=t.length>1||r?Y.createDocumentFragment():e,o=0,u=t.length;o<u;o++){var c,l=t[o];if(null!=l)if(l.create)oe=e,c=l.create(),i.appendChild(c),l.isContentNode&&(n.contentNode=c);else if(l.notifies){var f=l.isIterable?i:e;i.appendChild(c=s(f,l))}else if("object"==typeof l)if(l instanceof Array)n=n||e,c=c||e,a(c.contentNode||c,l,n);else{if(!l.nodeType)throw new Error("Unknown child type "+l);i.appendChild(c=l)}else c=Y.createTextNode(l),i.appendChild(c)}return i!=e&&(r?e.insertBefore(i,e.firstChild):e.appendChild(i)),c}function s(e,t){if(null==t)return Y.createTextNode("");var n;return t.notifies?(n=Y.createTextNode(""),new Z({element:e,textNode:n,variable:t})):n=Y.createTextNode(t),n}function u(e,t,n){t&&t.notifies?(new W({name:n,variable:t,element:e}),(J[e.tagName]||"SELECT"===e.tagName)&&d(e,t,n)):"SELECT"===e.tagName&&"value"===n?W.prototype.renderSelectValueUpdate(t,e):("number"===e.type&&isNaN(t)&&(t=""),e[n]=t)}function c(){}function l(e,t,n){t&&t.notifies?new q({name:n,variable:t,element:e}):e.setAttribute(n,t)}function f(e){var t=n.compose(B,function(e){B.apply(this,arguments)},{renderUpdate:e});return function(n,r,i){for(var o in r){var a=r[o];a&&a.notifies?new t({name:o,variable:a,element:n}):e(a,n,o)}}}function p(e,t){for(var n in t){var r,i=t[n],o=e._propertyHandlers[n];o?o===!0?i&&i.notifies?new B({name:n,variable:i,element:e}):e[n]=i:o(e,i,n,t):(r=Q[n])?i&&i.notifies?new G({name:n,variable:i,element:e}):r(e,i,n):null==e[n]?e[n]=i:"function"==typeof i&&"on"===n.slice(0,2)?e.addEventListener(n.slice(2),i):Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0})}}function h(e,t,n,r){var i=e.each||r.each;if(i&&t)if(i.create&&(i.defineHasOwn=function(){var e=t.getCollectionOf&&t.getCollectionOf()||pe;T(i,e,function(t){var n=e.from(t._item);return n})}),t.notifies)new X({each:i,variable:t,element:e});else{var o=Y.createDocumentFragment();i.defineHasOwn&&i.defineHasOwn(),t.forEach(function(t){i.create?childElement=i.create({parent:e,_item:t}):childElement=i(t,e),o.appendChild(childElement)}),e.appendChild(o)}else J[e.tagName]?y(e,t):t instanceof Array?(e=e.contentNode||e,a(e,t,e)):e.appendChild(s(e,t))}function d(t,r,i,o){n.nextTurn(function(){for(var n=t.inputEvents||["change","alkali-change"],a=0,s=n.length;a<s;a++)t.addEventListener(n[a],function(n){var a=t[i],s=r.put(o?o(a,t):a,new H(t));if(s===e.deny)throw new Error("Variable change denied")})})}function v(e,t){return"number"==t.type?parseFloat(e):e}function y(e,t){var n=e.type,r=n in{date:1,datetime:1,time:1}?"valueAsDate":"checkbox"===n||"radio"===n?"checked":"value";t&&t.notifies?(new W({variable:t,name:r,element:e}),d(e,t,r,v)):e[r]=t}function m(e,t){var n=t._applyOnCreate;if(e&&"object"==typeof e)if(e instanceof Array||e.notifies)n.content=e;else for(var r in e)ae[r]?T(t,e[r]):n[r]=e[r];else{if("function"==typeof e&&!e["for"])throw new TypeError("Function as argument not supported");n.content=e}}function g(e){if(e.hasOwnProperty("_applyOnCreate"))return e._applyOnCreate;if(e.getForClass){applyOnCreate=e._applyOnCreate={};var t=g(te(e));for(var n in t)applyOnCreate[n]=t[n];for(var r,i=e.prototype,o=Object.getOwnPropertyNames(i),a=0,s=o.length;a<s;a++){var n=o[a];if("on"===n.slice(0,2)||"render"===n&&z(i[n]))applyOnCreate[n]=i[n];else if("render"===n.slice(0,6)){var u=n[6].toLowerCase()+n.slice(7);r||(r=i._propertyHandlers=Object.create(i._propertyHandlers)),r[u]=!0,Object.defineProperty(i,u,b(n))}}return applyOnCreate}return null}function b(e){var t=new WeakMap;return{get:function(){return t.has(this)?t.get(this):null},set:function(n){t.set(this,n),this[e](n)}}}function w(){function e(t,n){return this instanceof e?x.apply(e.prototype===te(this)?e:this.constructor,arguments):O.apply(e,arguments)}return e.create=x,e["with"]=O,e["for"]=E,e.property=P,e.getForClass=N,e}function O(e,t){var n=w();n.superConstructor=this,n.tagName=this.tagName,this.children&&(n.children=this.children),n.prototype=this.prototype;var r=n._applyOnCreate={},i=g(this);for(var o in i)r[o]=i[o];var a=0;if("string"==typeof e){var s=e.match(U);if(s){do{var u=s[1],c=s[2];"."==u?r.className?r.className+=" "+c:r.className=c:r.id=c;var l=s[3];s=l&&l.match(U)}while(s)}else r.content=e;a++}for(var f=arguments.length;a<f;a++)m(arguments[a],n);return n}function x(e,t){var n=g(this);if(oe){var r=oe;oe=null}var i=Y.createElement(this.tagName);if(e&&e.parent&&(r=e.parent),r&&$.set(i,r),i instanceof this||ee(i,this.prototype),i.constructor!=this&&(i.constructor=this),arguments.length>0){var o=n;n={};for(var s in o)n[s]=o[s];var u=0;if("string"==typeof e){u++;var c=e.match(U);if(c){do{var l=c[1],f=c[2];"."==l?n.className?n.className+=" "+f:i.className?i.className+=" "+f:i.className=f:n.id?n.id=f:i.id=f;var d=c[3];c=d&&d.match(U)}while(c)}else n.content=e}else e&&e._item&&(i._item=e._item);for(var v=arguments.length;u<v;u++){var y=arguments[u];if(y&&"object"==typeof y)if(y instanceof Array||y.notifies)n.content=y;else for(var s in y)n[s]=y[s];else"function"==typeof y&&y["for"]?n.content=y["for"](i):n.content=y}}return i.created?n=i.created(n)||n:n.created&&(n=n.created.call(i,n)||n),p(i,n),this.children&&a(i,this.children,i),n.content&&h(i,n.content,"content",n),i.ready&&i.ready(n),i}function j(e){return this.nodeType?a(this,arguments,this):a(e,se.call(arguments,1),e)}function C(e){return this.nodeType?a(this,arguments,this,!0):a(e,se.call(arguments,1),e,!0)}function V(e){this.tagName=e,Y.registerElement&&this.prototype.constructor===this&&Y.registerElement(e,this)}function _(e){return e=e.toLowerCase(),ce[e]||(ce[e]=k(O.call(Y.createElement(e).constructor),e))}function k(e,t){var n=re[t];if(n&&!n.assigned){for(var r=e.prototype._propertyHandlers=Object.create(ne),i=0,o=n.length;i<o;i++)r[n[i]]=!0;if(n.value)for(var i in n)i>-1||(r[i]=n[i]);n.assigned=!0}return e.tagName=t,e}function M(e){e.forEach(function(e){var t;Object.defineProperty(ue,e,{get:function(){return t||(t=_(e))}})})}function S(e){e.forEach(function(e){var t;Object.defineProperty(ue,e,{get:function(){return t||(t=k(O.call(HTMLInputElement,{type:e.toLowerCase()}),"input"))}}),Object.defineProperty(ue,e+"Input",{get:function(){return this[e]}})})}function E(e){return e.constructor.getForClass(e,this)}function T(e,t,n){if("object"==typeof t){var r=e.ownedClasses||(e.ownedClasses=new WeakMap),i={get:function(){return t}};return r.set(t.constructor,i),T(e,t.Class,t.createInstance)}if(t instanceof Array)return t.forEach(function(t){T(e,t)});var i=new WeakMap;i.createInstance=n;var r=e.ownedClasses||(e.ownedClasses=new WeakMap);return r.set(t,i),e}function N(e,t){for(var n;e&&!(n=e.constructor.ownedClasses&&e.constructor.ownedClasses.get(t));)e=e.parentNode||$.get(e);if(n){var r=e.ownedInstances||(e.ownedInstances=new WeakMap),i=r.get(t);return void 0===i&&(r.set(t,i=n(e)),i.subject=e),i}}function P(t){return ThisElementVariable=this._Variable,ThisElementVariable||(ThisElementVariable=this._Variable=e(),T(this,ThisElementVariable,function(e){for(var t={},n=0;n<e.alkaliRenderers.length;n++){var r=e.alkaliRenderers[n];r.name&&(t[r.name]={value:r.variable})}var i=Object.create(e,t),o=new ThisElementVariable(i);return o})),ThisElementVariable.property(t)}function R(e){var t=e.alkaliRenderers;if(t){for(var n=0,r=t.length;n<r;n++)t[n].stop();e.needsRestart=!0}}function I(e){var t=e.alkaliRenderers;if(t)for(var n=0,r=t.length;n<r;n++);}function L(e){var t=e.constructor;t.create&&(e.attached&&e.attached(),e.needsRestart&&I(e))}function A(e){e.detached&&e.detached(),R(e)}function D(e,t){if("attached"===t.name)return!e.__alkaliAttached__&&(e.__alkaliAttached__=!0,t.action(e),!0);if(e.__alkaliAttached__){if(Y.body.contains(e))return!1;e.__alkaliAttached__=!1,t.action(e)}return!0}var F=["textContent","id","className","innerHTML","title","lang","translate","dir","tabIndex","accessKey","draggable","spellcheck","contentEditable","innerText","webkitdropzone"],U=/(\.|#)([-\w]+)(.+)?/,z=n.isGenerator,H=e.Context,B=t.PropertyRenderer,W=t.InputPropertyRenderer,q=t.AttributeRenderer,G=n.compose(t.StyleRenderer,function(){t.StyleRenderer.apply(this,arguments)},{renderUpdate:function(e,t){var n=Q[this.name];n?n(t,e,this.name):t.style[this.name]=e}}),K=n.compose(t.ElementRenderer,function(e){this.className=e.className,t.apply(this,arguments)},{renderUpdate:function(e,t){var n=t.className,r=this.className,i=n&&(" "+n+" ").replace(" "+r+" "," ");r=e?n?(i+r).slice(1):r:i.slice(1,i.length-1),r!=n&&(t.className=r)}}),Z=t.TextRenderer,X=t.ListRenderer,Y="undefined"!=typeof document?document:{createElement:function(e){return{}},addEventListener:function(){}},J={INPUT:1,TEXTAREA:1},Q={display:r(["","none"]),visibility:r(["visible","hidden"]),color:o,opacity:o,zoom:o,minZoom:o,maxZoom:o,fontWeight:o,position:r(["absolute",""]),textDecoration:r(["underline",""]),fontWeight:r(["bold","normal"])};["alignContent","alignItems","alignSelf","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction","backfaceVisibility","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundRepeatX","backgroundRepeatY","backgroundSize","baselineShift","border","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","bottom","boxShadow","boxSizing","bufferedRendering","captionSide","clear","clip","clipPath","clipRule","color","colorInterpolation","colorInterpolationFilters","colorRendering","counterIncrement","counterReset","cursor","direction","display","emptyCells","fill","fillOpacity","fillRule","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","float","floodColor","floodOpacity","font","fontFamily","fontFeatureSettings","fontKerning","fontSize","fontStretch","fontStyle","fontVariant","fontVariantLigatures","fontWeight","height","imageRendering","isolation","justifyContent","left","letterSpacing","lightingColor","lineHeight","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBottom","marginLeft","marginRight","marginTop","marker","markerEnd","markerMid","markerStart","mask","maskType","maxHeight","maxWidth","maxZoom","minHeight","minWidth","minZoom","mixBlendMode","motion","motionOffset","motionPath","motionRotation","objectFit","objectPosition","opacity","order","orientation","orphans","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","overflow","overflowWrap","overflowX","overflowY","padding","paddingBottom","paddingLeft","paddingRight","paddingTop","page","pageBreakAfter","pageBreakBefore","pageBreakInside","paintOrder","perspective","perspectiveOrigin","pointerEvents","position","quotes","resize","right","shapeImageThreshold","shapeMargin","shapeOutside","shapeRendering","size","speak","src","stopColor","stopOpacity","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","tabSize","tableLayout","textAlign","textAlignLast","textAnchor","textCombineUpright","textDecoration","textIndent","textOrientation","textOverflow","textRendering","textShadow","textTransform","top","touchAction","transform","transformOrigin","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","unicodeRange","userZoom","vectorEffect","verticalAlign","visibility","whiteSpace","widows","width","willChange","wordBreak","wordSpacing","wordWrap","writingMode","zIndex","zoom"].forEach(function(e){Q[e]=Q[e]||i});var $=new WeakMap,ee=Object.setPrototypeOf||function(e,t){e.__proto__=t},te=Object.getPrototypeOf||function(e){return e.__proto__},ne={children:c,tagName:c,classes:function(e,t){if(!(t.length>-1)){var n=0;for(var r in t)t[n]||(t[n]=r),n++;t.length=n}for(var n=0,i=t.length;n<i;n++){var o=t[n],a=t[o];a&&a.notifies?new K({element:e,className:o,variable:a}):(a||void 0===a)&&(e.className+=" "+o)}},"class":l,"for":l,role:l,render:function(t,n,r,i){new B({name:r,variable:new e.GeneratorVariable(n.bind(t,i)),element:t})},dataset:f(function(e,t,n){t.dataset[n||this.name]=e}),attributes:f(function(e,t,n){t.setAttribute(n||this.name,e)}),style:function(e,t,n){"string"==typeof t?e.setAttribute("style",t):t&&t.notifies?new q({name:"style",variable:t,element:e}):ie(e,t,n)}};F.forEach(function(e){ne[e]=!0}),"undefined"!=typeof HTMLElement&&(HTMLElement.prototype._propertyHandlers=ne);var re={input:n.copy(["accept","alt","autocomplete","autofocus","capture","defaultChecked","dirName","disabled","form","files","formAction","formEnctype","formMethod","formNoValidate","formTarget","indeterminate","inputMode","list","max","maxLength","min","minLength","multiple","name","pattern","placeholder","readOnly","required","size","src","step","type","defaultValue","willValidate","validity","validationMessage","useMap","autocapitalize","webkitdirectory","incremental","stepUp","stepDown"],{value:u,valueAsNumber:u,valueAsDate:u,checked:u,type:function(e,t){try{e.type=t}catch(n){}}}),select:n.copy(["name","size","type","selectedIndex","validationMessage"],{value:u}),textarea:n.copy(["cols","dirName","maxLength","minLength","name","placeholder","rows","wrap","type","defaultValue","textLength","validationMessage","autocapitalize"],{value:u}),a:["target","download","ping","rel","hreflang","type","referrerPolicy","href","media"],area:["target","download","coords","rel","hreflang","type","referrerPolicy","href","media","alt","shape"],button:["formAction","formEnctype","formMethod","formTarget","name","type","value","validationMessage"],dialog:["open"],embed:["src","type","name"],form:["acceptCharset","action","autocomplete","enctype","encoding","method","name","target","novalidate"],frame:["name","scrolling","src","frameBorder"],frameset:["cols","rows"],iframe:["src","srcdoc","name","referrerPolicy","align","scrolling","frameBorder","longDesc"],option:["label","value","text","index"],optgroup:["label"],output:["name","type","defaultValue","value","validationMessage"],label:["htmlFor"],td:["colSpan","rowSpan"],th:["colSpan","rowSpan"],script:["src","type","charset","text","event","htmlFor","integrity"],style:["media","type"],track:["kind","src","srclang","label"],link:["href","rel","media","hreflang","type","charset","rev","target","integrity","as"],meta:["name","httpEquiv","content","scheme"],meter:["value","min","max","low","high","optimum"],progress:["value","max","position"],del:["cite","dateTime"],ins:["cite","dateTime"],source:["src","type","srcset","sizes","media"],video:["videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount"],keygen:["challenge","keytype","name","type","validationMessage"],object:["data","type","name","useMap","validationMessage","archive","code","hspace","standby","vspace","codeBase","codeType"],param:["name","value","type","valueType"]},ie=f(function(e,t,n){t.style[n||this.name]=e});Y.addEventListener("click",function(e){var t=e.target;if("radio"===t.type)for(var n=Y.querySelectorAll("input[type=radio]"),r=0,i=n.length;r<i;r++){var o=n[r];o.name===t.name&&o!==t&&o.dispatchEvent(new Event("alkali-change",{}))}});var oe,ae={hasOwn:function(e,t){T(e,t)}},se=[].slice,ue=O.call("undefined"!=typeof HTMLElement?HTMLElement:function(){});ue.registerTag=V,ue.assign=p,ue.within=function(e){},M(["Video","Source","Media","Audio","UL","Track","Title","TextArea","Template","TBody","THead","TFoot","TR","Table","Col","ColGroup","TH","TD","Caption","Style","Span","Shadow","Select","Script","Quote","Progress","Pre","Picture","Param","P","Output","Option","Optgroup","Object","OL","Ins","Del","Meter","Meta","Menu","Map","Link","Legend","Label","LI","KeyGen","Input","Image","IFrame","H1","H2","H3","H4","H5","H6","Hr","FrameSet","Frame","Form","Font","Embed","Article","Aside","Footer","Figure","FigCaption","Header","Main","Mark","MenuItem","Nav","Section","Summary","WBr","Div","Dialog","Details","DataList","DL","Canvas","Button","Base","Br","Area","A"]),S(["Checkbox","Password","Submit","Radio","Color","Date","DateTime","Email","Month","Number","Range","Search","Tel","Time","Url","Week"]);var ce={},le={Anchor:"A",Paragraph:"P",Textarea:"TextArea",DList:"DL",UList:"UL",OList:"OL",ListItem:"LI",Text:"Input",TextInput:"Input",TableRow:"TR",TableCell:"TD",TableHeaderCell:"TH",TableHeader:"THead",TableBody:"TBody"};for(var fe in le)!function(e,t){Object.defineProperty(ue,e,{get:function(){return this[t]}})}(fe,le[fe]);ue.append=j,ue.prepend=C,ue.refresh=t.refresh,ue.options={moveLiveElementsEnabled:!0},ue.content=function(e){return{isContentNode:!0,create:e.create.bind(e)}},ue.ElementClass=function(){},"undefined"!=typeof Symbol&&Object.defineProperty(ue.ElementClass,Symbol.hasInstance,{value:function(e){return e&&e.create&&e["with"]}}),ue.extend=function(e,t){function n(){return e.apply(this,arguments)}ee(n,e);var r=n.prototype=Object.create(e.prototype);return r.constructor=n,Object.getOwnPropertyNames(t).forEach(function(e){var i=Object.getOwnPropertyDescriptor(t,e);ae[e]?ae[e](n,i.value):Object.defineProperty(r,e,i)}),n};var pe=ue.Item=e.Item;if("function"==typeof MutationObserver){var he=[{name:"detached",nodes:"removedNodes",action:A},{name:"attached",nodes:"addedNodes",action:L}],de=new MutationObserver(function(e){for(var t=0,n=e.length;t<n;t++)for(var r=e[t],i=0,o=he.length;i<o;i++){var a=he[i],s=r[a.nodes];e:for(var u=0,c=s.length;u<c;u++){var l=s[u];if(D(l,a)){var f=l.firstChild;if(f)for(;;){var p;if(1===f.nodeType&&D(f,a)?(p=f.firstChild,p||(p=f.nextSibling)):p=f.nextSibling,!p)do if(f=f.parentNode,f===l)continue e;while(!(p=f.nextSibling));f=p}}}}});de.observe(Y.body||Y,{childList:!0,subtree:!0})}return n.copy(e.Context.prototype,{specify:function(e){var t=this.subject,n=!0;(this.generics||(this.generics=[])).push(e);do{this.distinctSubject===t&&(n=!1);var r=t.constructor.ownedClasses;if(r){var i=r.get(e);if(i)return n&&(this.distinctSubject=t),specifiedInstance=i.get(t),specifiedInstance||i.set(t,specifiedInstance=i.createInstance?i.createInstance(t):new e),specifiedInstance}}while(t=t.parentNode||$.get(t));return e.defaultInstance},getContextualized:function(e){var t=this.subject;if(!t)return e;if(e._contextMap)do{var n=e._contextMap.get(t);if(n&&n.context.matches(t))return n}while(t=t.parentNode||$.get(t));return e.context&&e.context.matches(this.subject)?e:void 0},merge:function(e){this.distinctSubject&&!this.distinctSubject.contains(e.distinctSubject)||(this.distinctSubject=e.distinctSubject),[].push.apply(this.generics||(this.generics=[]),e.generics)},getDistinctElement:function(e,t){do{var n=t.constructor.ownedClasses;if(n){var r=n.get(e);if(r&&r.has(t))return t}}while(t=t.parentNode||$.get(t))},matches:function(e){var t=this.generics;if(t)for(var n=0,r=t.length;n<r;n++)if(this.getDistinctElement(t[n],e)!==this.distinctSubject)return!1;return!0}}),ue}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3)],i=function(e){function t(e,t){return e&&e.then?e.then(t):t(e)}function n(e){this.subject=e,this.inputs=[]}function r(e,t){this.subject=t,this.listener=e}function i(t,n){for(var r,i=0,o=t.length;i<o;i++)t[i]&&t[i].then&&(r=!0);return r?e.whenAll(t,n):n(t)}function o(e,t){var n=R.get(e),r=t.listenerId||(t.listenerId="-"+I++);n?void 0===n[r]&&(n[r]=n.push(t)-1):(R.set(e,n=[t]),n[r]=0,p.autoObserveObjects&&observe(e)),t.listeningToObject=e}function a(e){if(e.listeningToObject){var t=e.listeningToObject;e.listeningToObject=null;var n=R.get(t);if(n){var r=n[e.listenerId];r>-1&&(n.splice(r,1),delete n[e.listenerId])}}}function s(){this.visited=new Set}function u(e,t,n){this.key=e,this.childEvent=t,this.parent=n,this.visited=t.visited}function c(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function l(e){this.visited=new Set;for(var t in e)this[t]=e[t]}function f(e,t){for(var n in e){var r=e[n];if(r.returnedVariable&&t(r.returnedVariable),r.hasChildNotifiers){var i=r._properties;i&&f(i,t)}}}function p(e){return this instanceof p?void(void 0===e?void 0!==this["default"]&&(this.value=this["default"]):this.value=e):p.extend(e)}function h(e,n){e._willModify(),t(e.cachedValue||e.valueOf(),function(t){t||e.put(t=[]),e.updateVersion();var r=n.call(e,t);return e.cachedVersion=e.version,r})}function d(e,t,n,r){var i=t.length;if(i>0){if(e._properties)for(var o,a=r-i;a>n;){var o=e._properties[--a];o&&(e._properties[a]=void 0,o.key+=i,e._properties[o.key]=o)}for(var a=0,s=t.length;a<s;a++)e.updated(new c({value:t[a],index:a+n,modifier:e}),e)}}function v(e,t,n,r,i){var o,a=n+r;if(r>0){if(e._properties)for(var a=n+r;a<i+r;a++){var o=e._properties[a];o&&(e._properties[a]=void 0,o.key-=r,e._properties[o.key]=o)}for(var a=0;a<r;a++)e.updated(new l({previousIndex:n,oldValue:t[a],modifier:e}),e);e.cachedVersion=e.version}}function y(t,n,r){var i=e.compose(z,n,r);i.prototype.method||(i.prototype.method=t),Object.defineProperty(i.prototype,"isIterable",{value:!0}),p.prototype[t]=function(){var e=new i;return e.source=this,e.arguments=arguments,e}}function m(e){p[e]=function(t){t[e]=!0}}function g(e){var t=R.get(e);if(t)for(var n=0,r=t.length;n<r;n++)t[n]._propertyChange(null,e)}function b(e){if(e.length>-1)return new D(e);if(arguments.length>1)return new D(arguments);if("object"==typeof e){var t=[],n=[];for(var r in e)t.push(r),n.push(e[r]);return new p(function(e){for(var n={},r=0;r<e.length;r++)n[t[r]]=e[r];return n}).apply(null,n)}throw new TypeError("Variable.all requires an array")}function w(e,t){var n=this.ownedClasses||(this.ownedClasses=new k);return n.set(e,t||function(){return new e}),this}function O(){for(var e=this.prototype,t=Object.getOwnPropertyNames(e),n=0,r=t.length;n<r;n++){var i=t[n];Object.defineProperty(this,i,x(Object.getOwnPropertyDescriptor(e,i),i,this))}}function x(e,t,n){return"function"==typeof e.value?{value:j(n,t)}:e}function j(e,t){var n=e[t]=function(){var n=e["for"](this);return n[t].apply(n,arguments)};return n["for"]=function(n){var r=e["for"](n);return function(){return r[t].apply(r,arguments)}},n}function C(e,t){return t?t.specify(e):e.defaultInstance}var V={},_={},k=e.WeakMap,M=Object.setPrototypeOf||function(e,t){e.__proto__=t},S=Object.getPrototypeOf||function(e){return e.__proto__},E=e.isGenerator,T=3,N=4,P=(Object.freeze({type:"refresh"}),1),R=new k(null,"propertyListenersMap"),I=(e.compose(k,function(){},{_propertyChange:function(e){this.variable._propertyChange(e,contextFromCache(this))}}),1);n.prototype={constructor:n,newContext:function(e){return new n(this.subject)},contextualize:function(e,t){var n;if(this.distinctSubject){var r=e._contextMap||(e._contextMap=new k);if(n=r.get(this.distinctSubject),!n){r.set(this.distinctSubject,n=Object.create(e)),n.listeners=!1,n.context=this;for(var i=this.inputs,o=0,a=i.length;o<a;o++)n[i[o]]=i[++o]}this.contextualized=n,t&&t.merge(this)}else n=e;return t.addInput(n),n},merge:function(e){this.distinctSubject||(this.distinctSubject=e.distinctSubject)},specify:function(e){var t,n=this.subject,r=n.constructor.ownedClasses;if(r){this.distinctSubject||(this.distinctSubject=n);var i=r.get(e);if(i)return t=i.get(n),t||i.set(n,t=i.createInstance?i.createInstance(n):new e),t}return e.defaultInstance},getContextualized:function(e){var t=e._contextMap&&this.subject&&e._contextMap.get(this.subject);if(t&&t.context&&t.context.matches(this))return t},addInput:function(e){this.inputs.push(this.nextProperty,e)},matches:function(e){return e.subject===this.subject}},r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.addInput=function(e){e.notifies(this.listener)},s.prototype.type="refresh",u.prototype.type="update",c.prototype.type="add",l.prototype.type="delete";var L=p.prototype={get _currentValue(){return this.valueOf()},set _currentValue(e){this.put(e)},constructor:p,valueOf:function(e){var n;if(this.parent){e&&(n=e.newContext(),n.nextProperty="parent");var r=this.key,i=this,o=this.parent.valueOf(n),a=function(t){var o=i.gotValue(null==t?void 0:"function"==typeof t.get?t.get(r):t[r],e,n);if(i.listeners){var a=R.get(t);a&&a.observer&&a.observer.addKey&&a.observer.addKey(r)}return o};return o&&o.then?(this.gotValue(null,e,n),t(o,a)):a(o)}return this.gotValue(this.getValue?this.getValue(e&&(n=e.newContext())):this.value,e,n)},gotValue:function(e,n,r){var i=this.returnedVariable,o=this;if(i){if(e===i)return o.ownObject?o.ownObject:n?(r||(r=n.newContext()),r.contextualize(this,n),r.nextProperty="returnedVariable",e.valueOf(r)):e.valueOf();o.listeners&&i.stopNotifies(o),o.returnedVariable=null}return e&&e.notifies&&(o.returnedVariable=e,o.listeners&&e.notifies(o),r=r||n&&(r=n.newContext()),r&&(r.nextProperty="returnedVariable"),e=e.valueOf(r),o.ownObject&&(S(o.ownObject)!==e&&M(o.ownObject,e),e=o.ownObject)),void 0===e&&(e=o["default"]),r&&r.contextualize(this,n),n&&(r||n.addInput(this)),e&&e.then?t(e,function(e){return p.prototype.gotValue.call(o,e,r)}):e},isMap:function(){return this.value instanceof Map},property:function(e,t){var n=this.isMap(),r=this._properties||(this._properties=n?new Map:{}),i=n?r.get(e):r[e];return i||(i=new(t||p),i.key=e,i.parent=this,n?r.set(e,i):r[e]=i),i},"for":function(e){return e&&e.target&&!e.constructor.getForClass&&(e=e.target),this.parent?this.parent["for"](e).property(this.key):new U(this,e||W)},_changeValue:function(e,n,r){var i=this.key,o=this.parent,a=this;return o._willModify(e),t(o.valueOf(e),function(t){if(null==t){o.put(t="number"==typeof i?[]:{},e)}else if("object"!=typeof t)return V;var s="function"==typeof t.get?t.get(i):t[i];if(s===r)return _;a.__debug&&(console.log("Variable changed from",s,r,"at"),console.log(((new Error).stack||"").replace(/Error/,""))),"function"==typeof t.set?t.set(i,r):n==T&&s&&s.put?s.put(r):t[i]=r,a.updated(null,a,e);var u=R.get(t);if(u){u=u.slice(0);for(var c=0,l=u.length;c<l;c++){var f=u[c];f!==o&&f._propertyChange(i,t,e,n)}}})},_propertyChange:function(e,t,n,r){this.onPropertyChange&&this.onPropertyChange(e,t,n),this.updated(new u(e,new s,this),null,n)},eachKey:function(e){for(var t in this._properties)e(t)},apply:function(e,t){return new F(this,t)},call:function(e){return this.apply(e,Array.prototype.slice.call(arguments,1))},forDependencies:function(e){if(this.returnedVariable&&e(this.returnedVariable),this.hasNotifyingChild){var t=this._properties;t&&f(t,e)}this.parent&&e(this.parent)},init:function(){var e=this;this.forDependencies(function(t){t.notifies(e)}),null===this.listeningToObject&&this.valueOf()},cleanup:function(){this.listeners=!1;var e=this.handles;if(e)for(var t=0;t<e.length;t++)e[t].remove();this.handles=null;var n=this.returnedVariable;n&&(this.computedVariable=null);var r=this;this.forDependencies(function(e){e.stopNotifies(r)})},updateVersion:function(e){this.version=P++},getVersion:function(e){return Math.max(this.version||0,this.returnedVariable&&this.returnedVariable.getVersion?this.returnedVariable.getVersion(e):0)},getSubject:function(e){return this.subject},getUpdates:function(e){var t=[],n=this.nextUpdateMap;if(n&&e)for(;e=n.get(e);)"refresh"===e.type&&(t=[]),t.push(e);return t},updated:function(e,t,n){if(e||(e=new s),!e.visited.has(this)){e.visited.add(this);var r=n?n.getContextualized(this):this;r&&r.updated(e,this,n),this.updateVersion();var i=this.listeners;if(i){var o=this;i.forEach(function(t){e instanceof u&&t.parent?t.key===e.key&&t.updated(e.childEvent,o,n):t.updated(e,o,n)})}return e instanceof u&&(this.returnedVariable&&this.fixed&&this.returnedVariable.updated(e,this,n),this.constructor.collection&&this.constructor.collection.updated(e,this,n)),this.parent&&this.parent.updated(new u(this.key,e,this.parent),this,n),e}},invalidate:function(){this.updated()},notifies:function(e){var t=this.listeners;t&&this.hasOwnProperty("listeners")||(this.listeners=t=new Set,this.init()),t.add(e)},subscribe:function(t){var n,r,i=this;if("function"==typeof t){var i=this,o={value:function(){return i.valueOf()}};n=function(){r=!1,t(o)}}else{if(!t.next)throw new Error("Subscribing to an invalid listener, the listener must be a function, or have an update or next method");n=function(){r=!1,t.next(i.valueOf())}}var a={updated:function(){r||(r=!0,e.nextTurn(n))}};return n(),this.notifies(a),{unsubscribe:function(){i.stopNotifies(a)}}},stopNotifies:function(e){var t=this.listeners;t&&(t["delete"](e),0===t.size&&this.cleanup())},put:function(e,n){var r=this;return this.parent?this._changeValue(n,T,e):(this.ownObject&&(this.ownObject=!1),t(this.getValue?this.getValue(n):this.value,function(i){return r.__debug&&(console.log("Variable changed from",i,newValue,"at"),console.log(((new Error).stack||"").replace(/Error/,""))),i===e?_:r.fixed&&i&&i.put?i.put(e):t(r.setValue(e,n),function(e){r.updated(new s,r,n)})}))},get:function(e){return this._properties&&this._properties[e]?this.property(e).valueOf():t(this.valueOf(),function(t){var n=t&&("function"==typeof t.get?t.get(e):t[e]);return n&&n.notifies?n.valueOf():n})},set:function(e,t){this.property(e)._changeValue(null,N,t)},undefine:function(e,t){this.set(e,void 0,t)},proxy:function(e){var n=this;return this.fixed=!0,t(this.setValue(e),function(e){return n.updated(new s,n),n})},next:function(e){this.put(e)},error:function(e){var t=this.listeners;t&&t.forEach(function(t){t.error(e)})},complete:function(e){this.put(e)},setValue:function(e){this.value=e},onValue:function(t){return this.subscribe(function(n){e.when(n.value(),function(e){t(e)})})},toJSON:function(){return this.valueOf()},toString:function(){return this.valueOf()},forEach:function(e,n,r){if(e.notifies){return this.forEach(function(t){var r=e.from(t);n.call(this,r)},r)}return t(this.valueOf(n),function(t){if(t&&t.forEach)t.forEach(e);else for(var n in t)e.call(t,t[n],n)})},to:function(e,t){if("function"!=typeof e)throw"object"==typeof e&&this.to(e.get,e.set),new Error("No function provided to transform");return t&&(e.reverse=function(e,n,r){t.call(this,n[0],r)}),new F(e,[this])},get schema(){if(this.parent){var e=this.parent.schema.properties;return e&&e[this.key]}return this.returnedVariable?this.returnedVariable.schema:this.constructor},set schema(e){Object.defineProperty(this,"schema",{value:e})},validate:function(e,t){if(this.returnedVariable)return this.returnedVariable.validate(e,t);if(this.parent)return this.parent.validate(e.valueOf(),t);if(t&&t.type&&t.type!==typeof e)return["Target type of "+typeof e+" does not match schema type of "+t.type];
var n=[];return n.isValid=!0,n},get validation(){var e=new B(this);return Object.defineProperty(this,"validation",{value:e}),e},set validation(e){Object.defineProperty(this,"validation",{value:e})},set structured(e){for(var t=Object.keys(this),n=t.length>1&&this._properties||(this._properties={}),r=0,i=t.length;r<i;r++){var o=t[r],a=this[o];if(a instanceof p){var s=n[o];if(s)s!==a&&s.put(a);else{if(a.parent){if(a.parent===this)continue;var u=new p;u.proxy(a),a=u}a.key=o,a.parent=this,n[o]=a}}}},getId:function(){return this.id||(this.id=P++)},observeObject:function(){var n=this;return t(this.valueOf(),function(t){var r=R.get(t);if(r||R.set(t,r=[]),r.observerCount)r.observerCount++;else{r.observerCount=1;var i=r.observer=e.observe(t,function(e){for(var n=0,i=r.length;n<i;n++)for(var o=r[n],a=0,s=e.length;a<s;a++){var u=e[a];o._propertyChange(u.name,t)}});if(i.addKey)for(var s=0,u=r.length;s<u;s++){var c=r[s];c.eachKey(function(e){i.addKey(e)})}}return o(t,n),{remove:function(){a(t,n),--r.observerCount||r.observer.remove()},done:function(){e.deliverChanges(i),this.remove()}}})},getCollectionOf:function(){return this.constructor.collectionOf},_willModify:function(e){if(this.fixed&&this.value&&this.value._willModify)return this.value._willModify(e);if(!this.ownObject&&this.value&&this.value.notifies){var n=this;return t(this.valueOf(e),function(e){e&&"object"==typeof e&&(e instanceof Array?n.ownObject=e.slice(0):n.ownObject=Object.create(e))})}this.parent&&this.parent._willModify()},_sN:function(e){return this.name=e,this},get _debug(){return void 0===this.__debug&&(this.__debug=!0),this.__debug},set _debug(e){this.__debug=e},splice:function(e,t){var n=arguments;return h(this,function(r){var i=r.splice.apply(r,n);return v(this,i,e,t,r.length),d(this,[].slice.call(n,2),e,r.length),i})},push:function(){var e=arguments;return h(this,function(t){var n=t.push.apply(t,e);return d(this,e,t.length-e.length,t.length),n})},unshift:function(){var e=arguments;return h(this,function(t){var n=t.unshift.apply(t,e);return d(this,e,0,t.length),n})},pop:function(){return h(this,function(e){var t=e.pop();return v(this,[t],e.length,1),t})},shift:function(){return h(this,function(e){var t=e.shift();return v(this,[t],0,1,e.length),t})}};"undefined"!=typeof Symbol&&(p.prototype[Symbol.iterator]=function(){return this.valueOf()[Symbol.iterator]()}),p.VMap=e.compose(p,function(e){this.value="undefined"==typeof e?this["default"]:e},{property:function(e){var t=this._properties||(this._properties=new Map),n=t.get(e);return n||(n=new p,n.key=e,n.parent=this,t.set(e,n)),n}});var A=p.Caching=e.compose(p,function(e,t){e&&(this.getValue=e),t&&(this.setValue=t)},{valueOf:function(e){function t(t){t&&t.notifies&&i.listeners&&(i.computedVariable=t),t=i.gotValue(t,e,r);var n=r&&r.contextualized||i;return n.cachedVersion=o,n.cachedValue=t,n.context=r,t}var n=this;if(e&&(n=e.getContextualized(this),!n&&this.context&&this.context.matches(e)&&(n=this)),n&&n.cachedVersion===n.getVersion())return e&&e.addInput(n),n.cachedValue;var r,i=this;e&&(r=e.newContext());var o=this.getVersion(),a=this.getValue(r);return a&&a.then?(this.gotValue(null,e,r),a.then(t)):t(a)}}),D=(p.Item=e.compose(p,function(e,t){this.value=e,this.collection=t},{}),p.Composite=e.compose(A,function(e){for(var t=0,n=e.length;t<n;t++)this["argument"+t]=e[t]},{forDependencies:function(e){A.prototype.forDependencies.call(this,e);for(var t,n,r=0;(t=this[n="argument"+r])||n in this;r++)t&&t.notifies&&e(t)},updated:function(e,t,n){if(t!==this.returnedVariable&&e&&"refresh"!==e.type)for(var r,i,o=0;(r=this[i="argument"+o])||i in this;o++)r!==t||(e=new s);return A.prototype.updated.call(this,e,t,n)},getUpdates:function(e){if(!e||e.version<getVersion())return[new s]},getVersion:function(e){for(var t,n,r=p.prototype.getVersion.call(this,e),i=0;(t=this[n="argument"+i])||n in this;i++)t&&t.getVersion&&(r=Math.max(r,t.getVersion(e)));return r},getValue:function(e){for(var t,n,r=[],o=0;(t=this[n="argument"+o])||n in this;o++)e&&(e.nextProperty=n),r[o]=t&&t.valueOf(e);return i(r,function(e){return e})},getArguments:function(){for(var e,t,n=[],r=0;(e=this[t="argument"+r])||t in this;r++)n.push(e);return n}})),F=e.compose(D,function(e,t){this.transform=e;for(var n=0,r=t.length;n<r;n++)this["argument"+n]=t[n]},{fixed:!0,forDependencies:function(e){D.prototype.forDependencies.call(this,e),this.transform.notifies&&e(this.transform)},getValue:function(e){e&&(e.nextProperty="transform");var t=this.transform.valueOf(e);if(t.then){var n=this;return t.then(function(t){return n.invoke(t,e)})}return this.invoke(t,e)},getVersion:function(e){var t=D.prototype.getVersion.call(this,e);return this.transform.getVersion?Math.max(t,this.transform.getVersion(e)):t},execute:function(e){var n=this;return t(this.transform.valueOf(e),function(t){return n.invoke(t,e,!0)})},put:function(e,n){var r=this;return t(this.valueOf(n),function(i){return i===e?_:t(r.transform.valueOf(n),function(t){return r.invoke(function(){return t.reverse?(t.reverse.call(r,e,r.getArguments(),n),p.prototype.put.call(r,e,n)):i&&i.put?i.put(e):V},n)})})},invoke:function(e,n,r){var o=this.transform.parent;if(e.handlesVariables||e.property)return e.apply(o,this.getArguments(),n);for(var a,s,u=[],c=0;(a=this[s="argument"+c])||s in this;c++)n&&(n.nextProperty=s),u[c]=a&&a.valueOf(n);return o=o&&o.valueOf(n),e.handlesPromises?e.apply(o,u,n):(u.push(o),i(u,function(i){if(r){for(var o=[],a=0,s=i.length;a<s;a++){var u=i[a];u&&"object"==typeof u&&o.push(observe(u))}var c=i.pop();try{var l=e.apply(c,i,n)}finally{t(l,function(){for(var e=0;e<s;e++)o[e].done()})}return l}var c=i.pop();return e.apply(c,i,n)}))},setReverse:function(e){return this.transform.valueOf().reverse=e,this},getCollectionOf:function(){return this.returnedVariable&&this.returnedVariable.getCollectionOf()}});p.Call=F;var U=e.compose(p,function(e,t){this.generic=e,this.subject=t},{valueOf:function(){var e=this.subject;return this.generic.valueOf(e.getContextualized?e:new n(e))},forDependencies:function(e){this.inputs&&this.inputs.forEach(e)},getVersion:function(){for(var e=p.prototype.getVersion.call(this),t=this.inputs||0,n=0,r=t.length;n<r;n++){var i=t[n];i.getVersion&&(e=Math.max(e,i.getVersion()))}return e},put:function(e){var t=this.subject;return this.generic.put(e,t.getContextualized?t:new n(t))}}),z=e.compose(D,function(e,t,n){this.source=e,this.method=t,this.arguments=n},{getValue:function(e){var n=this.method,r=this.arguments,i=this;return e&&(e.nextProperty="source"),t(this.source.valueOf(e),function(t){if(t&&t.forEach){if(e&&e.notify){var o;if(e.distinctSubject){var a=i._contextMap||(i._contextMap=new k);a.has(e.distinctSubject)?o=a.get(e.distinctSubject):(a.set(e.distinctSubject,o=Object.create(i)),o.listeners=!1)}else o=i;i.notifies(o)}}else{if("map"===n)return r[0](t);t=[t]}return"string"==typeof n?t[n].apply(t,r):n(t,r)})},forDependencies:function(e){D.prototype.forDependencies.call(this,e),e(this.source)},getVersion:function(e){return Math.max(D.prototype.getVersion.call(this,e),this.source.getVersion(e))},getCollectionOf:function(){return this.source.getCollectionOf()}});y("filter",function(){},{updated:function(e,t,n){if(!e||e.modifier===this||e.modifier&&e.modifier.constructor===this)return D.prototype.updated.call(this,e,t,n);var r=n?n.getContextualized(this):this;if("delete"===e.type){var i=r.cachedValue.indexOf(e.oldValue);i>-1&&r.splice(i,1)}else{if("add"!==e.type){if("update"===e.type){var o=e.parent.valueOf(n),i=r.cachedValue.indexOf(o),a=[o].filter(this.arguments[0]).length>0;if(i>-1){if(a)return new u(i,e,r.cachedValue,o);r.splice(i,1)}else a&&r.push(o);return}return D.prototype.updated.call(this,e,t,n)}[e.value].filter(this.arguments[0]).length>0&&r.push(e.value)}}}),y("map",function(){},{updated:function(e,t,n){if(!e||e.modifier===this||e.modifier&&e.modifier.constructor===this)return D.prototype.updated.call(this,e,t,n);var r=n?n.getContextualized(this):this;if("delete"===e.type)r.splice(e.previousIndex,1);else if("add"===e.type)r.push(this.arguments[0].call(this.arguments[1],e.value));else{if("update"!==e.type)return D.prototype.updated.call(this,e,t,n);var i=e.parent.valueOf(n),o=r.cachedValue;if(!o||!o.map)return D.prototype.updated.call(this,e,t,n);var a=o.indexOf(i);[i].filter(this.arguments[0]).length>0;r.splice(a,1,this.arguments[0].call(this.arguments[1],e.value))}}}),y("reduce",function(){}),y("reduceRight",function(){}),y("some",function(){}),y("every",function(){}),y("slice",function(){}),y("keyBy",function(e,t){},{isMap:function(){return!0},method:function(e,t){for(var n=new Map,r=t[0],i=t[1],o="function"==typeof r,a="function"==typeof i,s=!!r,u=0,c=e.length;u<c;u++){var l=e[u];n.set(o?r(l):s?l[r]:l,a?i(l):l)}return n}}),y("groupBy",function(e,t){},{isMap:function(){return!0},method:function(e,t){for(var n=new Map,r=t[0],i=t[1],o="function"==typeof r,a="function"==typeof i,s=!!r,u=0,c=e.length;u<c;u++){var l=e[u],f=o?r(l):s?l[r]:l,p=n.get(f);p||n.set(f,p=[]),p.push(a?i(l):l)}return n}});var H,B=(p.GeneratorVariable=e.compose(p.Composite,function(e){this.generator=e},{getValue:H=function(e,t){var n,r,i,o;for(t?(i=t.iterator,r=t.i,n=t.value,o=t.isThrowing):(r=0,i=this.generator());;){var a=i[o?"throw":"next"](n);if(a.done)return a.value;var s=a.value,u="argument"+r;if(this[u]!==s)if(this[u]&&this[u].stopNotifies(this),s&&s.notifies)this.listeners&&s.notifies(this),this[u]=s;else if("function"==typeof s&&E(s)){var c;H.call(this,e,c={i:r,iterator:s()}),r=c.i}else this[u]=null;if(r++,t&&(t.i=r),e&&(e.nextProperty=u),n=s&&s.valueOf(e),n&&n.then){var l=this;return n.then(function(t){return H.call(l,e,{i:r,iterator:i,value:t})},function(t){return H.call(l,e,{i:r,iterator:i,value:t,isThrowing:!0})})}}}}),e.compose(A,function(e){this.target=e},{forDependencies:function(e){A.prototype.forDependencies.call(this,e),e(this.target)},getVersion:function(e){return Math.max(p.prototype.getVersion.call(this,e),this.target.getVersion(e))},getValue:function(e){var t=this.target;return t.valueOf(e),t.validate(t,t.schema)}}));p.VArray=p,p.VPromised=p,p.deny=V,p.noChange=_,m(p,"handlesContext"),m(p,"handlesPromises");var W={name:"Default context",description:"This object is the default context for classes, corresponding to a singleton instance of that class",constructor:{getForClass:function(e,t){return t.defaultInstance}},contains:function(){return!0}};for(var q in L)Object.defineProperty(p,q,Object.getOwnPropertyDescriptor(L,q));return p.valueOf=function(e){return C(this,e).valueOf(e)},p.put=function(e,t){return C(this,t).put(e,t)},p["for"]=function(e){if(null!=e){e.target&&!e.constructor.getForClass&&(e=e.target);var t;return t=new n(e).specify(this),t&&!t.subject&&(t.subject=e),t||this.defaultInstance}return this.defaultInstance},p.from=function(e){if(e&&"object"==typeof e){var t=this.instanceMap||(this.instanceMap=new k),n=t.get(e);return n||t.set(e,n=new this(e)),n}return new this(e)},p.notifies=function(e){this.defaultInstance.notifies(e)},p.stopNotifies=function(e){this.defaultInstance.stopNotifies(e)},p.getCollectionOf=function(){return this.collectionOf},p.updated=function(e,t,n){return C(this,n).updated(e,t,n)},Object.defineProperty(p,"collectionOf",{get:function(){return this._collectionOf},set:function(e){this._collectionOf!=e&&(this._collectionOf=e,e.collection=this)}}),Object.defineProperty(p,"collection",{get:function(){return this._collection},set:function(e){this._collection!=e&&(this._collection=e,e.collectionOf=this)}}),p.Context=n,p.NotifyingContext=r,p.generalize=O,p.call=Function.prototype.call,p.apply=Function.prototype.apply,p.extend=function(e){function t(){return this instanceof t?void n.apply(this,arguments):t.extend(e)}var n=this,r=t.prototype=Object.create(this.prototype);t.prototype.constructor=t,M(t,this);for(var i in e){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,o),Object.defineProperty(t,i,x(o,i,t))}return e&&e.hasOwn&&w.call(t,e.hasOwn),t},Object.defineProperty(p,"defaultInstance",{get:function(){return this.hasOwnProperty("_defaultInstance")?this._defaultInstance:(this._defaultInstance=new this,this._defaultInstance.subject=W,this._defaultInstance)}}),p.hasOwn=function(e,t){var n=new k;n.createInstance=t;var r=this.ownedClasses||(this.ownedClasses=new k);r.set(e,n)},p.all=b,p.objectUpdated=g,p}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[],i=function(){function e(e){return s[e]}function t(e,t,n){var r;for(var i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(e[i]=t[i](r||(r=[])).push({name:i}));for(var i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i](r||(r=[])).push({name:i}));r&&n(r)}function n(){return n}function r(e){if("function"==typeof e){var t=e.constructor;return"GeneratorFunction"===(t.displayName||t.name)}}var i,o=Object.getPrototypeOf||function(e){return e.__proto__},a=Object.setPrototypeOf||function(e,t){e.__proto__=t},s={requestAnimationFrame:"undefined"!=typeof requestAnimationFrame,defineProperty:Object.defineProperty&&function(){try{return Object.defineProperty({},"t",{}),!0}catch(e){}}(),promise:"undefined"!=typeof Promise,MutationObserver:"undefined"!=typeof MutationObserver,WeakMap:"function"==typeof WeakMap},u=e("defineProperty")?function(e,t){function n(n){var r="key"+n;if(!this[r]){this[r]=!0;var i,a=e[n],s=e;do i=Object.getOwnPropertyDescriptor(s,n);while(!i&&(s=o(s)));if(i&&i.set){var u=i.set,c=i.get;Object.defineProperty(e,n,{get:function(){return a=c.call(this)},set:function(e){u.call(this,e),a!==e&&(a=e,t&&t([{target:this,name:n}]))},enumerable:i.enumerable})}else Object.defineProperty(e,n,{get:function(){return a},set:function(e){a!==e&&(a=e,t&&t([{target:this,name:n}]))},enumerable:!i||i.enumerable})}}return t.addKey=n,t.remove=function(){t=null},t}:function(e,n){h||(h=!0,setInterval(function(){for(var e=0,n=l.length;e<n;e++)t(f[e],l[e],p[e])},20));var r={};for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);l.push(e),f.push(r),p.push(n)},c=e("observe")?Object.unobserve:function(e,t){t.remove&&t.remove();for(var n=0,r=l.length;n<r;n++)if(l[n]===e&&p[n]===t)return l.splice(n,1),f.splice(n,1),void p.splice(n,1)},l=[],f=[],p=[],h=!1,d=1,v=function(){};v.prototype.toJSON=n;var y={requestAnimationFrame:e("requestAnimationFrame")?requestAnimationFrame:function(){function e(){for(var e=0;e<n.length;e++)n[e]();n=[],r=!1}function t(t){r||(setTimeout(e),r=!0),n.push(t)}var n=[],r=!1;return t}(),Promise:e("promise")?Promise:function(){function e(t){function n(e){e&&e.then?e.then(n,r):(a=e,i())}function r(e){s=e,i()}function i(){o=!0;for(var e=0,t=u.length;e<t;e++)u[e]();u=0}var o,a,s,u=0;return t(n,r),{then:function(t,n){return new e(function(e,r){function i(){try{s&&!n?r(s):e(s?n(s):t?t(a):a)}catch(i){r(i)}}o?i():(u||(u=[])).push(i)})}}}return e}(),WeakMap:e("WeakMap")?WeakMap:function(t,n){var r="__"+(n||"")+d++;return e("defineProperty")?{get:function(e){return e[r]},set:function(e,t){Object.defineProperty(e,r,{value:t,enumerable:!1})}}:{get:function(e){var t=e[r];return t&&t.value},set:function(e,t){var n=e[r]||(e[r]=new v);n.value=t}}},observe:u,unobserve:c,when:function(e,t,n){return e&&e.then?e.then(t,n)||e:t(e)},whenAll:function(e,t){for(var n,r=0,i=e.length;r<i;r++)e[r]&&e[r].then&&(n=!0);return n?{then:function(n,r){function i(){s--,s||(o=n(t(u)))}for(var o,a,s=1,u=[],c=0;c<e.length;c++){var l=e[c];s++,l&&l.then?!function(e,t){a=l.then(function(n){return u[e]=n,i(),s?t:o},r)}(c,a):(u[c]=l,i())}return i(),a},inputs:e}:t(e)},compose:function(e,t,n){var r=t.prototype=Object.create(e.prototype);a(t,e);for(var i in n)r[i]=n[i];return r.constructor=t,t},nextTurn:e("MutationObserver")?function(e){var t=document.createElement("div"),n=new MutationObserver(e);n.observe(t,{attributes:!0}),t.setAttribute("a",d++)}:function(e){setTimeout(e,0)},copy:Object.assign||function(e,t){for(var n in t)e[n]=t[n];return e}};return y.isGenerator=r,y}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3),n(2)],i=function(e,t){function n(e){var t=e.variable;if(this.variable=t,e.selector&&(this.selector=e.selector),e.elements){this.elements=e.elements,this.element=this.elements[0];for(var n=0,r=this.elements.length;n<r;n++)(this.elements[n].alkaliRenderers||(this.elements[n].alkaliRenderers=[])).push(this)}else{if(!e.element)throw new Error("No element provided to Renderer");var i=this.element=e.element;(i.alkaliRenderers||(i.alkaliRenderers=[])).push(this)}if(e.update&&(this.updateRendering=e.update),e.shouldRender&&(this.shouldRender=e.shouldRender),e.renderUpdate&&(this.renderUpdate=e.renderUpdate),e.alwaysUpdate&&(this.alwaysUpdate=e.alwaysUpdate),!t.updated){var o=this;t.subscribe(function(e){o.variable={valueOf:function(){return e.value()}},o.updated()})}if(e.updateOnStart===!1){this.variable.valueOf(this);var a=this.contextualized||this.variable;a.notifies(this)}else this.updateRendering(!0)}function r(e){n.call(this,e)}function i(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function o(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function a(e){e.element&&"SELECT"===e.element.tagName&&"value"===e.name&&(this.renderUpdate=this.renderSelectValueUpdate),o.apply(this,arguments)}function s(e){e.name&&(this.name=e.name),r.apply(this,arguments)}function u(e){r.apply(this,arguments)}function c(e){this.position=e.position,this.textNode=e.textNode,r.apply(this,arguments)}function l(e){e.each&&(this.each=e.each),r.apply(this,arguments)}function f(e){if(e.alkaliRenderers)for(var t=e.alkaliRenderers,n=0;n<t.length;n++){var r=t[n];r.variable.stopNotifies(r)}}var p,h,d=("undefined"!=typeof document&&document,[]),v=1,y=e.requestAnimationFrame;t.Context;return n.prototype={constructor:n,updateRendering:function(){throw new Error("updateRendering must be implemented by sub class of Renderer")},updated:function(e,t,n){if(!this.invalidated&&(!n||this.contextMatches(n))){this.invalidated=!0;var r=this;y(function(){p=null,r.updateRendering(r.alwaysUpdate)})}},newContext:function(){return new t.Context(this.element)},addInput:function(e){this.contextualized=e},getContextualized:function(){return this.contextualized},specify:function(e){return this.newContext().specify(e)},merge:function(){},contextMatches:function(e){return!0},invalidateElement:function(t){p||(p=new WeakMap(null,"invalidated"));var n=p.get(t);p.set(t,n={}),n[id]||(n[id]=!0),h||(e.queueTask(processQueue),h=!0);var r=this;d.push(function(){r.invalidated=!1,r.updateElement(t)})},getId:function(){return this.id||(this.id=v++)},stop:function(){var e=this.contextualized||this.variable;e.stopNotifies(this)}},r.prototype=Object.create(n.prototype),r.prototype.shouldRender=function(e){return document.body.contains(e)},r.prototype.getSubject=function(){return this.element},r.prototype.updateRendering=function(e,t){if(!t&&this.elements){var n=this.elements;if(!n.length){if(!this.selector)throw new Error("No element or selector was provided to the Renderer");return void(n=document.querySelectorAll(this.selector))}for(var r=0,i=n.length;r<i;r++)this.updateRendering(e,n[r])}else{var o=t||this.element;if(e||this.shouldRender(o))this.updateElement(o);else{var a=this.getId(),s=o.renderersOnShow;s||(s=o.renderersOnShow=[],o.className+=" needs-rerendering"),s[a]||(s[a]=this)}}},r.prototype.addElement=function(e){this.selector?e.renderersOnShow=[this]:this.elements.push(e),this.updateElement(e)},r.prototype.updateElement=function(e){this.invalidated=!1;try{if(!this.omitValueOf){var t=this.variable.valueOf(this),n=this.contextualized||this.variable;n.notifies(this)}}catch(r){e.appendChild(document.createTextNode(r))}if(void 0!==t||this.started||this.omitValueOf)if(this.started=!0,t&&t.then){this.renderLoading&&this.renderLoading(t,e);var i=this;t.then(function(t){i.renderUpdate(t,e)})}else this.renderUpdate(t,e)},r.prototype.renderUpdate=function(e,t){throw new Error("renderUpdate(newValue) must be implemented")},n.Renderer=n,n.ElementRenderer=r,i.prototype=Object.create(r.prototype),i.prototype.type="AttributeRenderer",i.prototype.renderUpdate=function(e,t){t.setAttribute(this.name,e)},n.AttributeRenderer=i,o.prototype=Object.create(r.prototype),o.prototype.type="PropertyRenderer",o.prototype.renderUpdate=function(e,t){t[this.name]=e},n.PropertyRenderer=o,a.prototype=Object.create(o.prototype),a.prototype.type="InputPropertyRenderer",a.prototype.renderUpdate=function(e,t){(null==e||"number"===t.type&&isNaN(e))&&(e=""),t[this.name]=e},a.prototype.renderSelectValueUpdate=function(t,n){n.value=t,n.value==t||n.value?n.eventualValue=void 0:(n.eventualValue=t,e.nextTurn(function(){n.eventualValue&&(n.value=n.eventualValue,n.eventualValue=void 0)}))},n.InputPropertyRenderer=a,s.prototype=Object.create(r.prototype),s.prototype.type="StyleRenderer",s.prototype.renderUpdate=function(e,t){t.style[this.name]=e},n.StyleRenderer=s,u.prototype=Object.create(r.prototype),u.prototype.type="ContentRenderer",u.prototype.renderUpdate=function(e,t){t.innerHTML="",void 0===e&&(e=""),t.appendChild(document.createTextNode(e))},n.ContentRenderer=u,c.prototype=Object.create(r.prototype),c.prototype.type="TextRenderer",c.prototype.updated=function(e,t){this.builtList&&("refresh"===e.type?(this.builtList=!1,this.omitValueOf=!1):(this.updates||(this.updates=[])).push(e)),r.prototype.updated.call(this,e,t)},c.prototype.renderUpdate=function(e,t){null==e&&(e=""),e.nodeType?(this.textNode&&this.textNode.parentNode==t?t.replaceChild(e,this.textNode):t.appendChild(e),this.textNode=e):e instanceof Array?(this.renderUpdate=l.prototype.renderUpdate,this.omitValueOf=!0,this.renderUpdate(e,t)):(this.textNode||t.childNodes[this.position]).nodeValue=e},n.TextRenderer=c,l.prototype=Object.create(r.prototype),l.prototype.updated=function(e,t){this.builtList&&("refresh"===e.type?(this.builtList=!1,this.omitValueOf=!1):(this.updates||(this.updates=[])).push(e)),r.prototype.updated.call(this,e,t)},l.prototype.type="ListRenderer",l.prototype.renderUpdate=function(e,t){function n(e,t,n){var a;i.create?a=i.create({parent:o,_item:e}):(a=i(e,o),a.create&&(a=a.create({parent:o,_item:e}))),n?(r.insertBefore(a,n),s.splice(t,0,a)):(r.appendChild(a),s.push(a))}var r,i=this.each||function(e){return e},o=this.element,a=this;if(this.builtList){var s=this.childElements,u=this.updates;r=o,u.forEach(function(e){if("refresh"===e.type){a.builtList=!1;for(var t=0,r=s.length;t<r;t++)o.removeChild(s[t]);a.renderUpdate()}else if(e.previousIndex>-1&&(o.removeChild(s[e.previousIndex]),s.splice(e.previousIndex,1)),e.index>-1){var i=s[e.index]||null;n(e.value,e.index,i)}}),this.updates=[]}else{this.builtList=!0,this.omitValueOf=!0,t.innerHTML="",r=document.createDocumentFragment();var s=this.childElements=[];i.defineHasOwn&&i.defineHasOwn(),e.forEach(function(e){n(e)});var c=this.contextualized||this.variable;c.notifies(this),o.appendChild(r)}},n.ListRenderer=l,n.onShowElement=function(e){y(function(){p=null;var t=[].slice.call(e.getElementsByClassName("needs-rerendering"));if(e.className.indexOf("needs-rerendering")>0){var n=[e];n.push.apply(n,t),t=n}for(var r=0,i=t.length;r<i;r++){var o=t[r],a=o.renderersOnShow;if(a){o.renderersOnShow=null,o.className=o.className.replace(/\s?needs\-rerendering\s?/g,"");for(var s in a){var u=a[s];u.updateElement(o)}}}})},n.onElementRemoval=function(e,t){t||f(e);for(var n=e.getElementsByTagName("*"),r=0,i=n.length;r<i;r++){var o=n[r];o.alkaliRenderers&&f(o)}},n}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3),n(2),n(6)],i=function(e,t,n){function r(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];r&&r._getAsObject&&(e[t]=r._getAsObject())}return e}function i(e,n){if("function"!=typeof e)throw new Error("react() must be called with a generator. You need to use the babel-plugin-transform-alkali plugin if you want to use reactive expressions");return n&&n.reverse&&(e.reverse=n.reverse),new t.GeneratorVariable(e)}var o=e.isGenerator,a=e.compose(t.Call,function(e,n){this.inputs=n,t.Call.apply(this,arguments)},{_getAsObject:function(){return this.transform.apply(this,r(this.inputs))}});return Object.assign(i,n),i.from=function(e,n){return e&&e.property?e:"function"==typeof e&&o(e)?i(e,n):t.from(e)},i.prop=function(e,t){if(e){if(e.property){var n=e[t];return void 0!==n?n:e.property(t)}return e[t]}},i.cond=function(e,t,r){return n["if"](e,n.choose(t,r))},i.fcall=function(e,n){return e.property&&"function"==typeof e?e.apply(null,r(n)):new t.Call(e,n)},i.mcall=function(e,n,i){var o=e[n];return"function"==typeof o&&o.property||"bind"===n?o.apply(e,r(i)):new t.Call(e[n].bind(e),i)},i.ncall=function(e,n){return e.property&&"function"==typeof e?new(e.bind.apply(e,[null].concat(r(n)))):new t.Call(function(){return new(e.bind.apply(e,[null].concat(arguments)))},n)},i.obj=function(e,t){return new a(e,t)},i}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(2)],i=function(e){function t(e){return i[e]||(i[e]=new Function("a","b","deny","return "+e))}function n(n,i,a,s,u,c){function l(e){e.precedence=a,e.infix=c!==!1}var f=function(e,t){var n=t[0],i=t[1];if(n&&n.put){var o=u(e,i&&i.valueOf());o!==r&&n.put(o)}else{if(!i||!i.put)return r;i.put(c(e,n&&n.valueOf()))}},p={apply:function(i,a){return s=t(s),u=u&&t(u),c=c&&t(c),s.reverse=f,o[n]=p=new e(s),l(p),a=Array.prototype.slice.call(a),a.push(r),p.apply(i,a)}};l(p),o[n]=p,o[i]=function(){return p.apply(null,arguments)}}var r=e.deny,i={},o={};return n("+","add",6,"a+b","a-b","a-b"),n("-","subtract",6,"a-b","a+b","b-a"),n("*","multiply",5,"a*b","a/b","a/b"),n("/","divide",5,"a/b","a*b","b/a"),n("?","if",16,"b[a?0:1]","a===b[0]||(a===b[1]?false:deny)","[a,b]"),n(":","choose",15,"[a,b]","a[0]?a[1]:deny","a[1]"),n("!","not",4,"!a","!a",!1),n("%","remainder",5,"a%b"),n(">","greater",8,"a>b"),n(">=","greaterOrEqual",8,"a>=b"),n("<","less",8,"a<b"),n("<=","lessOrEqual",8,"a<=b"),n("===","looseEqual",9,"a===b"),n("==","equal",9,"a==b"),n("&","and",8,"a&&b"),n("|","or",8,"a||b"),n("round","round",8,"Math.round(a*Math.pow(10,b||1))/Math.pow(10,b||1)","a","a"),o}.apply(t,r),!(void 0!==i&&(e.exports=i))},function(e,t,n){var r,i;r=[n(3),n(2)],i=function(e,t){function n(e,t,r){if(e&&"object"==typeof e){if(e instanceof Array){t=[];for(var i=0,o=e.length;i<o;i++)t[i]=n(e[i],null,r)}else{t&&"object"==typeof t||(t=r&&r.get(e),t||(t={},r&&r.set(e,t)));for(var i in e)t[i]=n(e[i],t[i],r)}return t}return e}var r=e.compose(t,function(n){this.copiedFrom=n,this.derivativeMap=new e.WeakMap(null,"derivative"),this.isDirty=new t((!1))},{valueOf:function(e){this.state&&(this.state=null);var t=this.copiedFrom.valueOf(e);if(t&&"object"==typeof t){var r=this.derivativeMap.get(t);return null==r&&(this.derivativeMap.set(t,r=n(t,void 0,this.derivativeMap)),this.setValue(r,e)),r}var i=this.getValue?this.getValue(e):this.value;return void 0===i?t:i},getCopyOf:function(e){var t=this.derivativeMap.get(e);return null==t&&this.derivativeMap.set(e,t=n(e,void 0,this.derivativeMap)),t},save:function(){var e=this.copiedFrom.valueOf(),t=n(this.valueOf(),e);e!==t?this.copiedFrom.put&&this.copiedFrom.put(t):this.copiedFrom.notifies&&this.copiedFrom.updated&&this.copiedFrom.updated(),this.isDirty.put(!1),this.onSave&&this.onSave()},revert:function(){var e=this.copiedFrom.valueOf();this.put(n(e,this.derivativeMap.get(e),this.derivativeMap)),this.isDirty.put(!1)},updated:function(){return this.isDirty.put(!0),t.prototype.updated.apply(this,arguments)}});return r}.apply(t,r),!(void 0!==i&&(e.exports=i))}])});
//# sourceMappingURL=index.js.map