{"version":3,"sources":["webpack://alkali/webpack/universalModuleDefinition","webpack://alkali/webpack/bootstrap","webpack://alkali/./util/lang.js","webpack://alkali/./Variable.js","webpack://alkali/(webpack)/buildin/global.js","webpack://alkali/./Renderer.js","webpack://alkali/./operators.js","webpack://alkali/./index.js","webpack://alkali/./Element.js","webpack://alkali/./reactive.js","webpack://alkali/./Copy.js","webpack://alkali/./util/ContextualPromise.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_AMD_DEFINE_FACTORY__","__WEBPACK_AMD_DEFINE_ARRAY__","__WEBPACK_AMD_DEFINE_RESULT__","getPrototypeOf","base","__proto__","setPrototypeOf","proto","getOwnPropertyDescriptor","error","hasFeatures","requestAnimationFrame","e","promise","Promise","MutationObserver","WeakMap","has","feature","SyncPromise","this","SyncErrorPromise","unhandledTimeout","setTimeout","console","then","onFulfilled","onRejected","result","catch","handler","finally","clearTimeout","observe","target","listener","addKey","keyFlag","descriptor","currentValue","targetAncestor","set","previousSet","previousGet","remove","timerStarted","setInterval","watchedObjects","length","diff","watchedCopies","listeners","copy","push","queuedListeners","queue","indexOf","lang","nextTurn","forEach","events","properties","unobserve","splice","previous","current","callback","queued","id","toJSONHidden","Hidden","extendClass","constructOrCall","toJSON","eval","possibleConstructOrCall","toRender","processAnimationFrame","renderer","execute","isResolved","resolution","errorResolution","reject","finished","resolve","errback","handle","newError","Set","elements","add","element","Map","map","values","mapProperty","intermediary","when","errorHandler","compose","Base","constructor","div","document","createElement","attributes","setAttribute","assign","source","deepCopy","Array","BaseClass","constructHandler","callHandler","Element","apply","arguments","buggyConstructorSetter","functionConstruct","args","SubClass","instance","isGenerator","func","displayName","isGeneratorIterator","iterator","next","spawn","generator","nextValue","isThrowing","generatorIterator","stepReturn","done","isSync","undefined","global","context","noChange","RequestChange","RequestSet","NOT_MODIFIED","toString","GET_TYPED_ARRAY","getTyped","GET_TYPED_OR_UNTYPED_ARRAY","allowUntyped","GET_VALID_TYPE","ensureValidType","propertyListenersMap","nextVersion","Date","now","listenerId","_propertyChange","propertyName","variable","contextFromCache","Context","subject","notifies","NotifyingContext","UpdateEvent","visited","ReplacedEvent","triggerEvent","PropertyChangeEvent","propertyEvent","parent","SplicedEvent","modifier","items","removed","start","deleteCount","EntryEvent","entryEvent","DeletedEvent","AddedEvent","assignPromise","Variable","with","newContext","executeWithin","executor","previousContext","version","restart","contextualize","parentContext","contextualized","distinctSubject","contextMap","_contextMap","sources","merge","setVersion","isNaN","Error","Math","max","childContext","specify","specifiedInstance","subjectMap","ownedClasses","instanceMap","createInstance","defaultInstance","getContextualized","matches","type","doesAffect","for","valueOf","_logStackTrace","v","stack","split","test","shift","coalesce","_debugOpts","shortStackTrace","some","line","re","log","__debug","replace","stackObject","join","VariablePrototype","allowPromise","gotValue","getValue","isAsyncPromise","currentContext","forChild","versionWithChildren","ifModifiedSince","observer","default","previousNotifyingValue","returnedVariable","stopNotifies","deferredContext","__variable","subscribe","PropertyClass","propertyVariable","_properties","TypeError","Class","isPropertyClass","getForClass","ContextualizedVariable","defaultContext","isWritable","fixed","_isWritable","onPropertyChange","updated","eachKey","Transform","slice","forDependencies","hasNotifyingChild","forPropertyNotifyingValues","hasChildNotifiers","subProperties","init","dependency","listeningToObject","cleanup","handles","updateVersion","dateBasedVersion","getVersion","getFullVersion","getSubject","selectVariable","getUpdates","since","updates","nextUpdateMap","_initUpdate","updateEvent","isDownstream","by","dependent","collection","invalidate","updateQueued","event","updateReceiver","unsubscribe","index","put","changeValue","oldValue","deniedPut","copiedFrom","undefine","is","newValue","parentEvent","proxy","proxiedVariable","complete","save","onValue","String","to","transformFunction","reverse","_Transform","as","whileResolving","valueUntilResolved","useLastValue","WhileResolving","validate","schema","required","valid","isValid","structured","structure","keys","existing","observeObject","observerCount","j","el","autoObserveObjects","registerListener","deregisterListener","deliverChanges","getCollectionOf","collectionOf","_sN","_debug","random","newObject","defineProperties","=","_lastUpdated","parentSchemaProperties","validation","Validating","arrayToModify","cachedValue","array","typedArray","newArray","startingIndex","atEnd","spliceArgs","results","concat","untypedItems","item","from","addedCount","arrayPosition","_typedVersion","cachedVersion","Type","NewType","names","getOwnPropertyNames","ExtendedVariable","writable","toType","VArray","of","VString","VNumber","VBoolean","isPrimitive","getDescriptor","warn","getGeneratorDescriptor","defineAs","generalizeMethod","configurable","hasOwn","Target","createForInstance","_defaultInstance","VMap","transform","dontCache","getTransform","readyState","isFinite","staysUpdated","isAsyncInputs","transformContext","argument","argumentName","lastPromiseResult","resolved","remaining","whenArgumentResolved","__index","whenAllResolved","__previousPromiseResult","promiseSafeResult","isPromise","abort","replacedResolutionWith","onResolve","lastError","getArguments","whenStrict","originalValue","setReverse","defaultValue","ContextualTransform","contextualizedVariable","_needsContextualization","Item","content","generic","makeSubVar","varray","sortFunction","_sortedArray","reversed","sort","doSplice","unshift","pop","compareFunction","combined","typed","untyped","a","b","_typedArray","end","idOrValue","includes","delete","instanceOrId","removeIndex","clear","setToArray","ArrayClass","VCollection","GeneratorVariable","resuming","generatorContext","oldSources","newLength","newSources","argsToArray","arg","all","keyMapping","valueArray","resultObject","getGeneralizedDescriptor","method","description","contains","instanceForContext","proxyHandler","deleteProperty","ownKeys","VFunction","VMethod","Number","Boolean","VSet","Proxy","_collectionOf","ItemClass","_collection","Collection","generalize","prototypeNames","Function","returns","wrapsType","returnValue","charAt","codeCharAt","lastIndexOf","match","substr","toUpperCase","toLowerCase","toFixed","toExponential","toPrecision","toLocaleString","_array","sourceContext","reactive","entry","getId","VDate","toDateString","toTimeString","toGMTString","toUTCString","getTime","setTime","VPromise","deny","react","options","delayUpdate","originalUpdated","enqueueUpdate","update","objectUpdated","_changeValue","getNextVersion","IterativeMethod","source1","source2","_mappedItems","wrapped","defineIterativeFunction","definedOn","IterativeResults","iteratee","arg2","filterFunction","filter","toAdd","newItems","toRemove","untypedArray","keyGenerator","valueGenerator","hasKeyFunction","hasValueFunction","hasKey","emit","group","variables","g","devtoolsFormatters","header","config","variableTime","hasBody","request","body","float","VariableExports","invalidatedElements","nextId","Renderer","selector","getElements","alkaliRenderers","updateRendering","shouldRender","renderUpdate","alwaysUpdate","updateOnStart","ElementRenderer","AttributeRenderer","PropertyRenderer","InputPropertyRenderer","tagName","renderSelectValueUpdate","StyleRenderer","ContentRenderer","TextRenderer","position","textNode","ListRenderer","each","onElementRemoval","renderers","invalidated","deferredRender","isCanceled","contextMatches","invalidateElement","invalidatedParts","queueTask","processQueue","updateElement","stop","builtList","omitValueOf","isSameProperty","always","querySelectorAll","thisElement","renderersOnShow","className","addElement","started","generalized","_generalized","rendererIdentifier","renderLoading","removeAttribute","eventualValue","style","innerHTML","appendChild","createTextNode","nodeType","parentNode","replaceChild","childNodes","nodeValue","childElements","removeChild","nextChild","newElement","append","eachItem","insertBefore","defineHasOwn","renderEach","childElement","_item","onShowElement","shownElement","getElementsByClassName","includingTop","onlyChildren","children","getElementsByTagName","child","operatingFunctions","operators","getOperatingFunction","expression","operator","precedence","forward","reverseA","reverseB","output","inputs","firstError","message","operatorHandler","addFlags","infix","Copy","ContextualPromise","main","localGlobal","alkali","canExtendBuiltinElements","SELECTOR_REGEX","definition","styleDefinitions","construct","Reflect","Constructor","ClassNameRenderer","currentClassName","changingClassName","PropertiesRenderer","newProperties","lastProperties","doc","tag","addEventListener","INPUT","TEXTAREA","testElement","originalConstructor","booleanStyle","defaultStyle","directStyle","styleSheet","display","visibility","color","opacity","zoom","minZoom","maxZoom","fontWeight","textDecoration","presumptiveParentMap","createCssRule","styleSheetElement","head","firstChild","sheet","cssRules","rules","insertRule","layoutChildren","container","prepend","fragment","createDocumentFragment","childNode","ref","isIterable","variableAsContent","currentParent","isContentNode","contentNode","bidirectionalHandler","bindChanges","noop","propertyHandlers","_generators","classes","isArray","flag","class","applyAttribute","role","render","dataset","applySubProperties","styleObjectHandler","From","ownedInstances","setForClass","HTMLElement","_propertyHandlers","elementPropertyHandlers","input","valueAsNumber","valueAsDate","checked","select","textarea","area","button","details","dialog","embed","fieldset","form","frame","frameset","iframe","img","option","optgroup","label","td","th","script","track","link","meta","meter","progress","del","ins","video","keygen","param","SubPropertyRenderer","subKey","subValue","assignProperties","styleDefinition","VariableClass","propertyHandler","buildContent","itemVariable","inputType","inputProperty","date","datetime","time","conversion","buildInputContent","inputEvents","parseFloat","mergeObject","radios","radio","dispatchEvent","Event","classHandlers","shadow","applyToConstructor","applyOnCreate","_applyOnCreate","getApplySet","parentApplySet","disallowClassEventHandlers","renderDescriptor","renderMethod","withProperties","isNativeElement","isNativeClass","makeElementConstructor","defineElement","forTarget","propertyForElement","selectorMatch","_ElementClass","_BaseElementClass","hasArguments","created","ready","ElementApplyOnCreate","customGenerators","styleGenerators","nativeGenerators","generators","assignGenerators","attachShadow","tagSelector","extendElement","nativeTagName","customElements","TestSupport","extends","HTMLDivElement","bindElementClass","uniqueTag","setupElement","startingRenderers","endingRenderers","newIndex","oldIndex","within","elementName","ElementClass","tags","HTMLInputElement","generateInputs","HTMLConstructor","_constructor","props","assigned","handlers","aliases","Anchor","Image","Paragraph","Textarea","DList","UList","OList","ListItem","Text","TextInput","TableRow","TableCell","TableHeaderCell","TableHeader","TableBody","alias","makePreBoundVariable","cssRule","preBoundProperties","BoundElement","getElementInstances","_cssRule","selectorText","newChildren","elementMap","ThisElementVariable","_Variable","elementOverlay","variableProperties","refresh","moveLiveElementsEnabled","Content","hasInstance","extend","ExtendedElement","lifeStates","nodes","action","detached","needsRestart","attached","firstVisit","node","state","__alkaliAttached__","mutations","il","mutation","jl","nodeIteration","k","kl","baseNode","currentNode","nextNode","nextSibling","childList","subtree","distinctive","generics","getDistinctElement","preserveObjects","_getAsObject","typeMappings","fromValue","isProperty","deferObject","objectVar","propertyValue","defineValueProperty","getType","hasKeys","typedObject","getp","directPropertyValue","prop","cond","consequent","alternate","if","choose","fcall","mcall","ncall","obj","val","cls","definitions","derivativeMap","isDirty","sync","forModification","derivative","getCopyOf","original","onSave","revert","getExecutor","ContextualPromiseFromPromise","startPromises","promises","contextualizedPromises","hasAbort","propagateAbort","assignAbort","originalPromise","contextualPromise","onResolved","isContextual","startedPromises","race"],"mappings":"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wW,KAAA,UAAA6L,EAAA,uBAEA0P,eAAA71B,OAAAmmB,EAAA1c,EAAA,CAA+CssB,QAAAJ,IAC/ClsB,EAAAqrB,cAAArrB,EACAksB,IACAlsB,EAAAsrB,kBAAAc,eAAA10B,IAAAw0B,IAAArJ,EAAAvjB,cAAA4sB,GAAA/sB,cAEK,MAAA7F,GACLe,QAAAwW,KAAAvX,IAOA,OAHA0G,EAAAoE,OACApE,EAAAoE,KAAAymB,GAEA2B,GAAAxsB,EAAA,CACA8b,WACA2Q,WAAA,IAIA,IAAAzsB,GAAA0sB,GAAA,oBAAAlG,wBAAA,cAEAxmB,GAAAirB,iBACAjrB,GAAAP,OAAA,SAAA1E,EAAA2B,GACA,sBAAA3B,EAEAyvB,EAAAzvB,GACAsvB,EAAA3tB,EAAA3B,OACG,CAGH,IAAAqiB,EAAAriB,EAAAihB,gBACA2Q,EAAAvP,IAAAvhB,OAAA,EACAktB,EAAAhuB,EAAA2B,GAGA,IAFA,IAAAkwB,EAAAxP,IAAAvhB,OAAA,EAEAgxB,EAAAF,EAAyCE,EAAAD,EAA4BC,IACrE,QAAAC,EAAA,EAA0BA,EAAAH,EAA8BG,IACxD1P,EAAA0P,GAAA7O,eAAAb,EAAAyP,MACAzP,EAAA0P,GAAAhP,OACAV,EAAAxgB,OAAAkwB,EAAA,GAEAA,GAAA,EACAH,IACAC,OAOA5sB,GAAA+sB,OAAA,SAAAtuB,KAIA,CACA,QACA,SACA,QACA,QACA,KACA,IACA,QACA,QACA,WACA,WACA,QACA,QACA,QACA,KACA,QACA,MACA,WACA,KACA,KACA,UACA,MACA,MACA,QACA,SACA,OACA,QACA,SACA,SACA,SACA,IACA,QACA,WACA,MACA,UACA,QACA,IACA,SACA,SACA,WACA,SACA,KACA,MACA,IACA,MACA,QACA,OACA,OACA,MACA,OACA,SACA,QACA,KACA,SACA,QACA,MACA,SACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,WACA,QACA,OACA,OACA,WACA,QACA,KACA,OACA,OACA,MACA,IACA,UACA,QACA,OACA,SACA,SACA,aACA,SACA,OACA,OACA,WACA,MACA,UACA,OAC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","file":"./index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"alkali\"] = factory();\n\telse\n\t\troot[\"alkali\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine([], factory) } else if (typeof module === 'object' && module.exports) {\r\n\tmodule.exports = factory() // Node\r\n}}(this, function () {\r\n\tvar getPrototypeOf = Object.getPrototypeOf || (function(base) { return base.__proto__ })\r\n\tvar setPrototypeOf = Object.setPrototypeOf || (function(base, proto) {\r\n\t\tfor (var key in proto) {\r\n\t\t\ttry {\r\n\t\t\t\tif (!base.hasOwnProperty(key)) {\r\n\t\t\t\t\tif (proto.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tObject.defineProperty(base, key,\r\n\t\t\t\t\t\t\tObject.getOwnPropertyDescriptor(proto, key))\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbase[key] = proto[key]\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch(error) {}\r\n\t\t}\r\n\t})\r\n\tvar hasFeatures = {\r\n\t\trequestAnimationFrame: typeof requestAnimationFrame != 'undefined',\r\n\t\tdefineProperty: Object.defineProperty && (function() {\r\n\t\t\ttry{\r\n\t\t\t\tObject.defineProperty({}, 't', {})\r\n\t\t\t\treturn true\r\n\t\t\t}catch(e) {\r\n\t\t\t}\r\n\t\t})(),\r\n\t\tpromise: typeof Promise !== 'undefined',\r\n\t\tMutationObserver: typeof MutationObserver !== 'undefined',\r\n\t\t'WeakMap': typeof WeakMap === 'function'\r\n\t}\r\n\tfunction has(feature) {\r\n\t\treturn hasFeatures[feature]\r\n\t}\r\n\r\n\tfunction SyncPromise(value) {\r\n\t\tthis.value = value\r\n\t}\r\n\tSyncPromise.prototype = {\r\n\t\tthen: function(onFulfilled, onRejected) {\r\n\t\t\tif (!onFulfilled) {\r\n\t\t\t\treturn new SyncPromise(this.value)\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\tvar result = onFulfilled(this.value)\r\n\t\t\t\treturn (result && result.then) ? result : new SyncPromise(result)\r\n\t\t\t} catch(error) {\r\n\t\t\t\treturn new SyncErrorPromise(error)\r\n\t\t\t}\r\n\t\t},\r\n\t\tcatch: function(handler) {\r\n\t\t\treturn this.then(null, handler)\r\n\t\t},\r\n\t\tfinally: function(handler) {\r\n\t\t\thandler()\r\n\t\t\treturn this\r\n\t\t}\r\n\t}\r\n\tfunction SyncErrorPromise(error) {\r\n\t\tthis.value = error\r\n\t\tthis.unhandledTimeout = setTimeout(function() {\r\n\t\t\tconsole.error('Uncaught (in promise)', error)\r\n\t\t})\r\n\t}\r\n\tSyncErrorPromise.prototype = new SyncPromise()\r\n\tSyncErrorPromise.prototype.then = function(onFulfilled, onRejected) {\r\n\t\tclearTimeout(this.unhandledTimeout)\r\n\t\tif (!onRejected) {\r\n\t\t\treturn new SyncErrorPromise(this.value)\r\n\t\t}\r\n\t\treturn SyncPromise.prototype.then.call(this, onRejected)\r\n\t}\r\n\t// This is an polyfill for Object.observe with just enough functionality\r\n\t// for what Variables need\r\n\t// An observe function, with polyfile\r\n\tvar observe =\r\n\t\thas('defineProperty') ?\r\n\t\tfunction observe(target, listener) {\r\n\t\t\t/*for(var i in target) {\r\n\t\t\t\taddKey(i)\r\n\t\t\t}*/\r\n\t\t\tlistener.addKey = addKey\r\n\t\t\tlistener.remove = function() {\r\n\t\t\t\tlistener = null\r\n\t\t\t}\r\n\t\t\treturn listener\r\n\t\t\tfunction addKey(key) {\r\n\t\t\t\tvar keyFlag = 'key' + key\r\n\t\t\t\tif(this[keyFlag]) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis[keyFlag] = true\r\n\t\t\t\t}\r\n\t\t\t\tvar currentValue = target[key]\r\n\t\t\t\tvar targetAncestor = target\r\n\t\t\t\tvar descriptor\r\n\t\t\t\tdo {\r\n\t\t\t\t\tdescriptor = Object.getOwnPropertyDescriptor(targetAncestor, key)\r\n\t\t\t\t} while(!descriptor && (targetAncestor = getPrototypeOf(targetAncestor)))\r\n\r\n\t\t\t\tif(descriptor && descriptor.set) {\r\n\t\t\t\t\tvar previousSet = descriptor.set\r\n\t\t\t\t\tvar previousGet = descriptor.get\r\n\t\t\t\t\tObject.defineProperty(target, key, {\r\n\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\treturn (currentValue = previousGet.call(this))\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset: function(value) {\r\n\t\t\t\t\t\t\tpreviousSet.call(this, value)\r\n\t\t\t\t\t\t\tif(currentValue !== value) {\r\n\t\t\t\t\t\t\t\tcurrentValue = value\r\n\t\t\t\t\t\t\t\tif(listener) {\r\n\t\t\t\t\t\t\t\t\tlistener([{target: this, name: key}])\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tenumerable: descriptor.enumerable\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tObject.defineProperty(target, key, {\r\n\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\treturn currentValue\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tset: function(value) {\r\n\t\t\t\t\t\t\tif(currentValue !== value) {\r\n\t\t\t\t\t\t\t\tcurrentValue = value\r\n\t\t\t\t\t\t\t\tif(listener) {\r\n\t\t\t\t\t\t\t\t\tlistener([{target: this, name: key}])\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tenumerable: !descriptor || descriptor.enumerable\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} :\r\n\t\t// and finally a polling-based solution, for the really old browsers\r\n\t\tfunction(target, listener) {\r\n\t\t\tif(!timerStarted) {\r\n\t\t\t\ttimerStarted = true\r\n\t\t\t\tsetInterval(function() {\r\n\t\t\t\t\tfor(var i = 0, l = watchedObjects.length; i < l; i++) {\r\n\t\t\t\t\t\tdiff(watchedCopies[i], watchedObjects[i], listeners[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 20)\r\n\t\t\t}\r\n\t\t\tvar copy = {}\r\n\t\t\tfor(var i in target) {\r\n\t\t\t\tif(target.hasOwnProperty(i)) {\r\n\t\t\t\t\tcopy[i] = target[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twatchedObjects.push(target)\r\n\t\t\twatchedCopies.push(copy)\r\n\t\t\tlisteners.push(listener)\r\n\t\t}\r\n\tvar queuedListeners\r\n\tfunction queue(listener, object, name) {\r\n\t\tif(queuedListeners) {\r\n\t\t\tif(queuedListeners.indexOf(listener) === -1) {\r\n\t\t\t\tqueuedListeners.push(listener)\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tqueuedListeners = [listener]\r\n\t\t\tlang.nextTurn(function() {\r\n\t\t\t\tqueuedListeners.forEach(function(listener) {\r\n\t\t\t\t\tvar events = []\r\n\t\t\t\t\tlistener.properties.forEach(function(property) {\r\n\t\t\t\t\t\tevents.push({target: listener.object, name: property})\r\n\t\t\t\t\t})\r\n\t\t\t\t\tlistener(events)\r\n\t\t\t\t\tlistener.object = null\r\n\t\t\t\t\tlistener.properties = null\r\n\t\t\t\t})\r\n\t\t\t\tqueuedListeners = null\r\n\t\t\t}, 0)\r\n\t\t}\r\n\t\tlistener.object = object\r\n\t\tvar properties = listener.properties || (listener.properties = [])\r\n\t\tif(properties.indexOf(name) === -1) {\r\n\t\t\tproperties.push(name)\r\n\t\t}\r\n\t}\r\n\tvar unobserve = has('observe') ? Object.unobserve :\r\n\t\tfunction(target, listener) {\r\n\t\t\tif(listener.remove) {\r\n\t\t\t\tlistener.remove()\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, l = watchedObjects.length; i < l; i++) {\r\n\t\t\t\tif(watchedObjects[i] === target && listeners[i] === listener) {\r\n\t\t\t\t\twatchedObjects.splice(i, 1)\r\n\t\t\t\t\twatchedCopies.splice(i, 1)\r\n\t\t\t\t\tlisteners.splice(i, 1)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\tvar watchedObjects = []\r\n\tvar watchedCopies = []\r\n\tvar listeners = []\r\n\tvar timerStarted = false\r\n\tfunction diff(previous, current, callback) {\r\n\t\t// TODO: keep an array of properties for each watch for faster iteration\r\n\t\tvar queued\r\n\t\tfor(var i in previous) {\r\n\t\t\tif(previous.hasOwnProperty(i) && previous[i] !== current[i]) {\r\n\t\t\t\t// a property has changed\r\n\t\t\t\tprevious[i] = current[i]\r\n\t\t\t\t(queued || (queued = [])).push({name: i})\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor(var i in current) {\r\n\t\t\tif(current.hasOwnProperty(i) && !previous.hasOwnProperty(i)) {\r\n\t\t\t\t// a property has been added\r\n\t\t\t\tprevious[i] = current[i]\r\n\t\t\t\t(queued || (queued = [])).push({name: i})\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(queued) {\r\n\t\t\tcallback(queued)\r\n\t\t}\r\n\t}\r\n\r\n\tvar id = 1\r\n\t// a function that returns a function, to stop JSON serialization of an\r\n\t// object\r\n\tfunction toJSONHidden() {\r\n\t\treturn toJSONHidden\r\n\t}\r\n\t// An object that will be hidden from JSON serialization\r\n\tvar Hidden = function () {\r\n\t}\r\n\tHidden.prototype.toJSON = toJSONHidden\r\n\r\n\tvar extendClass, constructOrCall\r\n\ttry {\r\n\t\t// do this with an eval to avoid syntax errors in browsers that do not support class and new.target\r\n\t\textendClass = eval('(function(Base){ return class extends Base {}})\\n\\n//# sourceURL=class-extend')\r\n\t\tvar possibleConstructOrCall = eval('\"use strict\";(function(BaseClass, constructHandler, callHandler, constructClass){ return function Element() { return this instanceof Element ? constructHandler ? constructHandler.apply(new.target || this.constructor, arguments) : constructClass ? Reflect.construct(BaseClass, arguments, new.target || this.constructor) : lang.functionConstruct(BaseClass, arguments, new.target || this.constructor, this) : callHandler.apply(Element, arguments) } })\\n\\n//# sourceURL=construct-or-call')\r\n\t\t// actually using new.target bombs in Edge, so it is basically unusable\r\n\t\tnew (possibleConstructOrCall(function() {}, function() {}))()\r\n\t\tconstructOrCall = possibleConstructOrCall\r\n\t} catch(e) {\r\n\t}\r\n\r\n\tvar lang = {\r\n\t\trequestAnimationFrame: has('requestAnimationFrame') ? requestAnimationFrame :\r\n\t\t\t(function() {\r\n\t\t\t\tvar toRender = []\r\n\t\t\t\tvar queued = false\r\n\t\t\t\tfunction processAnimationFrame() {\r\n\t\t\t\t\tfor (var i = 0; i < toRender.length; i++) {\r\n\t\t\t\t\t\ttoRender[i]()\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoRender = []\r\n\t\t\t\t\tqueued = false\r\n\t\t\t\t}\r\n\t\t\t\tfunction requestAnimationFrame(renderer) {\r\n\t\t\t\t \tif (!queued) {\r\n\t\t\t\t\t\tsetTimeout(processAnimationFrame)\r\n\t\t\t\t\t\tqueued = true\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoRender.push(renderer)\r\n\t\t\t\t}\r\n\t\t\t\treturn requestAnimationFrame\r\n\t\t\t})(),\r\n\t\tSyncPromise: SyncPromise,\r\n\t\tPromise: has('promise') ? Promise : (function() {\r\n\t\t\tfunction Promise(execute) {\r\n\t\t\t\tvar isResolved, resolution, errorResolution\r\n\t\t\t\tvar queue = 0\r\n\t\t\t\tfunction resolve(value) {\r\n\t\t\t\t\t// resolve function\r\n\t\t\t\t\tif(value && value.then) {\r\n\t\t\t\t\t\t// received a promise, wait for it\r\n\t\t\t\t\t\tvalue.then(resolve, reject)\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tresolution = value\r\n\t\t\t\t\t\tfinished()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfunction reject(error) {\r\n\t\t\t\t\t// reject function\r\n\t\t\t\t\terrorResolution = error\r\n\t\t\t\t\tfinished()\r\n\t\t\t\t}\r\n\t\t\t\texecute(resolve, reject)\r\n\t\t\t\tfunction finished() {\r\n\t\t\t\t\tisResolved = true\r\n\t\t\t\t\tfor(var i = 0, l = queue.length; i < l; i++) {\r\n\t\t\t\t\t\tqueue[i]()\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// clean out the memory\r\n\t\t\t\t\tqueue = 0\r\n\t\t\t\t}\r\n\t\t\t\treturn {\r\n\t\t\t\t\tthen: function(callback, errback) {\r\n\t\t\t\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\t\t\t\tfunction handle() {\r\n\t\t\t\t\t\t\t\t// promise fulfilled, call the appropriate callback\r\n\t\t\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\t\t\tif(errorResolution && !errback) {\r\n\t\t\t\t\t\t\t\t\t\t// errors without a handler flow through\r\n\t\t\t\t\t\t\t\t\t\treject(errorResolution)\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t// resolve to the callback's result\r\n\t\t\t\t\t\t\t\t\t\tresolve(errorResolution ?\r\n\t\t\t\t\t\t\t\t\t\t\terrback(errorResolution) :\r\n\t\t\t\t\t\t\t\t\t\t\tcallback ?\r\n\t\t\t\t\t\t\t\t\t\t\t\tcallback(resolution) : resolution)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}catch(newError) {\r\n\t\t\t\t\t\t\t\t\t// caught an error, reject the returned promise\r\n\t\t\t\t\t\t\t\t\treject(newError)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(isResolved) {\r\n\t\t\t\t\t\t\t\t// already resolved, immediately handle\r\n\t\t\t\t\t\t\t\thandle()\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t(queue || (queue = [])).push(handle)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn Promise\r\n\t\t}()),\r\n\t\tSet: typeof Set !== 'undefined' ?\r\n\t\t\tnew Set(['a']).length ? Set :\r\n\t\t\tfunction (elements) { // IE 11 doesn't support arguments to constructor\r\n\t\t\t\tvar set = new Set()\r\n\t\t\t\tif (elements) {\r\n\t\t\t\t\tfor (var i = 0; i < elements.length; i++) {\r\n\t\t\t\t\t\tset.add(elements[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn set\r\n\t\t\t} :\r\n\t\tfunction (elements) {\r\n\t\t\telements = elements || []\r\n\t\t\treturn {\r\n\t\t\t\tadd: function(element) {\r\n\t\t\t\t\tif (!this.has(element)) {\r\n\t\t\t\t\t\telements.push(element)\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\thas: function(element) {\r\n\t\t\t\t\treturn elements.indexOf(element) > -1\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tMap: typeof Map !== 'undefined' ? Map : function () {\r\n\t\t\tvar map = Object.create(null)\r\n\t\t\treturn {\r\n\t\t\t\tset: function(key, value) {\r\n\t\t\t\t\tmap[key] = value\r\n\t\t\t\t},\r\n\t\t\t\thas: function(element) {\r\n\t\t\t\t\treturn Object.prototype.hasOwnProperty.call(map, key)\r\n\t\t\t\t},\r\n\t\t\t\tget: function(key) {\r\n\t\t\t\t\treturn map[key]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tWeakMap: has('WeakMap') ? WeakMap :\r\n\t \tfunction (values, name) {\r\n\t \t\tvar mapProperty = '__' + (name || '') + id++\r\n\t \t\treturn has('defineProperty') ?\r\n\t \t\t{\r\n\t \t\t\tget: function (key) {\r\n\t \t\t\t\treturn key[mapProperty]\r\n\t \t\t\t},\r\n\t \t\t\tset: function (key, value) {\r\n\t \t\t\t\tObject.defineProperty(key, mapProperty, {\r\n\t \t\t\t\t\tvalue: value,\r\n\t \t\t\t\t\tenumerable: false\r\n\t \t\t\t\t})\r\n\t \t\t\t}\r\n\t \t\t} :\r\n\t \t\t{\r\n\t \t\t\tget: function (key) {\r\n\t \t\t\t\tvar intermediary = key[mapProperty]\r\n\t \t\t\t\treturn intermediary && intermediary.value\r\n\t \t\t\t},\r\n\t \t\t\tset: function (key, value) {\r\n\t \t\t\t\t// we use an intermediary that is hidden from JSON serialization, at least\r\n\t \t\t\t\tvar intermediary = key[mapProperty] || (key[mapProperty] = new Hidden())\r\n\t \t\t\t\tintermediary.value = value\r\n\t \t\t\t}\r\n\t \t\t}\r\n\t \t},\r\n\r\n\t\tobserve: observe,\r\n\t\tunobserve: unobserve,\r\n\t\textendClass: extendClass,\r\n\t\twhen: function(value, callback, errorHandler) {\r\n\t\t\treturn value && value.then ?\r\n\t\t\t\t(value.then(callback, errorHandler) || value) : callback(value)\r\n\t\t},\r\n\t\tcompose: function(Base, constructor, properties) {\r\n\t\t\tvar prototype = constructor.prototype = Object.create(Base.prototype)\r\n\t\t\tsetPrototypeOf(constructor, Base)\r\n\t\t\tfor(var i in properties) {\r\n\t\t\t\tprototype[i] = properties[i]\r\n\t\t\t}\r\n\t\t\tprototype.constructor = constructor\r\n\t\t\treturn constructor\r\n\t\t},\r\n\t\tsetPrototypeOf: setPrototypeOf,\r\n\t\tnextTurn: has('MutationObserver') ?\r\n\t\t\tfunction (callback) {\r\n\t\t\t\t// promises don't resolve consistently on the next micro turn (Edge doesn't do it right),\r\n\t\t\t\t// so use mutation observer\r\n\t\t\t\t// TODO: make a faster mode that doesn't recreate each time\r\n\t\t\t\tvar div = document.createElement('div')\r\n\t\t\t\tvar observer = new MutationObserver(callback)\r\n\t\t\t\tobserver.observe(div, {\r\n\t\t\t\t\tattributes: true\r\n\t\t\t\t})\r\n\t\t\t\tdiv.setAttribute('a', id++)\r\n\t\t\t} :\r\n\t\t\tfunction (callback) {\r\n\t\t\t\t// TODO: we can do better for other, older browsers\r\n\t\t\t\tsetTimeout(callback, 0)\r\n\t\t\t},\r\n\t\tcopy: Object.assign || function(target, source) {\r\n\t\t\tfor(var i in source) {\r\n\t\t\t\ttarget[i] = source[i]\r\n\t\t\t}\r\n\t\t\treturn target\r\n\t\t},\r\n\t\tdeepCopy: function(source) {\r\n\t\t\tif (source && typeof source == 'object') {\r\n\t\t\t\tif (source instanceof Array) {\r\n\t\t\t\t\tvar target = [] // always create a new array for array targets\r\n\t\t\t\t\tfor(var i = 0, l = source.length; i < l; i++) {\r\n\t\t\t\t\t\ttarget[i] = lang.deepCopy(source[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar target = {}\r\n\t\t\t\t\tfor (var i in source) {\r\n\t\t\t\t\t\ttarget[i] = lang.deepCopy(source[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn target\r\n\t\t\t}\r\n\t\t\treturn source\r\n\t\t},\r\n\t\tconstructOrCall: constructOrCall || function(BaseClass, constructHandler, callHandler) {\r\n\t\t\treturn function Element() {\r\n\t\t\t\tif (this instanceof Element) {\r\n\t\t\t\t\tif (!this.hasOwnProperty('constructor') && Element.prototype === getPrototypeOf(this)) {\r\n\t\t\t\t\t\tif (constructHandler) {\r\n\t\t\t\t\t\t\treturn constructHandler.apply(Element, arguments)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (lang.buggyConstructorSetter) {\r\n\t\t\t\t\t\t\t// in safari, directly setting the constructor messes up the native prototype\r\n\t\t\t\t\t\t\tObject.defineProperty(this, 'constructor', { value: Element })\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.constructor = Element\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (constructHandler) {\r\n\t\t\t\t\t\treturn constructHandler.apply(this.constructor, arguments)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn BaseClass.apply(this, arguments)\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn callHandler.apply(Element, arguments)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfunctionConstruct: function(BaseClass, args, SubClass, instance) {\r\n\t\t\tif (!instance.hasOwnProperty('constructor') && SubClass.prototype === Object.getPrototypeOf(instance)) {\r\n\t\t\t\tinstance = Object.create(SubClass.prototype)\r\n\t\t\t\tif (lang.buggyConstructorSetter) {\r\n\t\t\t\t\t// in safari, directly setting the constructor messes up the native prototype\r\n\t\t\t\t\tObject.defineProperty(instance, 'constructor', { value: SubClass })\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinstance.constructor = SubClass\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn BaseClass.apply(instance, args)\r\n\t\t}\r\n\t}\r\n\tfunction isGenerator(func) {\r\n\t\tif (typeof func === 'function') {\r\n\t\t\tvar constructor = func.constructor\r\n\t\t\t// this is used to handle both native generators and transpiled generators\r\n\t\t\treturn (constructor.displayName || constructor.name) === 'GeneratorFunction'\r\n\t\t}\r\n\t}\r\n\tfunction isGeneratorIterator(iterator) {\r\n\t\tif (iterator && iterator.next) {\r\n\t\t\tvar constructor = iterator.constructor.constructor\r\n\t\t\treturn (constructor.displayName || constructor.name) === 'GeneratorFunction'\r\n\t\t}\r\n\t}\r\n\tlang.isGenerator = isGenerator\r\n\r\n\tfunction spawn(generator) {\r\n\t\tvar generatorIterator = typeof generator === 'function' ? generator() : generator\r\n\t\tvar resuming\r\n\t\tvar nextValue\r\n\t\tvar isThrowing\r\n\t\treturn next()\r\n\t\tfunction next() {\r\n\t\t\tdo {\r\n\t\t\t\tvar stepReturn = generatorIterator[isThrowing ? 'throw' : 'next'](nextValue)\r\n\t\t\t\tif (stepReturn.done) {\r\n\t\t\t\t\treturn stepReturn.value\r\n\t\t\t\t}\r\n\t\t\t\tnextValue = stepReturn.value\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// if the return value is a (generator) iterator, execute it\r\n\t\t\t\t\tif (nextValue && nextValue.next && isGeneratorIterator(nextValue)) {\r\n\t\t\t\t\t\tnextValue = spawn(nextValue)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (nextValue && nextValue.then) {\r\n\t\t\t\t\t\t// if it is a promise, we will wait on it\r\n\t\t\t\t\t\t// and return the promise so that the next caller can wait on this\r\n\t\t\t\t\t\tvar resolved\r\n\t\t\t\t\t\tvar isSync = null\r\n\t\t\t\t\t\tvar result = nextValue.then(function(value) {\r\n\t\t\t\t\t\t\tnextValue = value\r\n\t\t\t\t\t\t\tisThrowing = false\r\n\t\t\t\t\t\t\tif (isSync === false) {\r\n\t\t\t\t\t\t\t\treturn next()\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tisSync = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\t\tnextValue = error\r\n\t\t\t\t\t\t\tisThrowing = true\r\n\t\t\t\t\t\t\treturn next()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (!isSync) {\r\n\t\t\t\t\t\t\tisSync = false\r\n\t\t\t\t\t\t\treturn result\r\n\t\t\t\t\t\t} // else keeping looping to avoid recursion\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisThrowing = false\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tisThrowing = true\r\n\t\t\t\t\tnextValue = error\r\n\t\t\t\t}\r\n\t\t\t} while(true)\r\n\t\t}\r\n\t}\r\n\tlang.spawn = spawn\r\n\treturn lang\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./util/lang'], factory) } else if (typeof module === 'object' && module.exports) {\r\n\tmodule.exports = factory(require('./util/lang')) // Node\r\n}}(this, function (lang) {\r\n\tvar deny = {}\r\n\tvar noChange = {}\r\n\tvar context\r\n\tvar WeakMap = lang.WeakMap\r\n\tvar Map = lang.Map\r\n\tvar Set = lang.Set\r\n\tvar setPrototypeOf = lang.setPrototypeOf\r\n\tvar getPrototypeOf = Object.getPrototypeOf || (function(base) { return base.__proto__ })\r\n\tvar isGenerator = lang.isGenerator\r\n\tvar undefined // makes it faster to be locally scoped\r\n\t// update types\r\n\tvar RequestChange = 3\r\n\tvar RequestSet = 4\r\n\tvar NOT_MODIFIED = {\r\n\t\tname: 'Not modified',\r\n\t\ttoString: function () {\r\n\t\t\treturn 'Marker for not-modified response'\r\n\t\t},\r\n\t}\r\n\tvar GET_TYPED_ARRAY = {\r\n\t\tgetTyped: true\r\n\t}\r\n\tvar GET_TYPED_OR_UNTYPED_ARRAY = {\r\n\t\tgetTyped: true,\r\n\t\tallowUntyped: true\r\n\t}\r\n\tvar GET_VALID_TYPE = {\r\n\t\tensureValidType: true\r\n\t}\r\n\r\n\tvar propertyListenersMap = new lang.WeakMap(null, 'propertyListenersMap')\r\n\tvar isStructureChecked = new lang.WeakMap()\r\n\tvar nextVersion = Date.now()\r\n\r\n\tvar CacheEntry = lang.compose(WeakMap, function() {\r\n\t},{\r\n\t\t_propertyChange: function(propertyName) {\r\n\t\t\tthis.variable._propertyChange(propertyName, contextFromCache(this))\r\n\t\t}\r\n\t})\r\n\tvar listenerId = 1\r\n\r\n\tfunction when(value, callback, errback) {\r\n\t\tif (value && value.then) {\r\n\t\t\treturn value.then(callback, errback)\r\n\t\t}\r\n\t\treturn callback(value)\r\n\t}\r\n\tfunction whenStrict(value, callback) {\r\n\t\tif (value && value.then && !value.notifies) {\r\n\t\t\treturn value.then(callback)\r\n\t\t}\r\n\t\treturn callback(value)\r\n\t}\r\n\r\n\tfunction Context(subject, notifies){\r\n\t\tthis.subject = subject\r\n\t\tif (notifies) {\r\n\t\t\tthis.notifies = notifies\r\n\t\t}\r\n\t}\r\n\tContext.prototype = {\r\n\t\tconstructor: Context,\r\n\t\tnewContext: function(variable) {\r\n\t\t\treturn new this.constructor(this.subject, this.notifies)\r\n\t\t},\r\n\t\texecuteWithin: function(executor) {\r\n\t\t\tvar previousContext = context\r\n\t\t\ttry {\r\n\t\t\t\tcontext = this\r\n\t\t\t\treturn executor()\r\n\t\t\t} finally {\r\n\t\t\t\tcontext = previousContext\r\n\t\t\t}\r\n\t\t},\r\n\t\t//version: 2166136261, // FNV-1a prime seed\r\n\t\tversion: 1,\r\n\t\trestart: function() {\r\n\t\t\t//this.version = 2166136261\r\n\t\t},\r\n\t\tcontextualize: function(variable, parentContext) {\r\n\t\t\t// resolve the contextualization of a variable, and updates this context to be aware of what distinctive aspect of the context has\r\n\t\t\t// been used for resolution\r\n\t\t\tvar contextualized\r\n\t\t\tif (this.distinctSubject) {\r\n\t\t\t\tvar contextMap = variable._contextMap || (variable._contextMap = new lang.WeakMap())\r\n\t\t\t\tcontextualized = contextMap.get(this.distinctSubject)\r\n\t\t\t\tif (!contextualized) {\r\n\t\t\t\t\tcontextMap.set(this.distinctSubject, contextualized = Object.create(variable))\r\n\t\t\t\t\tcontextualized.listeners = false\r\n\t\t\t\t\tcontextualized.context = this\r\n\t\t\t\t\tvar sources = this.sources\r\n\t\t\t\t\tfor (var i = 0, l = sources.length; i < l; i++) {\r\n\t\t\t\t\t\tcontextualized[sources[i]] = sources[++i]\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.contextualized = contextualized\r\n\t\t\t\t// do the merge\r\n\t\t\t\tif (parentContext) {\r\n\t\t\t\t\tparentContext.merge(this)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcontextualized = variable\r\n\t\t\t}\r\n\t\t\t//if (this.contextualized && this.contextualized !== contextualized) {\r\n\t\t\t\t// TOOD: if it has previously been contextualized to a different context (can happen in a promise/async situation), stop previous notifiers and start new ones\r\n\t\t\t//}\r\n\t\t\treturn contextualized\r\n\t\t},\r\n\t\tsetVersion: function(version) {\r\n/*\t\t\t// FNV1a hash algorithm 32-bit\r\n\t\t\treturn this.version = (this.version ^ (version || 0)) * 16777619 >>> 0*/\r\n\r\n/*\t\t\t// 54 bit FNV1a hash algorithm\r\n\t\t\tvar xored = this.version ^ (version || 0)\r\n\t\t\t// 435 + 1099511627776 = 1099511628211 is 64 bit FNV prime\r\n\t\t\treturn this.version =\r\n\t\t\t\txored * 435 + // compute hash on lower 32 bits\r\n\t\t\t\t(xor & 16777215) * 1099511627776 + // compute hash on lower 24 bits that overflow into upper 32 bits\r\n\t\t\t\t((this.version / 4294967296 >>> 0) * 435 & 2097151) * 4294967296 // hash on upper 32 bits*/\r\n\t\t\t// 54 bit derivative of FNV1a that better uses JS numbers/operators\r\n\r\n\t\t\t// a fast, efficient hash\r\n\t\t\t//return this.version = (this.version ^ (version || 0)) * 1049011 + (this.version / 5555555 >>> 0)\r\n\t\t\t// if we are using globally monotonically increasing version, we can just use max\r\n\t\t\tif (isNaN(version)) {\r\n\t\t\t\tthrow new Error('Bad version')\r\n\t\t\t}\r\n\t\t\treturn this.version = Math.max(this.version, version)\r\n\t\t},\r\n\t\tmerge: function(childContext) {\r\n\t\t\tif (!this.distinctSubject) {\r\n\t\t\t\tthis.distinctSubject = childContext.distinctSubject\r\n\t\t\t}\r\n\t\t},\r\n\t\tspecify: function(Variable) {\r\n\t\t\t// specify a particular instance of a generic variable\r\n\t\t\tvar subject = this.subject\r\n\t\t\tvar subjectMap = subject.constructor.ownedClasses\r\n\t\t\tvar specifiedInstance\r\n\t\t\tif (subjectMap) {\r\n\t\t\t\tif (!this.distinctSubject) {\r\n\t\t\t\t\tthis.distinctSubject = subject\r\n\t\t\t\t}\r\n\t\t\t\tvar instanceMap = subjectMap.get(Variable)\r\n\t\t\t\tif (instanceMap) {\r\n\t\t\t\t\tspecifiedInstance = instanceMap.get(subject)\r\n\t\t\t\t\tif (!specifiedInstance) {\r\n\t\t\t\t\t\tinstanceMap.set(subject, specifiedInstance = instanceMap.createInstance ? instanceMap.createInstance(subject) : new Variable())\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn specifiedInstance\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// else if no specific context is found, return default instance\r\n\t\t\treturn Variable.defaultInstance\r\n\t\t},\r\n\t\tgetContextualized: function(variable) {\r\n\t\t\tif (!this.subject) {\r\n\t\t\t\t// no subject, just use the default variable\r\n\t\t\t\treturn variable\r\n\t\t\t}\r\n\t\t\t// returns a variable that has already been contextualized\r\n\t\t\tvar instance = variable._contextMap && this.subject && variable._contextMap.get(this.subject)\r\n\t\t\tif (instance && instance.context && instance.context.matches(this)) {\r\n\t\t\t\treturn instance\r\n\t\t\t}\r\n\t\t},\r\n\t\tmatches: function(context) {\r\n\t\t\t// does another context match the resolution of this one?\r\n\t\t\treturn context.subject === this.subject\r\n\t\t}\r\n\t}\r\n\r\n\tfunction NotifyingContext(listener, subject){\r\n\t\tthis.subject = subject\r\n\t\tthis.listener = listener\r\n\t}\r\n\tNotifyingContext.prototype = Object.create(Context.prototype)\r\n\tNotifyingContext.prototype.constructor = NotifyingContext\r\n\r\n\tfunction registerListener(value, listener) {\r\n\t\tvar listeners = propertyListenersMap.get(value)\r\n\t\tvar id = listener.listenerId || (listener.listenerId = ('-' + listenerId++))\r\n\t\tif (listeners) {\r\n\t\t\tif (listeners[id] === undefined) {\r\n\t\t\t\tlisteners[id] = listeners.push(listener) - 1\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tpropertyListenersMap.set(value, listeners = [listener])\r\n\t\t\tlisteners[id] = 0\r\n\t\t\tif (Variable.autoObserveObjects) {\r\n\t\t\t\tobserve(value)\r\n\t\t\t}\r\n\t\t}\r\n\t\tlistener.listeningToObject = value\r\n\t}\r\n\tfunction deregisterListener(listener) {\r\n\t\tif (listener.listeningToObject) {\r\n\t\t\tvar value = listener.listeningToObject\r\n\t\t\tlistener.listeningToObject = null\r\n\t\t\tvar listeners = propertyListenersMap.get(value)\r\n\t\t\tif (listeners) {\r\n\t\t\t\tvar index = listeners[listener.listenerId]\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tlisteners.splice(index, 1)\r\n\t\t\t\t\tdelete listeners[listener.listenerId]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction UpdateEvent() {\r\n\t\tthis.visited = new Set()\r\n\t}\r\n\tUpdateEvent.prototype.type = 'replaced'\r\n\r\n\tfunction ReplacedEvent(triggerEvent) {\r\n\t\tthis.visited = triggerEvent ? triggerEvent.visited : new Set()\r\n\t}\r\n\tReplacedEvent.prototype.type = 'replaced'\r\n\r\n\tfunction PropertyChangeEvent(key, propertyEvent, parent) {\r\n\t\tthis.key = key\r\n\t\tthis.propertyEvent = propertyEvent\r\n\t\tthis.parent = parent\r\n\t\tthis.visited = propertyEvent.visited\r\n\t}\r\n\tPropertyChangeEvent.prototype.type = 'property'\r\n\r\n\tfunction SplicedEvent(modifier, items, removed, start, deleteCount) {\r\n\t\tthis.visited = new Set()\r\n\t\tthis.modifier = modifier\r\n\t\tthis.items = items\r\n\t\tthis.removed = removed\r\n\t\tthis.start = start\r\n\t\tthis.deleteCount = deleteCount\r\n\t}\r\n\tSplicedEvent.prototype.type = 'spliced'\r\n\tfunction EntryEvent(key, value, entryEvent) {\r\n\t\tthis.entryEvent = entryEvent\r\n\t\tthis.visited = entryEvent.visited\r\n\t\tthis.key = key\r\n\t\tthis.value = value\r\n\t}\r\n\tEntryEvent.prototype.type = 'entry'\r\n\tEntryEvent.prototype.doesAffect = function(subject) {\r\n\t\treturn this.value.constructor.for(subject).id.valueOf() == this.value.id.valueOf()\r\n\t}\r\n\r\n\tfunction DeletedEvent(key, value) {\r\n\t\tthis.key = key\r\n\t\tthis.value = value\r\n\t\tthis.visited = new Set()\r\n\t}\r\n\tDeletedEvent.prototype.type = 'deleted'\r\n\r\n\tfunction AddedEvent(key, value) {\r\n\t\tthis.key = key\r\n\t\tthis.value = value\r\n\t\tthis.visited = new Set()\r\n\t}\r\n\tAddedEvent.prototype.type = 'added'\r\n\tAddedEvent.prototype.doesAffect = function() {\r\n\t\treturn false\r\n\t}\r\n\r\n\tfunction forPropertyNotifyingValues(variable, properties, callback) {\r\n\t\tif (variable === properties) {\r\n\t\t\tforPropertyNotifyingValues(variable, variable._properties, callback)\r\n\t\t}\r\n\t\tfor (var key in properties) {\r\n\t\t\tvar property = properties[key]\r\n\t\t\tif (property && property.parent == variable) {\r\n\t\t\t\tif (property.returnedVariable) {\r\n\t\t\t\t\tcallback(property.returnedVariable)\r\n\t\t\t\t}\r\n\t\t\t\tif (property.hasChildNotifiers) {\r\n\t\t\t\t\tvar subProperties = property._properties\r\n\t\t\t\t\tif (subProperties) {\r\n\t\t\t\t\t\tforPropertyNotifyingValues(property, property, callback)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction assignPromise(variable, promise, callback) {\r\n\t\tvar isSync\r\n\t\tpromise.then(function(value) {\r\n\t\t\tif (isSync !== false) {\r\n\t\t\t\t// synchronous resolution\r\n\t\t\t\tisSync = true\r\n\t\t\t} else if (variable.promise === promise) {\r\n\t\t\t\t// async resolution make sure we are the still the most recent promise\r\n\t\t\t\tvariable.promise = null\r\n\t\t\t} else {\r\n\t\t\t\t// if async and we are not the most recent, just return\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (callback) { // custom handler\r\n\t\t\t\tcallback(value)\r\n\t\t\t} else {\r\n\t\t\t\tvariable.value = value\r\n\t\t\t}\r\n\t\t}, function(error) {\r\n\t\t\tif (isSync !== false) {\r\n\t\t\t\t// synchronous resolution\r\n\t\t\t\tisSync = true\r\n\t\t\t} else if (variable.promise === promise) {\r\n\t\t\t\t// async resolution make sure we are the still the most recent promise\r\n\t\t\t\tvariable.promise = null\r\n\t\t\t} else {\r\n\t\t\t\t// if async and we are not the most recent, just return\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tvariable.error = error\r\n\t\t})\r\n\t\tif (!isSync) {\r\n\t\t\tisSync = false\r\n\t\t\tvariable.promise = promise\r\n\t\t}\r\n\t\treturn promise\r\n\t}\r\n\r\n\tfunction Variable(value) {\r\n\t\tif (this instanceof Variable) {\r\n\t\t\t// new call, may eventually use new.target\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tif (value && value.then && !value.notifies) {\r\n\t\t\t\t\tassignPromise(this, value)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.value = value\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn Variable.with(value)\r\n\t\t}\r\n\t}\r\n\r\n\tVariable._logStackTrace = function(v) {\r\n\t\tvar stack = (new Error().stack || '').split(/[\\r\\n]+/)\r\n\t\tif (stack[0] && /^Error\\s*/.test(stack[0])) stack.shift()\r\n\t\tif (stack[0] && /_logStackTrace/.test(stack[0])) stack.shift()\r\n\t\tvar coalesce = (this._debugOpts && this._debugOpts.coalesce) || []\r\n\t\tif (this._debugOpts && this._debugOpts.shortStackTrace) {\r\n\t\t\t// find the first non-coalesced line\r\n\t\t\tvar line\r\n\t\t\tstack.some(function(line) {\r\n\t\t\t\tif (!coalesce.some(function(re) {\r\n\t\t\t\t\treturn re.re.test(line)\r\n\t\t\t\t})) {\r\n\t\t\t\t\tline = stack[0]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tconsole.log('Variable ' + v.__debug + ' changed', line && line.replace(/^\\s+/, ''))\r\n\t\t} else {\r\n\t\t\tif (coalesce.length) {\r\n\t\t\t\tvar s = []\r\n\t\t\t\tvar re\r\n\t\t\t\tfor (var i = 0; i < stack.length; i++) {\r\n\t\t\t\t\tvar line = stack[i]\r\n\t\t\t\t\tif (re) {\r\n\t\t\t\t\t\tif (re.test(line)) continue\r\n\t\t\t\t\t\tre = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\tre\r\n\t\t\t\t\tcoalesce.some(function(re) {\r\n\t\t\t\t\t\treturn re = re.re.test(line)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tline = line.replace(/^\\s+/,'')\r\n\t\t\t\t\tif (re) {\r\n\t\t\t\t\t\ts.push('(' + re.name + ') ' + line)\r\n\t\t\t\t\t\tre = re.re\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ts.push(line)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tstack = s\r\n\t\t\t}\r\n\t\t\tvar stackObject = this._debugOpts && this._debugOpts.stackObject\r\n\t\t\tif (stackObject) {\r\n\t\t\t\tconsole.log('Variable ' + v.__debug + ' changed', stack)\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('Variable ' + v.__debug + ' changed\\r\\n' + stack.join('\\r\\n'))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tVariable._debugOpts = {\r\n\t\tcoalesce: [{ name: 'alkali', re: /\\/alkali\\// }, { name: 'Promise', re: /(Promise\\.)|(PromiseArray\\.)|(\\/bluebird\\/)/ }],\r\n\t\tstackObject: false\r\n\t}\r\n\r\n\tvar VariablePrototype = Variable.prototype = {\r\n\t\t// for debugging use\r\n\t\tconstructor: Variable,\r\n\t\tvalueOf: function(allowPromise) {\r\n\t\t\tvar result = this.gotValue(this.getValue())\r\n\t\t\treturn (allowPromise || !(result && result.then)) ? result : undefined\r\n\t\t},\r\n\t\tthen: function(onFulfilled, onRejected) {\r\n\t\t\tvar result = this.valueOf(true)\r\n\t\t\tvar isAsyncPromise = result && result.then\r\n\t\t\tif (!isAsyncPromise) {\r\n\t\t\t\tresult = new lang.SyncPromise(result) // ensure it is promise-like\r\n\t\t\t}\r\n\t\t\tif (onFulfilled || onRejected) { // call then if we have any callbacks\r\n\t\t\t\tif (isAsyncPromise && context) {\r\n\t\t\t\t\t// if it is async and we have a context, we will restore it for the callback\r\n\t\t\t\t\tvar currentContext = context\r\n\t\t\t\t\treturn result.then(onFulfilled && function(result) {\r\n\t\t\t\t\t\treturn currentContext.executeWithin(function() {\r\n\t\t\t\t\t\t\treturn onFulfilled(result)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}, onRejected && function(error) {\r\n\t\t\t\t\t\treturn currentContext.executeWithin(function() {\r\n\t\t\t\t\t\t\treturn onRejected(error)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treturn result.then(onFulfilled, onRejected)\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t},\r\n\t\tgetValue: function(forChild) {\r\n\t\t\tif (context) {\r\n\t\t\t\tcontext.setVersion(forChild ? this.version : Math.max(this.version || 0, this.versionWithChildren || 0))\r\n\t\t\t}\r\n\t\t\tvar key = this.key\r\n\t\t\tvar parent\r\n\t\t\tif (key != null && (parent = this.parent) != null) {\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tif (context.ifModifiedSince != null) {\r\n\t\t\t\t\t\t// just too complicated to handle NOT_MODIFED objects for now\r\n\t\t\t\t\t\t// TODO: Maybe handle this and delegate NOT_MODIFIED through this\r\n\t\t\t\t\t\t// chain and through gotValue\r\n\t\t\t\t\t\tcontext.ifModifiedSince = undefined\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar property = this\r\n\t\t\t\tvar object\r\n\t\t\t\tif (parent.getValue) {\r\n\t\t\t\t\t// parent needs value context, might want to do separate context,\r\n\t\t\t\t\t// but would need to treat special so it retrieves the version\r\n\t\t\t\t\t// only and not the versionWithChildren\r\n\t\t\t\t\tobject = parent.getValue(true)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobject = parent.value\r\n\t\t\t\t}\r\n\t\t\t\tif (object && object.then && !object.notifies) {\r\n\t\t\t\t\treturn when(object, function(object) {\r\n\t\t\t\t\t\tvar value = object == null ? undefined :\r\n\t\t\t\t\t\t\ttypeof object.property === 'function' ? object.property(key) :\r\n\t\t\t\t\t\t\ttypeof object.get === 'function' ? object.get(key) : object[key]\r\n\t\t\t\t\t\t//if (property.listeners) {\r\n\t\t\t\t\t\t\tvar listeners = propertyListenersMap.get(object)\r\n\t\t\t\t\t\t\tif (listeners && listeners.observer && listeners.observer.addKey) {\r\n\t\t\t\t\t\t\t\tlisteners.observer.addKey(key)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//}\r\n\t\t\t\t\t\treturn value\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tvar value = object == null ? undefined :\r\n\t\t\t\t\ttypeof object.property === 'function' ? object.property(key) :\r\n\t\t\t\t\ttypeof object.get === 'function' ? object.get(key) : object[key]\r\n\t\t\t\t//if (property.listeners) {\r\n\t\t\t\t\tvar listeners = propertyListenersMap.get(object)\r\n\t\t\t\t\tif (listeners && listeners.observer && listeners.observer.addKey) {\r\n\t\t\t\t\t\tlisteners.observer.addKey(key)\r\n\t\t\t\t\t}\r\n\t\t\t\t//}\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t\tif (this.promise) {\r\n\t\t\t\treturn this.promise\r\n\t\t\t}\r\n\t\t\tvar value = this.value\r\n\t\t\treturn value !== undefined ?\r\n\t\t\t\tthis.value : this.default\r\n\t\t},\r\n\t\tgotValue: function(value) {\r\n\t\t\tvar previousNotifyingValue = this.returnedVariable\r\n\t\t\tvar variable = this\r\n\t\t\tif (previousNotifyingValue) {\r\n\t\t\t\tif (value === previousNotifyingValue) {\r\n\t\t\t\t\t// nothing changed, immediately return valueOf\r\n\t\t\t\t\tif (context && context.ifModifiedSince > 0) // we don't want the nested value to return a NOT_MODIFIED\r\n\t\t\t\t\t\tcontext.ifModifiedSince = undefined\r\n\t\t\t\t\treturn value.valueOf(true)\r\n\t\t\t\t}\r\n\t\t\t\t// if there was a another value that we were dependent on before, stop listening to it\r\n\t\t\t\t// TODO: we may want to consider doing cleanup after the next rendering turn\r\n\t\t\t\tif (variable.listeners) {\r\n\t\t\t\t\tpreviousNotifyingValue.stopNotifies(variable)\r\n\t\t\t\t}\r\n\t\t\t\tvariable.returnedVariable = null\r\n\t\t\t}\r\n\t\t\tif (value && value.notifies) {\r\n\t\t\t\tvariable.returnedVariable = value\r\n\t\t\t\tif (variable.listeners) {\r\n\t\t\t\t\tvalue.notifies(variable)\r\n\t\t\t\t}\r\n\t\t\t\tif (context && context.ifModifiedSince > 0) // we don't want the nested value to return a NOT_MODIFIED\r\n\t\t\t\t\tcontext.ifModifiedSince = undefined\r\n\t\t\t\tvalue = value.valueOf(true)\r\n\t\t\t}\r\n\t\t\tif (value && value.then) {\r\n\t\t\t\tvar deferredContext = context\r\n\t\t\t\treturn value.then(function(value) {\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tif (value.__variable) {\r\n\t\t\t\t\t\t\tvalue = value.__variable\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (value.subscribe) {\r\n\t\t\t\t\t\t\tif (deferredContext) {\r\n\t\t\t\t\t\t\t\treturn deferredContext.executeWithin(function() {\r\n\t\t\t\t\t\t\t\t\treturn Variable.prototype.gotValue.call(variable, value)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturn Variable.prototype.gotValue.call(variable, value)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn value\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\treturn value\r\n\t\t},\r\n\t\tPropertyClass: Variable,\r\n\t\tproperty: function(key, PropertyClass) {\r\n\t\t\tvar propertyVariable = this[key]\r\n\t\t\tif (!propertyVariable || !propertyVariable.notifies) {\r\n\t\t\t\tpropertyVariable = this._properties && this._properties[key]\r\n\t\t\t}\r\n\t\t\tif (!propertyVariable) {\r\n\t\t\t\t// create the property variable\r\n\t\t\t\tvar Class = PropertyClass\r\n\t\t\t\tif (!Class) {\r\n\t\t\t\t\tClass = this.constructor[key]\r\n\t\t\t\t\tif (typeof Class !== 'function' || !Class.isPropertyClass) {\r\n\t\t\t\t\t\tClass = this.PropertyClass\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpropertyVariable = new Class()\r\n\t\t\t\tpropertyVariable.key = key\r\n\t\t\t\tpropertyVariable.parent = this\r\n\t\t\t\tif (this[key] === undefined) {\r\n\t\t\t\t\tthis[key] = propertyVariable\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(this._properties || (this._properties = {}))[key] = propertyVariable\r\n\t\t\t\t}\r\n\t\t\t} else if (PropertyClass) {\r\n\t\t\t\tif (!(propertyVariable instanceof PropertyClass)) {\r\n\t\t\t\t\tthrow new TypeError('Existing property variable does not match requested variable type')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn propertyVariable\r\n\t\t},\r\n\t\tfor: function(subject) {\r\n\t\t\tif (subject && subject.target && !subject.constructor.getForClass) {\r\n\t\t\t\t// makes HTML events work\r\n\t\t\t\tsubject = subject.target\r\n\t\t\t}\r\n\t\t\tif (this.parent) {\r\n\t\t\t\treturn this.parent.for(subject).property(this.key)\r\n\t\t\t}\r\n\t\t\treturn new ContextualizedVariable(this, subject || defaultContext)\r\n\t\t},\r\n\t\tget isWritable() {\r\n\t\t\treturn this.fixed ? !this.value || this.value.isWritable : this._isWritable\r\n\t\t},\r\n\t\tset isWritable(isWritable) {\r\n\t\t\tthis._isWritable = isWritable\r\n\t\t},\r\n\t\t_isWritable: true,\r\n\t\t_propertyChange: function(propertyName, object, type) {\r\n\t\t\tif (this.onPropertyChange) {\r\n\t\t\t\tthis.onPropertyChange(propertyName, object)\r\n\t\t\t}\r\n\t\t\tthis.updated(new PropertyChangeEvent(propertyName, new ReplacedEvent(), this))\r\n\t\t},\r\n\t\teachKey: function(callback) {\r\n\t\t\tfor (var i in this._properties) {\r\n\t\t\t\tcallback(i)\r\n\t\t\t}\r\n\t\t\tfor (var i in this) {\r\n\t\t\t\tif (this.hasOwnProperty[i]) {\r\n\t\t\t\t\tvar value = this[i]\r\n\t\t\t\t\tif (value && value.parent == this && value.listeners) {\r\n\t\t\t\t\t\tcallback(i)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tapply: function(instance, args) {\r\n\t\t\treturn new Transform(args[0], this, args)\r\n\t\t},\r\n\t\tcall: function(instance) {\r\n\t\t\treturn this.apply(instance, Array.prototype.slice.call(arguments, 1))\r\n\t\t},\r\n\t\tforDependencies: function(callback) {\r\n\t\t\tif (this.returnedVariable) {\r\n\t\t\t\tcallback(this.returnedVariable)\r\n\t\t\t}\r\n\t\t\tif (this.hasNotifyingChild) {\r\n\t\t\t\tforPropertyNotifyingValues(this, this, callback)\r\n\t\t\t}\r\n\t\t\tif (this.parent) {\r\n\t\t\t\tcallback(this.parent)\r\n\t\t\t}\r\n\t\t},\r\n\t\tinit: function() {\r\n\t\t\tvar variable = this\r\n\t\t\tvar contextualizes, sources = [] // TODO: optimize this\r\n\t\t\tthis.forDependencies(function(dependency) {\r\n\t\t\t\tvar contextualized = dependency.notifies(variable)\r\n\t\t\t\tif (contextualized !== dependency) {\r\n\t\t\t\t\tcontextualizes = true\r\n\t\t\t\t}\r\n\t\t\t\tsources.push(contextualized)\r\n\t\t\t})\r\n/*\t\t\tif (contextualizes) {\r\n\t\t\t\tvar contextualized = new ContextualizedVariable()\r\n\t\t\t\t//context.instanceMap.set(this, contextualized)\r\n\t\t\t\tcontextualized.sources = sources\r\n\t\t\t\tcontextualized.init()\r\n\t\t\t\treturn contextualized\r\n\t\t\t}\r\n*/\r\n\t\t\tif (this.listeningToObject === null) {\r\n\t\t\t\t// we were previously listening to an object, but it needs to be restored\r\n\t\t\t\t// calling valueOf will cause the listening object to be restored\r\n\t\t\t\tthis.valueOf()\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tcleanup: function() {\r\n\t\t\tthis.listeners = false\r\n\t\t\tvar handles = this.handles\r\n\t\t\tif (handles) {\r\n\t\t\t\tfor (var i = 0; i < handles.length; i++) {\r\n\t\t\t\t\thandles[i].remove()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.handles = null\r\n\t\t\tvar returnedVariable = this.returnedVariable\r\n\t\t\tvar variable = this\r\n\t\t\tthis.forDependencies(function(dependency) {\r\n\t\t\t\tdependency.stopNotifies(variable)\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\tversion: 0,\r\n\t\tversionWithChildren: 0,\r\n\r\n\t\tupdateVersion: function(version) {\r\n\t\t\tvar dateBasedVersion = (Date.now() - 1500000000000) * 256\r\n\t\t\tif (dateBasedVersion > nextVersion) {\r\n\t\t\t\tnextVersion = dateBasedVersion\r\n\t\t\t}\r\n\t\t\tthis.version = nextVersion++\r\n\t\t},\r\n\r\n\t\tgetVersion: function() {\r\n\t\t\treturn Math.max(this.version,\r\n\t\t\t\tthis.returnedVariable && this.returnedVariable.getVersion ? this.returnedVariable.getFullVersion(context) : 0,\r\n\t\t\t\tthis.parent ? this.parent.getVersion(context) : 0)\r\n\t\t},\r\n\t\tgetFullVersion: function() {\r\n\t\t\treturn Math.max(this.versionWithChildren, this.getVersion())\r\n\t\t},\r\n\r\n\t\tgetSubject: function(selectVariable) {\r\n\t\t\treturn this.subject\r\n\t\t},\r\n\r\n\t\tgetUpdates: function(since) {\r\n\t\t\tvar updates = []\r\n\t\t\tvar nextUpdateMap = this.nextUpdateMap\r\n\t\t\tif (nextUpdateMap && since) {\r\n\t\t\t\twhile ((since = nextUpdateMap.get(since))) {\r\n\t\t\t\t\tif (since.type === 'replaced') {\r\n\t\t\t\t\t\t// if it was refresh, we can clear any prior entries\r\n\t\t\t\t\t\tupdates = []\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdates.push(since)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn updates\r\n\t\t},\r\n\r\n\t\t_initUpdate: function(updateEvent, isDownstream) {\r\n\t\t\tif (!updateEvent.version) {\r\n\t\t\t\tvar dateBasedVersion = (Date.now() - 1500000000000) * 256\r\n\t\t\t\tif (dateBasedVersion > nextVersion) {\r\n\t\t\t\t\tnextVersion = dateBasedVersion\r\n\t\t\t\t}\r\n\t\t\t\tupdateEvent.version = nextVersion++\r\n\t\t\t}\r\n\t\t\tif (updateEvent instanceof PropertyChangeEvent) {\r\n\t\t\t\tthis.versionWithChildren = updateEvent.version\r\n\t\t\t} else if (!isDownstream) {\r\n\t\t\t\tthis.version = updateEvent.version\r\n\t\t\t}\r\n\t\t\treturn updateEvent\r\n\t\t},\r\n\r\n\t\tupdated: function(updateEvent, by, isDownstream) {\r\n\t\t\tif (!updateEvent) {\r\n\t\t\t\tupdateEvent = new ReplacedEvent()\r\n\t\t\t\tupdateEvent.source = this\r\n\t\t\t}\r\n\t\t\tif (updateEvent.visited.has(this)){\r\n\t\t\t\t// if this event has already visited this variable, skip it\r\n\t\t\t\treturn updateEvent\r\n\t\t\t}\r\n\t\t\tupdateEvent.visited.add(this)\r\n\t\t\tif (this.__debug) {\r\n\t\t\t\t// debug is on\r\n\t\t\t\tVariable._logStackTrace(this)\r\n\t\t\t}\r\n\r\n\t\t\t/*var contextualInstance = context && context.getContextualized(this)\r\n\t\t\tif (contextualInstance) {\r\n\t\t\t\tcontextualInstance.updated(updateEvent, this)\r\n\t\t\t}\r\n\r\n\t\t\t// at some point we could do an update list so that we could incrementally update\r\n\t\t\t// lists in non-live situations\r\n\t\t\tif (this.lastUpdate) {\r\n\t\t\t\tvar nextUpdateMap = this.nextUpdateMap\r\n\t\t\t\tif (!nextUpdateMap) {\r\n\t\t\t\t\tnextUpdateMap = this.nextUpdateMap = new lang.WeakMap()\r\n\t\t\t\t}\r\n\t\t\t\tnextUpdateMap.set(this.lastUpdate, updateEvent)\r\n\t\t\t}\r\n\r\n\t\t\tthis.lastUpdate = updateEvent */\r\n\t\t\tthis._initUpdate(updateEvent, isDownstream)\r\n\t\t\tvar listeners = this.listeners\r\n\t\t\tif (listeners) {\r\n\t\t\t\tvar variable = this\r\n\t\t\t\t// make a copy, in case they change\r\n\t\t\t\tlisteners = listeners.slice()\r\n\t\t\t\tfor (var i = 0, l = listeners.length; i < l; i++) {\r\n\t\t\t\t\tvar dependent = listeners[i]\r\n\t\t\t\t\tif ((updateEvent instanceof PropertyChangeEvent) &&\r\n\t\t\t\t\t\t\tdependent.parent) {\r\n\t\t\t\t\t\tif (dependent.key === updateEvent.key) {\r\n\t\t\t\t\t\t\tdependent.updated(updateEvent.propertyEvent, variable)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdependent.updated(updateEvent, variable, true)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (updateEvent instanceof PropertyChangeEvent) {\r\n\t\t\t\tif (this.returnedVariable && this.fixed) {\r\n\t\t\t\t\tthis.returnedVariable.updated(updateEvent, this)\r\n\t\t\t\t}\r\n\t\t\t\tvar Class = this.constructor\r\n\t\t\t\tvar variable = this\r\n\t\t\t\tif (Class.collection) {\r\n\t\t\t\t\tClass.collection.updated(new EntryEvent(this.id, this, updateEvent))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.parent) {\r\n\t\t\t\tthis.parent.updated(new PropertyChangeEvent(this.key, updateEvent, this.parent), this)\r\n\t\t\t}\r\n\t\t\tif (this.collection) {\r\n\t\t\t\tthis.collection.updated(updateEvent, this)\r\n\t\t\t}\r\n\t\t\treturn updateEvent\r\n\t\t},\r\n\r\n\t\tinvalidate: function() {\r\n\t\t\t// for back-compatibility for now\r\n\t\t\tthis.updated()\r\n\t\t},\r\n\r\n\t\tnotifies: function(target) {\r\n\t\t\t// TODO: Eventually we want this to be trigerred from context, but context gets shared with returned variables, so will need to handle that\r\n\t\t\tif (!target) {\r\n\t\t\t\tthrow new Error('No listener provided for notification')\r\n\t\t\t}\r\n\t\t\tvar listeners = this.listeners\r\n\t\t\tif (!listeners || !this.hasOwnProperty('listeners')) {\r\n\t\t\t\tvar variable = this.init()\r\n\t\t\t\tvariable.listeners = listeners = [target]\r\n\t\t\t\treturn variable\r\n\t\t\t} else if (listeners.indexOf(target) === -1) {\r\n\t\t\t\tlisteners.push(target)\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tsubscribe: function(listener) {\r\n\t\t\t// ES7 Observable (and baconjs) compatible API\r\n\t\t\tvar updated\r\n\t\t\tvar updateQueued\r\n\t\t\tvar variable = this\r\n\t\t\t// it is important to make sure you register for notifications before getting the value\r\n\t\t\tif (typeof listener === 'function') {\r\n\t\t\t\t// BaconJS compatible API\r\n\t\t\t\tvar variable = this\r\n\t\t\t\tvar event = {\r\n\t\t\t\t\tvalue: function() {\r\n\t\t\t\t\t\treturn new Context(null, true).executeWithin(function() {\r\n\t\t\t\t\t\t\treturn variable.valueOf(true)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tupdated = function() {\r\n\t\t\t\t\tupdateQueued = false\r\n\t\t\t\t\tlistener(event)\r\n\t\t\t\t}\r\n\t\t\t}\telse if (listener.next) {\r\n\t\t\t\t// Assuming ES7 Observable API. It is actually a streaming API, this pretty much violates all principles of reactivity, but we will support it\r\n\t\t\t\tupdated = function() {\r\n\t\t\t\t\tupdateQueued = false\r\n\t\t\t\t\tvariable.then(function(value) {\r\n\t\t\t\t\t\tlistener.next(value)\r\n\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\tlistener.error(value)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Subscribing to an invalid listener, the listener must be a function, or have an update or next method')\r\n\t\t\t}\r\n\t\t\tvar updateReceiver = {\r\n\t\t\t\tupdated: function() {\r\n\t\t\t\t\tif (updateQueued) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateQueued = true\r\n\t\t\t\t\tlang.nextTurn(updated)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tupdated()\r\n\t\t\tthis.notifies(updateReceiver)\r\n\t\t\treturn {\r\n\t\t\t\tunsubscribe: function() {\r\n\t\t\t\t\tvariable.stopNotifies(updateReceiver)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tstopNotifies: function(dependent) {\r\n\t\t\tvar listeners = this.listeners\r\n\t\t\tif (listeners) {\r\n\t\t\t\tvar index = listeners.indexOf(dependent)\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tlisteners.splice(index, 1)\r\n\t\t\t\t\tif (listeners.length === 0) {\r\n\t\t\t\t\t\t// clear the listeners so it will be reinitialized if it has\r\n\t\t\t\t\t\t// listeners again\r\n\t\t\t\t\t\tthis.cleanup()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tput: function(value, event) {\r\n\t\t\tif (this.parent && this.key !== undefined) {\r\n\t\t\t\treturn changeValue(this, RequestChange, value, event)\r\n\t\t\t}\r\n\t\t\tvar oldValue = this.getValue ? this.getValue() : this.value\r\n\t\t\tif (oldValue === value && typeof value != 'object') {\r\n\t\t\t\treturn noChange\r\n\t\t\t}\r\n\t\t\tif (oldValue && oldValue.put && oldValue.notifies) {\r\n\t\t\t\t// if it is set to fixed, we see we can put in the current variable\r\n\t\t\t\tif (this.fixed || !(value && value.put && value.notifies)) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\treturn oldValue.put(value)\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tif (!error.deniedPut) {\r\n\t\t\t\t\t\t\tthrow error\r\n\t\t\t\t\t\t}// else if the put was denied, continue on and set the value on this variable\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (value && value.then && !value.notifies) {\r\n\t\t\t\tvalue = assignPromise(this, value)\r\n\t\t\t} else {\r\n\t\t\t\tthis.value = value\r\n\t\t\t\tif (value && value.put) {\r\n\t\t\t\t\t// preserve a reference to the original variable so we can `save()` back into it\r\n\t\t\t\t\tthis.copiedFrom = value\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tevent = event || new ReplacedEvent()\r\n\t\t\tevent.oldValue = oldValue\r\n\t\t\tevent.target = this\r\n\t\t\tthis.updated(event, this)\r\n\t\t\treturn value\r\n\t\t},\r\n\t\tget: function(key) {\r\n\t\t\tif (this[key] || (this._properties && this._properties[key])) {\r\n\t\t\t\treturn this.property(key).valueOf(true)\r\n\t\t\t}\r\n\t\t\tvar object = this.getValue()\r\n\t\t\tif (!object) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (typeof object.get === 'function') {\r\n\t\t\t\treturn object.get(key)\r\n\t\t\t}\r\n\t\t\tvar value = object[key]\r\n\t\t\tif (value && value.notifies) {\r\n\t\t\t\t// nested variable situation, get underlying value\r\n\t\t\t\treturn value.valueOf(true)\r\n\t\t\t}\r\n\t\t\treturn value\r\n\t\t},\r\n\t\tset: function(key, value, event) {\r\n\t\t\t// TODO: create an optimized route when the property doesn't exist yet\r\n\t\t\tchangeValue(this.property(key), RequestSet, value, event)\r\n\t\t},\r\n\t\tundefine: function(key) {\r\n\t\t\tthis.set(key, undefined)\r\n\t\t},\r\n\t\tis: function(newValue, event) {\r\n\t\t\tif (this.parent) {\r\n\t\t\t\tvar parent = this.parent\r\n\t\t\t\tvar key = this.key\r\n\t\t\t\tvar object = (parent.getValue ? parent.getValue(true) : parent.value)\r\n\t\t\t\tvar parentEvent = new PropertyChangeEvent(key, event || new ReplacedEvent(), parent)\r\n\t\t\t\tif (object) {\r\n\t\t\t\t\tobject[key] = newValue\r\n\t\t\t\t\tthis.updated(parentEvent, this)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobject = (typeof key === 'number' ? [] : {})\r\n\t\t\t\t\tobject[key] = newValue\r\n\t\t\t\t\tparent.is(object, parentEvent)\r\n\t\t\t\t}\r\n\t\t\t\treturn this\r\n\t\t\t}\r\n\t\t\tthis.fixed = true\r\n\r\n\t\t\tthis.value = newValue\r\n\t\t\tthis.updated(new ReplacedEvent(), this)\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tproxy: function(proxiedVariable) {\r\n\t\t\treturn this.is(proxiedVariable)\r\n\t\t},\r\n\t\tnext: function(value) {\r\n\t\t\t// for ES7 observable compatibility\r\n\t\t\tthis.put(value)\r\n\t\t},\r\n\t\terror: function(error) {\r\n\t\t\t// for ES7 observable compatibility\r\n\t\t\tvar listeners = this.listeners\r\n\t\t\tif (listeners) {\r\n\t\t\t\t// make a copy, in case they change\r\n\t\t\t\tlisteners.forEach(function(dependent) {\r\n\t\t\t\t\t// skip notifying property listeners if we are headed up the parent chain\r\n\t\t\t\t\tdependent.error(error)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomplete: function(value) {\r\n\t\t\t// for ES7 observable compatibility\r\n\t\t\tthis.put(value)\r\n\t\t},\r\n\t\tsave: function() {\r\n\t\t\tif (this.copiedFrom) {\r\n\t\t\t\tthis.copiedFrom.put(this.valueOf())\r\n\t\t\t\treturn true\r\n\t\t\t} else {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonValue: function(listener) {\r\n\t\t\treturn this.subscribe(function(event) {\r\n\t\t\t\twhen(event.value(), function(value) {\r\n\t\t\t\t\tlistener(value)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\ttoJSON: function() {\r\n\t\t\treturn this.valueOf()\r\n\t\t},\r\n\t\ttoString: function() {\r\n\t\t\treturn String(this.valueOf())\r\n\t\t},\r\n\t\tto: function (transformFunction, reverse) {\r\n\t\t\tif (typeof transformFunction !== 'function') {\r\n\t\t\t\tif (typeof transformFunction === 'object') {\r\n\t\t\t\t\tthis.to(transformFunction.get, transformFunction.set)\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error('No function provided to transform')\r\n\t\t\t}\r\n\t\t\tif (reverse) {\r\n\t\t\t\ttransformFunction.reverse = function(value, args) {\r\n\t\t\t\t\t// for direct to, we can just use the first argument\r\n\t\t\t\t\treturn reverse.call(this, value, args[0])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (transformFunction.prototype instanceof Variable) {\r\n\t\t\t\treturn new transformFunction(this)\r\n\t\t\t}\r\n\t\t\treturn new (this._Transform || Transform)(this, transformFunction)\r\n\t\t},\r\n\t\tmap: function (transformFunction) {\r\n\t\t\treturn this.to(function(value) {\r\n\t\t\t\tif (value instanceof Array) {\r\n\t\t\t\t\tthrow new Error('map without VArray')\r\n\t\t\t\t}\r\n\t\t\t\treturn transformFunction(value)\r\n\t\t\t})\r\n\t\t},\r\n\t\tas: function(Class) {\r\n\t\t\t// easiest way to cast to a variable class\r\n\t\t\tvar instance = new Class(this)\r\n\t\t\tinstance.fixed = true\r\n\t\t\treturn instance\r\n\t\t},\r\n\t\twhileResolving: function(valueUntilResolved, useLastValue) {\r\n\t\t\treturn valueUntilResolved || arguments.length > 0 ? new WhileResolving(this, valueUntilResolved, useLastValue) :\r\n\t\t\t\tnew WhileResolving(this, undefined, true) // for zero arguments we default to the last value\r\n\t\t},\r\n\t\tvalidate: function(target, schema) {\r\n\t\t\tif (this.returnedVariable) {\r\n\t\t\t\treturn this.returnedVariable.validate(target, schema)\r\n\t\t\t}\r\n\t\t\tif (this.parent) {\r\n\t\t\t\treturn this.parent.validate(target.valueOf(), schema)\r\n\t\t\t}\r\n\t\t\tif (schema) {\r\n\t\t\t\tif (schema.type && (schema.type !== typeof target)) {\r\n\t\t\t\t\treturn ['Target type of ' + typeof target + ' does not match schema type of ' + schema.type]\r\n\t\t\t\t}\r\n\t\t\t\tif (schema.required && (target == null || target == '' || (typeof target === 'number' && isNaN(target)))) {\r\n\t\t\t\t\treturn ['Value is required']\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar valid = []\r\n\t\t\tvalid.isValid = true\r\n\t\t\treturn valid\r\n\t\t},\r\n\t\tset structured(structure) {\r\n\t\t\t// find any variable properties and attaches them as a property\r\n\t\t\tvar keys = Object.keys(this)\r\n\t\t\tvar properties = keys.length > 1 && this._properties || (this._properties = {})\r\n\t\t\tfor(var i = 0, l = keys.length; i < l; i++) {\r\n\t\t\t\tvar key = keys[i]\r\n\t\t\t\tvar value = this[key]\r\n\t\t\t\tif (value instanceof Variable) {\r\n\t\t\t\t\tvar existing = properties[key]\r\n\t\t\t\t\tif (existing) {\r\n\t\t\t\t\t\tif (existing !== value) {\r\n\t\t\t\t\t\t\t// an existing property exists, put in it\r\n\t\t\t\t\t\t\texisting.put(value)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (value.parent) {\r\n\t\t\t\t\t\t\tif (value.parent === this) {\r\n\t\t\t\t\t\t\t\tcontinue // just being assigned to another property\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// property already exists with different parent, make a proxy\r\n\t\t\t\t\t\t\t\tvar newValue = new Variable()\r\n\t\t\t\t\t\t\t\tnewValue.proxy(value)\r\n\t\t\t\t\t\t\t\tvalue = newValue\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvalue.key = key\r\n\t\t\t\t\t\tvalue.parent = this\r\n\t\t\t\t\t\tproperties[key] = value\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tobserveObject: function() {\r\n\t\t\tvar variable = this\r\n\t\t\treturn when(this.valueOf(), function(object) {\r\n\t\t\t\tvar listeners = propertyListenersMap.get(object)\r\n\t\t\t\tif (!listeners) {\r\n\t\t\t\t\tpropertyListenersMap.set(object, listeners = [])\r\n\t\t\t\t}\r\n\t\t\t\tif (listeners.observerCount) {\r\n\t\t\t\t\tlisteners.observerCount++\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlisteners.observerCount = 1\r\n\t\t\t\t\tvar observer = listeners.observer = lang.observe(object, function(events) {\r\n\t\t\t\t\t\tfor (var i = 0, l = listeners.length; i < l; i++) {\r\n\t\t\t\t\t\t\tvar listener = listeners[i]\r\n\t\t\t\t\t\t\tfor (var j = 0, el = events.length; j < el; j++) {\r\n\t\t\t\t\t\t\t\tvar event = events[j]\r\n\t\t\t\t\t\t\t\tlistener._propertyChange(event.name, object)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (observer.addKey) {\r\n\t\t\t\t\t\tfor (var i = 0, l = listeners.length; i < l; i++) {\r\n\t\t\t\t\t\t\tvar listener = listeners[i]\r\n\t\t\t\t\t\t\tlistener.eachKey(function(key) {\r\n\t\t\t\t\t\t\t\tobserver.addKey(key)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tregisterListener(object, variable)\r\n\t\t\t\treturn {\r\n\t\t\t\t\tremove: function() {\r\n\t\t\t\t\t\tderegisterListener(object, variable)\r\n\t\t\t\t\t\tif (!(--listeners.observerCount)) {\r\n\t\t\t\t\t\t\tlisteners.observer.remove()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdone: function() {\r\n\t\t\t\t\t\t// deliver changes\r\n\t\t\t\t\t\tlang.deliverChanges(observer)\r\n\t\t\t\t\t\tthis.remove()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetCollectionOf: function() {\r\n\t\t\treturn this.collectionOf || this.returnedVariable && this.returnedVariable.collectionOf || this.constructor.collectionOf\r\n\t\t},\r\n\t\t_sN: function(name) {\r\n\t\t\t// for compilers to set a name\r\n\t\t\tthis.name = name\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tget _debug() {\r\n\t\t\tif (this.__debug === undefined) {\r\n\t\t\t\tthis.__debug = this.name || (Math.random() + '').slice(2)\r\n\t\t\t}\r\n\t\t\treturn this.__debug\r\n\t\t},\r\n\t\tset _debug(_debug) {\r\n\t\t\tthis.__debug = _debug\r\n\t\t}\r\n\t}\r\n\tObject.defineProperties(VariablePrototype, {\r\n\t\t'=': {\r\n\t\t\tget: function() {\r\n\t\t\t\treturn this.valueOf(true)\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tthis.put(value)\r\n\t\t\t},\r\n\t\t\tenumerable: true\r\n\t\t},\r\n\t\t_lastUpdated: {\r\n\t\t\tget: function() {\r\n\t\t\t\treturn new Date(this.getVersion() / 256 + 1500000000000)\r\n\t\t\t}\r\n\t\t},\r\n\t\tschema: {\r\n\t\t\tget: function() {\r\n\t\t\t\t// default schema is the constructor\r\n\t\t\t\tif (this.returnedVariable) {\r\n\t\t\t\t\treturn this.returnedVariable.schema\r\n\t\t\t\t}\r\n\t\t\t\tif (this.parent) {\r\n\t\t\t\t\tvar parentSchemaProperties = this.parent.schema.properties || this.parent.schema\r\n\t\t\t\t\treturn parentSchemaProperties && parentSchemaProperties[this.key]\r\n\t\t\t\t}\r\n\t\t\t\treturn this.constructor\r\n\t\t\t},\r\n\t\t\tset: function(schema) {\r\n\t\t\t\t// but allow it to be overriden\r\n\t\t\t\tObject.defineProperty(this, 'schema', {\r\n\t\t\t\t\tvalue: schema\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tvalidation: {\r\n\t\t\tget: function() {\r\n\t\t\t\tvar validation = new Validating(this)\r\n\t\t\t\tObject.defineProperty(this, 'validation', {\r\n\t\t\t\t\tvalue: validation\r\n\t\t\t\t})\r\n\t\t\t\treturn validation\r\n\t\t\t},\r\n\t\t\tset: function(validation) {\r\n\t\t\t\t// but allow it to be overriden\r\n\t\t\t\tObject.defineProperty(this, 'validation', {\r\n\t\t\t\t\tvalue: validation\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tfunction changeValue(variable, type, newValue, event) {\r\n\t\tvar key = variable.key\r\n\t\tvar parent = variable.parent\r\n\t\tif (!parent) {\r\n\t\t\treturn variable.put(newValue, event)\r\n\t\t}\r\n\t\tvar object = parent.getValue ? parent.getValue(true) : parent.value\r\n\t\tif (object != null) {\r\n\t\t\tif (typeof object != 'object') {\r\n\t\t\t\t// if the parent is not an object, we can't set anything (that will be retained)\r\n\t\t\t\tvar error = new Error('Can not set property on non-object')\r\n\t\t\t\terror.deniedPut = true\r\n\t\t\t\tthrow error\r\n\t\t\t}\r\n\t\t\tvar oldValue = typeof object.get === 'function' ? object.get(key) : object[key]\r\n\t\t\tif (oldValue === newValue && typeof newValue != 'object') {\r\n\t\t\t\t// no actual change to make\r\n\t\t\t\treturn noChange\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (object && typeof object.set === 'function') {\r\n\t\t\tobject.set(key, newValue, event)\r\n\t\t} else {\r\n\t\t\tif (type == RequestChange && oldValue && oldValue.put && (!newValue && newValue.put)) {\r\n\t\t\t\t// if a put and the property value is a variable, assign it to that.\r\n\t\t\t\treturn oldValue.put(newValue, event)\r\n\t\t\t} else {\r\n\t\t\t\tif (newValue && newValue.then && !newValue.notifies) {\r\n\t\t\t\t\t// wait for it to resolve and then assign\r\n\t\t\t\t\treturn newValue.then(function(newValue) {\r\n\t\t\t\t\t\treturn changeValue(variable, type, newValue, event)\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// copy, if this is a copy-on-write variable\r\n\t\t\t\t\t// nothing there yet, create an object to hold the new property\r\n\t\t\t\t\tvar newObject = object == null\r\n\t\t\t\t\t\t? typeof key == 'number' ? [] : {}\r\n\t\t\t\t\t\t: parent.isWritable\r\n\t\t\t\t\t\t\t? lang.copy(\r\n\t\t\t\t\t\t\t\tobject.constructor === Object\r\n\t\t\t\t\t\t\t\t?\t{}\r\n\t\t\t\t\t\t\t\t:\tobject.constructor === Array\r\n\t\t\t\t\t\t\t\t\t?\t[]\r\n\t\t\t\t\t\t\t\t\t: Object.create(Object.getPrototypeOf(object)), object)\r\n\t\t\t\t\t\t\t: object\r\n\t\t\t\t\tnewObject[key] = newValue\r\n\t\t\t\t}\r\n\t\t\t\t// or set the setter/getter\r\n\t\t\t}\r\n\t\t\tevent = event || new ReplacedEvent()\r\n\t\t\tvar parentEvent = new PropertyChangeEvent(key, event, variable)\r\n\t\t\tparentEvent.oldValue = oldValue\r\n\t\t\tparentEvent.target = variable\r\n\t\t\treturn when(newObject === object ?\r\n\t\t\t\t\tparent.updated(parentEvent, variable) :\r\n\t\t\t\t\tparent.put(newObject, parentEvent), function() {\r\n\t\t\t\tvariable.updated(event, variable)\r\n\t\t\t})\r\n\t\t}\r\n\t\tvariable.updated(event, variable)\r\n\r\n\t\t// now notify any object listeners\r\n\t\tvar listeners = propertyListenersMap.get(object)\r\n\t\t// we need to do it before the other listeners, so we can update it before\r\n\t\t// we trigger a full clobbering of the object\r\n\t\tif (listeners) {\r\n\t\t\tlisteners = listeners.slice(0)\r\n\t\t\tfor (var i = 0, l = listeners.length; i < l; i++) {\r\n\t\t\t\tvar listener = listeners[i]\r\n\t\t\t\tif (listener !== parent) {\r\n\t\t\t\t\t// now go ahead and actually trigger the other listeners (but make sure we don't do the parent again)\r\n\t\t\t\t\tlistener.updated(event)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn newValue\r\n\t}\r\n\r\n\r\n\t// a variable inheritance change goes through its own prototype, so classes/constructor\r\n\t// can be used as variables as well\r\n\tfor (var key in VariablePrototype) {\r\n\t\tObject.defineProperty(Variable, key, Object.getOwnPropertyDescriptor(VariablePrototype, key))\r\n\t}\r\n\r\n\tVariable.as = function(Type) {\r\n\t\tvar NewType = this.with({})\r\n\t\tvar target = NewType.prototype\r\n\t\tvar prototype = Type.prototype\r\n\t\tdo {\r\n\t\t\tvar names = Object.getOwnPropertyNames(prototype)\r\n\t\t\tfor (var i = 0; i < names.length; i++) {\r\n\t\t\t\tvar name = names[i]\r\n\t\t\t\tif (!Object.getOwnPropertyDescriptor(target, name)) {\r\n\t\t\t\t\tObject.defineProperty(target, name, Object.getOwnPropertyDescriptor(prototype, name))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprototype = getPrototypeOf(prototype)\r\n\t\t} while (prototype && prototype !== Variable.prototype)\r\n\t\treturn NewType\r\n\t}\r\n\r\n\tVariable.with = function(properties, ExtendedVariable) {\r\n\t\t// TODO: handle arguments\r\n\t\tvar Base = this\r\n\t\tvar prototype\r\n\t\tif (Object.getOwnPropertyDescriptor(this, 'prototype').writable === false) {\r\n\t\t\t// extending native class\r\n\t\t\tExtendedVariable = lang.extendClass(this)\r\n\t\t\tprototype = ExtendedVariable.prototype\r\n\t\t} else {\r\n\t\t\t// extending function/constructor\r\n\t\t\tif (!ExtendedVariable) {\r\n\t\t\t\tExtendedVariable = function() {\r\n\t\t\t\t\tif (this instanceof ExtendedVariable) {\r\n\t\t\t\t\t\tBase.apply(this, arguments)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn ExtendedVariable.with(properties)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprototype = ExtendedVariable.prototype = Object.create(this.prototype)\r\n\t\t\tprototype.constructor = ExtendedVariable\r\n\t\t\tsetPrototypeOf(ExtendedVariable, this)\r\n\t\t}\r\n\t\treturn ExtendedVariable.assign(properties)\r\n\t}\r\n\tVariable.assign = function(properties) {\r\n\t\tvar prototype = this.prototype\r\n\t\tfunction toType(value) {\r\n\t\t\tif (typeof value === 'object') {\r\n\t\t\t\tif (value instanceof Array) {\r\n\t\t\t\t\treturn value[0] ? VArray.of(toType(value[0])) : VArray\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Variable.with(value)\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === 'string') { // primitive values\r\n\t\t\t\treturn VString(value)\r\n\t\t\t} else if (typeof value === 'number') {\r\n\t\t\t\treturn VNumber(value)\r\n\t\t\t} else if (typeof value === 'boolean') {\r\n\t\t\t\treturn VBoolean(value)\r\n\t\t\t} else if (typeof value === 'function') {\r\n\t\t\t\treturn value // hopefully another type\r\n\t\t\t} else {\r\n\t\t\t\treturn Variable\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (typeof properties !== 'object') {\r\n\t\t\tthis.prototype.default = properties\r\n\t\t\treturn this\r\n\t\t}\r\n\t\tfor (var key in properties) {\r\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(properties, key)\r\n\t\t\tvar value = descriptor.value\r\n\t\t\tif (typeof value !== 'function' && !this.isPrimitive) {\r\n\t\t\t\tvalue = toType(value)\r\n\t\t\t\tif (value.prototype.default !== undefined) {\r\n\t\t\t\t\tif (!prototype.hasOwnProperty('default')){\r\n\t\t\t\t\t\tprototype.default = prototype.default ? Object.create(prototype.default) : {}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprototype.default[key] = value.prototype.default\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof value === 'function' && key !== 'collectionOf') {\r\n\t\t\t\tif (value.notifies) {\r\n\t\t\t\t\t// variable class\r\n\t\t\t\t\tfunction getDescriptor(key, Class) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tget: function() {\r\n\t\t\t\t\t\t\t\tvar property = (this._properties || (this._properties = {}))[key]\r\n\t\t\t\t\t\t\t\tif (!property) {\r\n\t\t\t\t\t\t\t\t\tthis._properties[key] = property = new Class()\r\n\t\t\t\t\t\t\t\t\tproperty.key = key\r\n\t\t\t\t\t\t\t\t\tproperty.parent = this\r\n\t\t\t\t\t\t\t\t\tif (property.listeners) {\r\n\t\t\t\t\t\t\t\t\t\t// if it already has listeners, need to reinit it with the parent\r\n\t\t\t\t\t\t\t\t\t\tproperty.init()\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn property\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tset: function(value) {\r\n\t\t\t\t\t\t\t\tchangeValue(this[key], RequestSet, value)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tenumerable: true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar descriptor = getDescriptor(key, value)\r\n\t\t\t\t\tObject.defineProperty(prototype, key, descriptor)\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tObject.defineProperty(this, key, descriptor)\r\n\t\t\t\t\t} catch(error) {\r\n\t\t\t\t\t\tconsole.warn('Unable to define property', key)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t} else if (isGenerator(value)) {\r\n\t\t\t\t\tdescriptor = getGeneratorDescriptor(value)\r\n\t\t\t\t} else if (value.defineAs) {\r\n\t\t\t\t\tdescriptor = value.defineAs(key, this)\r\n\t\t\t\t\tif (!descriptor) {\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue = generalizeMethod(value, key)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tObject.defineProperty(prototype, key, descriptor)\r\n\t\t\tif (value !== undefined) {\r\n\t\t\t\tif (key in this) {\r\n\t\t\t\t\tObject.defineProperty(this, key, { value: value, configurable: true, enumerable: true })\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis[key] = value\r\n\t\t\t\t}\r\n\t\t\t\tprototype.default\r\n\t\t\t} else {\r\n\t\t\t\t// getter/setter\r\n\t\t\t\tObject.defineProperty(this, key, descriptor)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (properties && properties.hasOwn) {\r\n\t\t\thasOwn.call(this, properties.hasOwn)\r\n\t\t}\r\n\t\treturn this\r\n\t}\r\n\r\n\tObject.defineProperty(Variable, 'defaultInstance', {\r\n\t\tget: function() {\r\n\t\t\treturn this.hasOwnProperty('_defaultInstance') ?\r\n\t\t\t\tthis._defaultInstance : (\r\n\t\t\t\t\tthis._defaultInstance = new this(),\r\n\t\t\t\t\tthis._defaultInstance.subject = defaultContext,\r\n\t\t\t\t\tthis._defaultInstance)\r\n\t\t}\r\n\t})\r\n\tVariable.hasOwn = function(Target, createInstance) {\r\n\t\tvar instanceMap = new lang.WeakMap()\r\n\t\tinstanceMap.createInstance = createInstance\r\n\t\tvar subjectMap = this.ownedClasses || (this.ownedClasses = new lang.WeakMap())\r\n\t\tsubjectMap.set(Target, instanceMap)\r\n\t}\r\n\r\n\r\n\tfunction arrayToModify(variable, callback) {\r\n\t\treturn when(variable.cachedValue || variable.valueOf(true), function(array) {\r\n\t\t\t// if there is a typed array\r\n\t\t\tvar typedArray = variable.valueOf(GET_TYPED_ARRAY)\r\n\t\t\tvar newArray = array ?\r\n\t\t\t\tvariable.isWritable ? array.slice(0) : array\r\n\t\t\t\t: []\r\n\t\t\treturn callback.call(variable, newArray, function(startingIndex, deleteCount, items) {\r\n\t\t\t\tif (startingIndex < 0) {\r\n\t\t\t\t\tstartingIndex = newArray.length + startingIndex\r\n\t\t\t\t}\r\n\t\t\t\tif (startingIndex === newArray.length) {\r\n\t\t\t\t\tvar atEnd = true\r\n\t\t\t\t}\r\n\t\t\t\tvar spliceArgs = [startingIndex, deleteCount]\r\n\t\t\t\tvar results = newArray.splice.apply(newArray, spliceArgs.concat(items))\r\n\t\t\t\tvar collectionOf = variable.collectionOf\r\n\t\t\t\tif (typedArray && collectionOf) {\r\n\t\t\t\t\t// create variable casted items\r\n\t\t\t\t\tvar untypedItems = items\r\n\t\t\t\t\titems = items.map(function(item) {\r\n\t\t\t\t\t\titem = item instanceof collectionOf ? item : collectionOf.from(item)\r\n\t\t\t\t\t\titem.parent = variable\r\n\t\t\t\t\t\treturn item\r\n\t\t\t\t\t})\r\n\t\t\t\t\titems.untypedItems = untypedItems\r\n\t\t\t\t\tresults = typedArray.slice(startingIndex, deleteCount + startingIndex)\r\n\t\t\t\t}\r\n\t\t\t\tvar event = new SplicedEvent(variable, items, results, startingIndex, deleteCount)\r\n\t\t\t\tif (atEnd) {\r\n\t\t\t\t\tevent.atEnd = true\r\n\t\t\t\t}\r\n\t\t\t\tvar addedCount = items.length\r\n\t\t\t\tif (addedCount > 0) {\r\n\t\t\t\t\tvar arrayPosition\r\n\t\t\t\t\tfor (var i = newArray.length - addedCount; i > startingIndex;) {\r\n\t\t\t\t\t\tvar arrayPosition = variable[--i]\r\n\t\t\t\t\t\tif (arrayPosition) {\r\n\t\t\t\t\t\t\tvariable[i] = undefined\r\n\t\t\t\t\t\t\tarrayPosition.key += addedCount\r\n\t\t\t\t\t\t\tvariable[arrayPosition.key] = arrayPosition\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn when(newArray === array ? // if we are just modifying the original array\r\n\t\t\t\t\t\tvariable.updated(event, variable) : // then just send out an updated event\r\n\t\t\t\t\t\tvariable.put(newArray, event), function() { // otherwise put in the new array\r\n\t\t\t\t\tif (typedArray) {\r\n\t\t\t\t\t\t// do this afterwards once we have confirmed that it completed successfully\r\n\t\t\t\t\t\tvariable._typedVersion = variable.version\r\n\t\t\t\t\t\tresults = typedArray.splice.apply(typedArray, spliceArgs.concat(items))\r\n\t\t\t\t\t\t// adjust the key positions of any index properties after splice\r\n\t\t\t\t\t\tif (variable.isWritable) {\r\n\t\t\t\t\t\t\tfor (var i = startingIndex; i < typedArray.length; i++) {\r\n\t\t\t\t\t\t\t\ttypedArray[i].key = i\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvariable.cachedVersion = variable.version // update the cached version, so any version checking will know it has changed\r\n\t\t\t\t\treturn results\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tfunction insertedAt(variable, added, startingIndex, arrayLength, event) {\r\n\t\tvar addedCount = added.length\r\n\t\t// adjust the key positions of any index properties after splice\r\n\t\tif (addedCount > 0) {\r\n\t\t\tevent = event || new SplicedEvent({\r\n\t\t\t\tmodifier: variable,\r\n\t\t\t\tactions: []\r\n\t\t\t})\r\n\t\t\tvar arrayPosition\r\n\t\t\tfor (var i = arrayLength - addedCount; i > startingIndex;) {\r\n\t\t\t\tvar arrayPosition = variable[--i]\r\n\t\t\t\tif (arrayPosition) {\r\n\t\t\t\t\tvariable[i] = undefined\r\n\t\t\t\t\tarrayPosition.key += addedCount\r\n\t\t\t\t\tvariable[arrayPosition.key] = arrayPosition\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// send out updates\r\n\t\t\tfor (var i = 0, l = added.length; i < l; i++) {\r\n\t\t\t\tevent.actions.push({\r\n\t\t\t\t\tvalue: added[i],\r\n\t\t\t\t\tindex: i + startingIndex,\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn event\r\n\t}\r\n\r\n\tfunction removedAt(variable, removed, startingIndex, removalCount, arrayLength) {\r\n\t\t// adjust the properties\r\n\t\tvar i = startingIndex + removalCount\r\n\t\tvar arrayPosition\r\n\t\tif (removalCount > 0) {\r\n\t\t\tvar event = new SplicedEvent({\r\n\t\t\t\tmodifier: variable,\r\n\t\t\t\tactions: []\r\n\t\t\t})\r\n\t\t\tfor (var i = startingIndex + removalCount; i < arrayLength + removalCount; i++) {\r\n\t\t\t\tvar arrayPosition = variable[i]\r\n\t\t\t\tif (arrayPosition) {\r\n\t\t\t\t\tvariable[i] = undefined\r\n\t\t\t\t\tarrayPosition.key -= removalCount\r\n\t\t\t\t\tvariable[arrayPosition.key] = arrayPosition\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// send out updates\r\n\t\t\tfor (var i = 0; i < removalCount; i++) {\r\n\t\t\t\tevent.actions.push({\r\n\t\t\t\t\tpreviousIndex: startingIndex,\r\n\t\t\t\t\toldValue: removed[i]\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tvariable.cachedVersion = variable.version // update the cached version so it doesn't need to be recomputed\r\n\t\t}\r\n\t\treturn event\r\n\t}\r\n\r\n\tif (typeof Symbol !== 'undefined') {\r\n\t\tVariable.prototype[Symbol.iterator] = function() {\r\n\t\t\tvar iterator = this.valueOf(GET_TYPED_OR_UNTYPED_ARRAY)[Symbol.iterator]()\r\n\t\t\tvar variable = this\r\n\t\t\tvar collectionOf = this.collectionOf\r\n\t\t\tif (collectionOf) {\r\n\t\t\t\tvar parent = this\r\n\t\t\t\tvar i = 0\r\n\t\t\t\treturn {\r\n\t\t\t\t\tnext: function() {\r\n\t\t\t\t\t\tvar result = iterator.next()\r\n\t\t\t\t\t\tif (!result.done) {\r\n\t\t\t\t\t\t\tresult.value = variable.property(i++, collectionOf)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn iterator\r\n\t\t}\r\n\t}\r\n\r\n\tvar VMap = Variable.VMap = lang.compose(Variable, function(value){\r\n\t\tif (typeof value !== 'undefined') {\r\n\t\t\tthis.value = value\r\n\t\t}\r\n\t}, {\r\n\t\tfixed: true,\r\n\t\tisWritable: false,\r\n\t\t// TODO: Move all the get and set functionality for maps out of Variable\r\n\t\tproperty: function(key, PropertyClass) {\r\n\t\t\tvar properties = this._properties || (this._properties = new Map())\r\n\t\t\tvar propertyVariable = properties.get(key)\r\n\t\t\tif (!propertyVariable) {\r\n\t\t\t\t// create the property variable\r\n\t\t\t\tpropertyVariable = new (PropertyClass || this.PropertyClass)()\r\n\t\t\t\tpropertyVariable.key = key\r\n\t\t\t\tpropertyVariable.parent = this\r\n\t\t\t\tif (propertyVariable.listeners) {\r\n\t\t\t\t\t// if it already has listeners, need to reinit it with the parent\r\n\t\t\t\t\tpropertyVariable.init()\r\n\t\t\t\t}\r\n\t\t\t\tproperties.set(key, propertyVariable)\r\n\t\t\t}\r\n\t\t\treturn propertyVariable\r\n\t\t}\r\n\t})\r\n\r\n\tvar Transform = Variable.Transform = lang.compose(Variable, function Transform(source, transform, sources, dontCache) {\r\n\t\tif (source !== undefined || sources) {\r\n\t\t\tthis.source = source\r\n\t\t}\r\n\t\tif (transform) {\r\n\t\t\tthis.transform = transform\r\n\t\t\tif (sources) {\r\n\t\t\t\tfor (var i = 1, l = sources.length; i < l; i++) {\r\n\t\t\t\t\tthis['source' + i] = sources[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (dontCache) {\r\n\t\t\tthis.dontCache = true\r\n\t\t}\r\n\t}, {\r\n\t\tgetTransform: function() {\r\n\t\t\treturn this.transform && this.transform.valueOf()\r\n\t\t},\r\n\t\tgetValue: function() {\r\n\t\t\t// first check to see if we have the variable already computed\r\n\t\t\tif (this.readyState == 'invalidated') {\r\n\t\t\t\tthis.readyState = nextVersion.toString()\r\n\t\t\t} else if (isFinite(this.readyState)) {\r\n\t\t\t\t// will un-invalidate this later (contextualizedVariable.readyState = 'up-to-date')\r\n\t\t\t} else if ((this.listeners && this.readyState === 'up-to-date' || this.staysUpdated) && this.cachedVersion > 0) {\r\n\t\t\t\t// it is live, so we can shortcut and just return the cached value\r\n\t\t\t\tif (context) {\r\n\t\t\t\t\tcontext.setVersion(this.cachedVersion)\r\n\t\t\t\t\tif (context.ifModifiedSince >= this.cachedVersion && !this.returnedVariable) {\r\n\t\t\t\t\t\treturn NOT_MODIFIED\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn this.promise || this.cachedValue\r\n\t\t\t}\r\n\t\t\t/*if (!this.hasOwnProperty('source1') && context) {\r\n\t\t\t\t// TODO: Not sure if this is a helpful optimization or not\r\n\t\t\t\t// if we have a single source, we can use ifModifiedSince\r\n\t\t\t\tif (!contextualizedVariable && this.context && this.context.matches(context)) {\r\n\t\t\t\t\t\tcontextualizedVariable = this\r\n\t\t\t\t\t}\r\n\t\t\t}*/\r\n\t\t\tvar readyState = this.readyState\r\n\t\t\tvar parentContext = context\r\n\t\t\tvar transformContext = context = context ? context.newContext() : new Context()\r\n\t\t\tvar args = []\r\n\t\t\tvar isAsyncInputs\r\n\t\t\ttry {\r\n\t\t\t\tif (this.version) {\r\n\t\t\t\t\t// get the version in there\r\n\t\t\t\t\ttransformContext.setVersion(this.version)\r\n\t\t\t\t}\r\n\t\t\t\tif (this && this.cachedVersion == this.version && this.cachedVersion > 0 && !this.hasOwnProperty('source1')) {\r\n\t\t\t\t\ttransformContext.ifModifiedSince = this.cachedVersion\r\n\t\t\t\t}\r\n\t\t\t\t// TODO: var hasCustomTransformFunction = this.transform && this.transform.value === ObjectValueOf\r\n\t\t \t\tvar transform = this.getTransform()\r\n\r\n\t\t\t\tvar argument, argumentName, lastPromiseResult, resolved = []\r\n\t\t\t\tvar afterPromiseResolved\r\n\t\t\t\tvar remaining = 1\r\n\t\t\t\tvar variable = this\r\n\t\t\t\tvar whenArgumentResolved = function(result) {\r\n\t\t\t\t\tresolved[this.__index || 0] = result\r\n\t\t\t\t\tremaining--\r\n\t\t\t\t\tif(remaining === 0) {\r\n\t\t\t\t\t\treturn whenAllResolved()\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn this.__previousPromiseResult\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i = 0; (argument = this[argumentName = i > 0 ? 'source' + i : 'source']) || argumentName in this; i++) {\r\n\t\t\t\t\tif (argument) {\r\n\t\t\t\t\t\tvar result = argument.valueOf(GET_VALID_TYPE)\r\n\t\t\t\t\t\tif (result && result.then) {\r\n\t\t\t\t\t\t\tremaining++\r\n\t\t\t\t\t\t\tif (i === 0) {\r\n\t\t\t\t\t\t\t\tlastPromiseResult = result.then(whenArgumentResolved)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlastPromiseResult = result.then(whenArgumentResolved.bind({\r\n\t\t\t\t\t\t\t\t\t__index: i,\r\n\t\t\t\t\t\t\t\t\t__previousPromiseResult: lastPromiseResult\r\n\t\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolved[i] = result\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolved[i] = argument\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (--remaining === 0) {\r\n\t\t\t\t\treturn whenAllResolved()\r\n\t\t\t\t\t// everything resolved, fast path\r\n\t\t\t\t}\r\n\t\t\t\tisAsyncInputs = true\r\n\t\t\t\tfunction whenAllResolved() {\r\n\t \t\t\t\tif (transformContext.ifModifiedSince !== undefined) {\r\n\t \t\t\t\t\ttransformContext.ifModifiedSince = undefined\r\n\t \t\t\t\t}\r\n\t\t\t\t\tvar version = transformContext.version\r\n\t\t\t\t\tif (variable.cachedVersion >= version || resolved[0] == NOT_MODIFIED) { // note that cached version can get \"ahead\" of `version` of all dependencies, in cases where the transform ends up executing an valueOf() that advances the resolution context version number.\r\n\t\t\t\t\t\t// get it out of the cache\r\n\t\t\t\t\t\tif (parentContext) {\r\n\t\t\t\t\t\t\tparentContext.setVersion(version)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (parentContext && parentContext.ifModifiedSince >= version &&\r\n\t\t\t\t\t\t\t\tparentContext.ifModifiedSince >= variable.cachedVersion &&\r\n\t\t\t\t\t\t\t\t!variable.returnedVariable) {\r\n\t\t\t\t\t\t\treturn NOT_MODIFIED\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn variable.promise || promiseSafeResult(variable.cachedValue)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar result = transform ? transform.apply(variable, resolved) : resolved[0]\r\n\t\t\t\t\tvar isPromise = result && result.then && !result.notifies\r\n\t\t\t\t\tversion = transformContext.version\r\n\r\n\t\t\t\t\tif (isPromise) {\r\n\t\t\t\t\t\tif (variable.promise && variable.promise.abort) {\r\n\t\t\t\t\t\t\t// promises with an abort method can be aborted and replaced with the latest result\r\n\t\t\t\t\t\t\tvariable.promise.replacedResolutionWith = result\r\n\t\t\t\t\t\t\tvariable.promise.abort('Cancelled due to updated value being available')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (variable.readyState === readyState && !variable.dontCache) {\r\n\t\t\t\t\t\t\tvariable.cachedVersion = version\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar promise = variable.promise = result = result.then(function(resolved) {\r\n\t\t\t\t\t\t\tif (promise === variable.promise) { // make sure we are still the latest promise\r\n\t\t\t\t\t\t\t\tvariable.promise = null\r\n\t\t\t\t\t\t\t\tonResolve(resolved, transformContext.version)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn resolved\r\n\t\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\t\tif (promise === variable.promise) { // make sure we are still the latest promise\r\n\t\t\t\t\t\t\t\t// clear out the cache on an error\r\n\t\t\t\t\t\t\t\tvariable.promise = null\r\n\t\t\t\t\t\t\t\tvariable.lastError = error\r\n\t\t\t\t\t\t\t\tonResolve(null, 0)\r\n\t\t\t\t\t\t\t} else if (promise.replacedResolutionWith) {\r\n\t\t\t\t\t\t\t\t// if it was aborted and substituted with the latest promise, return that value\r\n\t\t\t\t\t\t\t\treturn promise.replacedResolutionWith\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthrow error // rethrow so it isn't silenced\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tonResolve(result, version)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn promiseSafeResult(result)\r\n\r\n\t\t\t\t\tfunction promiseSafeResult(result) {\r\n\t\t\t\t\t\tif (isAsyncInputs && result && result.notifies) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t__variable: result\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfunction onResolve(result, version) {\r\n\t\t\t\t\t\tif (variable.readyState === readyState && !variable.dontCache) {\r\n\t\t\t\t\t\t\tif (parentContext) {\r\n\t\t\t\t\t\t\t\tparentContext.setVersion(version)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvariable.cachedVersion = version\r\n\t\t\t\t\t\t\tvariable.cachedValue = result\r\n\t\t\t\t\t\t\tvariable.readyState = (variable.listeners || variable.staysUpdated || parentContext && parentContext.notifies) && version !== 0 ? 'up-to-date' : '' // mark it as up-to-date now\r\n\t\t\t\t\t\t}/* else {\r\n\t\t\t\t\t\t\tconsole.log('ready state different than when the variable trasnform started ', variable, variable.readyState, readyState)\r\n\t\t\t\t\t\t}*/\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (lastPromiseResult.abort) {\r\n\t\t\t\t\t// if abort was propagated, don't propagate past the variable, as we want to finish our resolution of the value\r\n\t\t\t\t\tlastPromiseResult.abort = null\r\n\t\t\t\t}\r\n\t\t\t\treturn lastPromiseResult\r\n\t\t\t} finally {\r\n\t\t\t\tif (parentContext) {\r\n\t\t\t\t\tparentContext.setVersion(transformContext.version)\r\n\t\t\t\t}\r\n\t \t\t\tcontext = parentContext\r\n\t \t\t}\r\n\t \t},\r\n\r\n\t\tforDependencies: function(callback) {\r\n\t\t\t// depend on the args\r\n\t\t\tVariable.prototype.forDependencies.call(this, callback)\r\n\t\t\tvar argument, argumentName\r\n\t\t\tfor (var i = 0; (argument = this[argumentName = i > 0 ? 'source' + i : 'source']) || argumentName in this; i++) {\r\n\t\t\t\tif (argument && argument.notifies) {\r\n\t\t\t\t\tcallback(argument)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tupdated: function(updateEvent, by, isDownstream) {\r\n\t\t\tthis.readyState = 'invalidated'\r\n\t\t\tif (this.promise && !this.promise.abort) { // if it can be aborted, keep it around for better network cleanup, otherwise remove reference for immediate memory cleanup\r\n\t\t\t\tif (this.cachedVersion > 0) {\r\n\t\t\t\t\tthis.cachedVersion = 0\r\n\t\t\t\t}\r\n\t\t\t\tthis.promise = null\r\n\t\t\t}\r\n\t\t\tif (by !== this.returnedVariable && updateEvent && updateEvent.type !== 'replaced') {\r\n\t\t\t\t// search for the output in the sources\r\n\t\t\t\tvar argument, argumentName\r\n\t\t\t\tfor (var i = 0; (argument = this[argumentName = i > 0 ? 'source' + i : 'source']) || argumentName in this; i++) {\r\n\t\t\t\t\tif (argument === by) {\r\n\t\t\t\t\t\t// if one of the args was updated, we need to do a full refresh (we can't compute differential events without knowledge of how the mapping function works)\r\n\t\t\t\t\t\tupdateEvent = new ReplacedEvent(updateEvent)\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn Variable.prototype.updated.call(this, updateEvent, by, isDownstream)\r\n\t\t},\r\n\r\n\t\tcleanup: function() {\r\n\t\t\tif (this.readyState === 'up-to-date' && !this.staysUpdated) {\r\n\t\t\t\tthis.readyState = '' // once there are no listeners, we can't guarantee we are up-to-date\r\n\t\t\t}\r\n\t\t\tVariable.prototype.cleanup.call(this)\r\n\t\t},\r\n\r\n\t\tgetUpdates: function(since) {\r\n\t\t\t// this always issues updates, nothing incremental can flow through it\r\n\t\t\tif (!since || since.version < getVersion()) {\r\n\t\t\t\treturn [new ReplacedEvent()]\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetArguments: function() {\r\n\t\t\tvar args = []\r\n\t\t\tvar argument, argumentName\r\n\t\t\tfor (var i = 0; (argument = this[argumentName = i > 0 ? 'source' + i : 'source']) || argumentName in this; i++) {\r\n\t\t\t\targs.push(argument)\r\n\t\t\t}\r\n\t\t\treturn args\r\n\t\t},\r\n\t\tput: function(value, event) {\r\n\t\t\tvar call = this\r\n\t\t\treturn whenStrict(this.getValue(), function(originalValue) {\r\n\t\t\t\tif (originalValue === value && typeof value != 'object') {\r\n\t\t\t\t\treturn noChange\r\n\t\t\t\t}\r\n\t\t\t\tvar transform = call.transform.valueOf()\r\n\t\t\t\tif (transform.reverse) {\r\n\t\t\t\t\t(transform.reverse).call(call, value, call.getArguments())\r\n\t\t\t\t\treturn call.updated(event)\r\n\t\t\t\t} else if (originalValue && originalValue.put) {\r\n\t\t\t\t\treturn originalValue.put(value, event)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar error = new Error('Can not put value into a one-way transform, that lacks a reversal')\r\n\t\t\t\t\terror.deniedPut = true\r\n\t\t\t\t\tthrow error\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tsetReverse: function(reverse) {\r\n\t\t\tthis.transform.valueOf().reverse = reverse\r\n\t\t\treturn this\r\n\t\t}\r\n\t})\r\n\tObject.defineProperty(Transform.prototype, 'isWritable', {\r\n\t\tget: function() {\r\n\t\t\treturn this.transform && !!this.transform.reverse\r\n\t\t}\r\n\t})\r\n\r\n\tvar RESOLUTION_UPDATE = {}\r\n\t\tWhileResolving = lang.compose(Transform, function WhileResolving(variable, defaultValue, useLastValue) {\r\n\t\tthis.source = variable\r\n\t\tif (defaultValue !== undefined) {\r\n\t\t\tthis.default = defaultValue\r\n\t\t}\r\n\t\tif (useLastValue) {\r\n\t\t\tthis.useLastValue = true\r\n\t\t}\r\n\t}, {\r\n\t\tfixed: true,\r\n\t\tgetValue: function() {\r\n\t\t\tvar result = Transform.prototype.getValue.call(this)\r\n\t\t\tif (result && result.then) {\r\n\t\t\t\tvar version = this.version\r\n\t\t\t\tvar variable = this\r\n\t\t\t\tresult.then(function(value) {\r\n\t\t\t\t\tif (version === variable.version) {\r\n\t\t\t\t\t\tVariable.prototype.updated.call(variable)\r\n\t\t\t\t\t\tvariable.cachedVersion = variable.version\r\n\t\t\t\t\t}\r\n\t\t\t\t}, function (error) {\r\n\t\t\t\t\t// we have to go into an error state so the subsequent request can throw\r\n\t\t\t\t\tconsole.error('Variable resolution failed', error)\r\n\t\t\t\t\tif (version === variable.version) {\r\n\t\t\t\t\t\tVariable.prototype.updated.call(variable)\r\n\t\t\t\t\t\tvariable.cachedVersion = variable.version\r\n\t\t\t\t\t\tvariable.cachedValue = 'Error occurred: ' + error\r\n\t\t\t\t\t\tvariable.readyState = 'up-to-date'\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn this.useLastValue && 'cachedValue' in this ? this.cachedValue : this.default\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t},\r\n\t\tput: function(value, event) {\r\n\t\t\treturn this.source.put(value, event)\r\n\t\t}\r\n\t})\r\n\r\n\tvar ContextualTransform = lang.compose(Transform, function ContextualTransform() {\r\n\t\tTransform.apply(this, arguments)\r\n\t}, {\r\n\t\tgetValue: function() {\r\n\t\t\t// first check to see if we have the variable already computed\r\n\t\t\tvar contextualizedVariable = context ? context.getContextualized(this) : this\r\n\t\t\tif (contextualizedVariable && contextualizedVariable !== this) {\r\n\t\t\t\treturn contextualizedVariable.getValue()\r\n\t\t\t}\r\n\t\t\treturn Transform.prototype.getValue.call(this)\r\n\t\t},\r\n\t\t_needsContextualization: true\r\n\t})\r\n\r\n\tvar Item = lang.compose(Variable, function Item(value, content) {\r\n\t\tthis.value = value\r\n\t\tthis.collection = content\r\n\t}, {})\r\n\r\n\tvar ContextualizedVariable = lang.compose(Variable, function ContextualizedVariable(generic, subject) {\r\n\t\tthis.generic = generic\r\n\t\tthis.subject = subject\r\n\t}, {\r\n\t\tvalueOf: function() {\r\n\t\t\t// TODO: Lookup Context type for all of these using registry or something\r\n\t\t\tvar subject = this.subject\r\n\t\t\tvar context = subject.getContextualized ? subject : new Context(subject)\r\n\t\t\tvar generic = this.generic\r\n\t\t\treturn context.executeWithin(function() {\r\n\t\t\t\treturn generic.valueOf()\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\tforDependencies: function(callback) {\r\n\t\t\tthis.sources && this.sources.forEach(callback)\r\n\t\t},\r\n\r\n\t\tgetVersion: function() {\r\n\t\t\tvar version = Variable.prototype.getVersion.call(this)\r\n\t\t\tvar sources = this.sources || 0\r\n\t\t\tfor (var i = 0, l = sources.length; i < l; i++) {\r\n\t\t\t\tvar source = sources[i]\r\n\t\t\t\tif (source.getFullVersion) {\r\n\t\t\t\t\tversion = Math.max(version, source.getFullVersion())\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn version\r\n\t\t},\r\n\r\n\t\tput: function(value, event) {\r\n\t\t\tvar subject = this.subject\r\n\t\t\treturn this.generic.put(value, event)\r\n\t\t}\r\n\t})\r\n\r\n\tvar VArray = lang.compose(Variable, function VArray(value) {\r\n\t\treturn makeSubVar(this, value, VArray)\r\n\t}, {\r\n\t\tvalueOf: function(mode) {\r\n\t\t\tvar value = Variable.prototype.valueOf.call(this, mode)\r\n\t\t\tvar varray = this\r\n\t\t\treturn when(value, function(array) {\r\n\t\t\t\tif (mode && mode.getTyped) {\r\n\t\t\t\t\tif (mode.allowUntyped) {\r\n\t\t\t\t\t\tif (!array) {\r\n\t\t\t\t\t\t\treturn []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn // untyped not allowed\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (!array) {\r\n\t\t\t\t\tif (mode && mode.ensureValidType) {\r\n\t\t\t\t\t\treturn []\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn array\r\n\t\t\t\t}\r\n\t\t\t\tif (varray.sortFunction && varray._sortedArray != array) {\r\n\t\t\t\t\t// we have a sort function, and a new incoming array, need to resort\r\n\t\t\t\t\tvar reversed = varray.reversed\r\n\t\t\t\t\tvar sortFunction = varray.sortFunction\r\n\t\t\t\t\tvarray.sortFunction = null // null this so we don't reenter here\r\n\t\t\t\t\tarray = varray.sort(sortFunction)\r\n\t\t\t\t\tif (reversed) {\r\n\t\t\t\t\t\tvarray.reversed()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn array\r\n\t\t\t})\r\n\t\t},\r\n\t\tforEach: function(callback, instance) {\r\n\t\t\treturn when(this.valueOf(GET_TYPED_OR_UNTYPED_ARRAY), function(array) {\r\n\t\t\t\tarray.forEach(callback, instance)\r\n\t\t\t})\r\n\t\t},\r\n\t\tsplice: function(start, deleteCount) {\r\n\t\t\tvar args = arguments\r\n\t\t\treturn arrayToModify(this, function(array, doSplice) {\r\n\t\t\t\treturn doSplice(start, deleteCount, [].slice.call(args, 2))\r\n\t\t\t})\r\n\t\t},\r\n\t\tpush: function() {\r\n\t\t\tvar args = arguments\r\n\t\t\treturn arrayToModify(this, function(array, doSplice) {\r\n\t\t\t\treturn when(doSplice(array.length, 0, [].slice.call(args)), function(results) {\r\n\t\t\t\t\treturn array.length\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tunshift: function() {\r\n\t\t\tvar args = arguments\r\n\t\t\treturn arrayToModify(this, function(array, doSplice) {\r\n\t\t\t\treturn when(doSplice(0, 0, [].slice.call(args)), function(results) {\r\n\t\t\t\t\treturn array.length\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tpop: function() {\r\n\t\t\treturn arrayToModify(this, function(array, doSplice) {\r\n\t\t\t\treturn when(doSplice(array.length - 1, 1, []), function(results) {\r\n\t\t\t\t\treturn results[0]\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tshift: function() {\r\n\t\t\treturn arrayToModify(this, function(array, doSplice) {\r\n\t\t\t\treturn when(doSplice(0, 1, []), function(results) {\r\n\t\t\t\t\treturn results[0]\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tsort: function(compareFunction) {\r\n\t\t\tvar variable = this\r\n\t\t\treturn when(this.valueOf(true), function(array) {\r\n\t\t\t\tvar typedArray = variable.valueOf(GET_TYPED_ARRAY)\r\n\t\t\t\tif (typedArray) {\r\n\t\t\t\t\tvar combined = []\r\n\t\t\t\t\tfor (var l = array.length, i = 0; i < l; i++) {\r\n\t\t\t\t\t\tcombined.push({\r\n\t\t\t\t\t\t\ttyped: typedArray[i],\r\n\t\t\t\t\t\t\tuntyped: array[i]\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcombined.sort(function(a, b) {\r\n\t\t\t\t\t\treturn compareFunction(a.typed, b.typed)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tarray.splice(0, array.length) // clear and replace with sorted untyped values\r\n\t\t\t\t\tarray.push.apply(array, combined.map(function(combined) {\r\n\t\t\t\t\t\treturn combined.untyped\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tvariable._typedArray = combined.map(function(combined) {\r\n\t\t\t\t\t\treturn combined.typed\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tarray.sort(compareFunction)\r\n\t\t\t\t}\r\n\t\t\t\tif (variable.source) {\r\n\t\t\t\t\tvariable.sortFunction = compareFunction\r\n\t\t\t\t\tvariable._sortedArray = array\r\n\t\t\t\t\tif (variable.reversed) {\r\n\t\t\t\t\t\tvariable.reversed = false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvariable.updated() // this is treated as an in-place update with no upstream impact\r\n\t\t\t\tvariable.cachedVersion = variable.version\r\n\t\t\t\tif (variable._typedArray) {\r\n\t\t\t\t\tvariable._typedVersion = variable.version\r\n\t\t\t\t}\r\n\t\t\t\treturn array\r\n\t\t\t})\r\n\t\t},\r\n\t\treverse: function() {\r\n\t\t\tvar variable = this\r\n\t\t\treturn when(this.valueOf(GET_TYPED_OR_UNTYPED_ARRAY), function(array) {\r\n\t\t\t\tarray.reverse()\r\n\t\t\t\tif (variable.source) {\r\n\t\t\t\t\tvariable.reversed = !variable.reversed\r\n\t\t\t\t}\r\n\t\t\t\tvariable.updated() // this is treated as an in-place update with no upstream impact\r\n\t\t\t\treturn array\r\n\t\t\t})\r\n\t\t},\r\n\t\tslice: function(start, end) {\r\n\t\t\treturn when(this.valueOf(true), function(array) {\r\n\t\t\t\treturn array.slice(start, end)\r\n\t\t\t})\r\n\t\t},\r\n\t\tindexOf: function(idOrValue) {\r\n\t\t\t// TODO: After a certain threshold of accesses we should build an index for O(1) time access\r\n\t\t\tvar array = this.valueOf(GET_TYPED_OR_UNTYPED_ARRAY)\r\n\t\t\treturn array.indexOf(idOrValue)\r\n\t\t},\r\n\t\tincludes: function(idOrValue) {\r\n\t\t\treturn this.indexOf(idOrValue) > -1\r\n\t\t},\r\n\t\t// id-based methods:\r\n\t\tfor: function(idOrValue) {\r\n\t\t\tif (this.source) {\r\n\t\t\t\treturn this.source.for(idOrValue)\r\n\t\t\t}\r\n\t\t\tvar i = this.indexOf(idOrValue)\r\n\t\t\tvar array = this.valueOf()\r\n\t\t\tvar instance = new this.collectionOf.from(array[i] || {})\r\n\t\t\tinstance.id = idOrValue\r\n\t\t\treturn instance\r\n\t\t},\r\n\t\t// Set methods:\r\n\t\tadd: function(value) {\r\n\t\t\tif (this.indexOf(value) === -1) {\r\n\t\t\t\tthis.push(value)\r\n\t\t\t}\r\n\t\t},\r\n\t\tdelete: function(instanceOrId) {\r\n\t\t\tvar removeIndex = this.indexOf(instanceOrId)\r\n\t\t\tif (removeIndex > -1) {\r\n\t\t\t\tthis.splice(removeIndex, 1)\r\n\t\t\t}\r\n\t\t\treturn this\r\n\t\t},\r\n\t\tclear: function() {\r\n\t\t\tthis.is([])\r\n\t\t},\r\n\t\thas: function(idOrValue) { // same as includes\r\n\t\t\treturn this.indexOf(idOrValue) > -1\r\n\t\t}\r\n\t})\r\n\tObject.defineProperty(VArray.prototype, 'length', {\r\n\t\tget: function() {\r\n\t\t\tif (typeof this !== 'function') {\r\n\t\t\t\tvar properties = this._properties || (this._properties = {})\r\n\t\t\t\tif (!properties.length) {\r\n\t\t\t\t\tvar length = properties.length = new VNumber()\r\n\t\t\t\t\tlength.key = 'length'\r\n\t\t\t\t\tlength.parent = this\r\n\t\t\t\t\tObject.defineProperty(this, 'length', {\r\n\t\t\t\t\t\tconfigurable: true,\r\n\t\t\t\t\t\tvalue: length\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn length\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tconfigurable: true,\r\n\t\tset: function(length) {\r\n\t\t\t// allow overriding\r\n\t\t\tthis.value.length = length\r\n\t\t},\r\n\t})\r\n\tVArray.of = function(collectionOf) {\r\n\t\tvar ArrayClass = VCollection({collectionOf: collectionOf})\r\n\t\tif (this !== VArray) {\r\n\t\t\t// new operator\r\n\t\t\treturn new ArrayClass()\r\n\t\t}\r\n\t\treturn ArrayClass\r\n\t}\r\n\r\n\tfunction setToArray(set) {\r\n\t\tvar newArray = []\r\n\t\tif (set.forEach) {\r\n\t\t\tset.forEach(function(item) {\r\n\t\t\t\tnewArray.push(item)\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn newArray\r\n\t}\r\n\r\n\tvar getValue\r\n\tvar GeneratorVariable = lang.compose(Transform, function ReactiveGenerator(generator){\r\n\t\tthis.generator = generator\r\n\t}, {\r\n\t\ttransform: {\r\n\t\t\tvalueOf: function() {\r\n\t\t\t\tvar generatorContext = context\r\n\t\t\t\tvar resuming\r\n\t\t\t\treturn next\r\n\t\t\t\tfunction next() {\r\n\t\t\t\t\tvar nextValue\r\n\t\t\t\t\tvar i\r\n\t\t\t\t\tvar generatorIterator\r\n\t\t\t\t\tvar isThrowing\r\n\t\t\t\t\tif (resuming) {\r\n\t\t\t\t\t\t// resuming from a promise\r\n\t\t\t\t\t\tgeneratorIterator = resuming.iterator\r\n\t\t\t\t\t\ti = resuming.i\r\n\t\t\t\t\t\tnextValue = resuming.value\r\n\t\t\t\t\t\tif (nextValue && nextValue.then) {\r\n\t\t\t\t\t\t\tthrow new Error('Generator resumed with promise or variable', nextValue)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisThrowing = resuming.isThrowing\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (generatorContext) {\r\n\t\t\t\t\t\t\t// must restart the context, if the input values had previously been checked and hashed against this context, must restart them.\r\n\t\t\t\t\t\t\tgeneratorContext.restart()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ti = 0\r\n\t\t\t\t\t\tgeneratorIterator = this.generator()\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tvar stepReturn = generatorIterator[isThrowing ? 'throw' : 'next'](nextValue)\r\n\t\t\t\t\t\tif (stepReturn.done) {\r\n\t\t\t\t\t\t\tvar oldSources = this.sources || []\r\n\t\t\t\t\t\t\tvar newLength = i\r\n\t\t\t\t\t\t\tvar newSources = []\r\n\t\t\t\t\t\t\twhile(this[argumentName = i > 0 ? 'source' + i : 'source']) {\r\n\t\t\t\t\t\t\t\t// clear out old properties\r\n\t\t\t\t\t\t\t\tthis[argumentName] = undefined\r\n\t\t\t\t\t\t\t\ti++\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (i = 0; i < newLength; i++) {\r\n\t\t\t\t\t\t\t\t// create new array\r\n\t\t\t\t\t\t\t\tvar argumentName = i > 0 ? 'source' + i : 'source'\r\n\t\t\t\t\t\t\t\tif (this[argumentName] && this[argumentName].notifies) {\r\n\t\t\t\t\t\t\t\t\tnewSources.push(this[argumentName])\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (i = 0; i < oldSources.length; i++) {\r\n\t\t\t\t\t\t\t\tif (newSources.indexOf(oldSources[i]) == -1) {\r\n\t\t\t\t\t\t\t\t\toldSources[i].stopNotifies(this)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.sources = newSources\r\n\t\t\t\t\t\t\treturn stepReturn.value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnextValue = stepReturn.value\r\n\t\t\t\t\t\t// compare with the arguments from the last\r\n\t\t\t\t\t\t// execution to see if they are the same\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tvar argumentName = i > 0 ? 'source' + i : 'source'\r\n\t\t\t\t\t\t\tif (this[argumentName] !== nextValue || this[argumentName] === undefined) {\r\n\t\t\t\t\t\t\t\t// subscribe if it is a variable\r\n\t\t\t\t\t\t\t\tif (nextValue && nextValue.notifies) {\r\n\t\t\t\t\t\t\t\t\tif (this.listeners) {\r\n\t\t\t\t\t\t\t\t\t\tnextValue.notifies(this)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tthis[argumentName] = nextValue\r\n\t\t\t\t\t\t\t\t} else if (typeof nextValue === 'function' && isGenerator(nextValue)) {\r\n\t\t\t\t\t\t\t\t\tresuming = {\r\n\t\t\t\t\t\t\t\t\t\ti: i,\r\n\t\t\t\t\t\t\t\t\t\titerator: nextValue()\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnext.call(this)\r\n\t\t\t\t\t\t\t\t\ti = resuming.i\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis[argumentName] = null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti++\r\n\t\t\t\t\t\t\tif (nextValue && nextValue.then) {\r\n\t\t\t\t\t\t\t\t// if it is a promise or variable, we will wait on it\r\n\t\t\t\t\t\t\t\tvar variable = this\r\n\t\t\t\t\t\t\t\tresuming = {\r\n\t\t\t\t\t\t\t\t\ti: i,\r\n\t\t\t\t\t\t\t\t\titerator: generatorIterator\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tvar isSync = null\r\n\t\t\t\t\t\t\t\t// and return the promise so that the next caller can wait on this\r\n\t\t\t\t\t\t\t\tvar promise = nextValue.then(function(value) {\r\n\t\t\t\t\t\t\t\t\tif (isSync !== false) {\r\n\t\t\t\t\t\t\t\t\t\tisSync = true\r\n\t\t\t\t\t\t\t\t\t\tnextValue = value\r\n\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tresuming.value = value\r\n\t\t\t\t\t\t\t\t\tif (generatorContext) {\r\n\t\t\t\t\t\t\t\t\t\treturn generatorContext.executeWithin(next.bind(variable))\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn next.call(variable)\r\n\t\t\t\t\t\t\t\t}, function(error) {\r\n\t\t\t\t\t\t\t\t\tresuming.value = error\r\n\t\t\t\t\t\t\t\t\tresuming.isThrowing = true\r\n\t\t\t\t\t\t\t\t\tif (generatorContext) {\r\n\t\t\t\t\t\t\t\t\t\treturn generatorContext.executeWithin(next.bind(variable))\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\treturn next.call(variable)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tif (!isSync) {\r\n\t\t\t\t\t\t\t\t\tisSync = false\r\n\t\t\t\t\t\t\t\t\treturn promise\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tisThrowing = false\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\tisThrowing = true\r\n\t\t\t\t\t\t\tnextValue = error\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} while(true)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tvar Validating = lang.compose(Transform, function(source) {\r\n\t\tthis.source = source\r\n\t}, {\r\n\t\ttransform: function(target) {\r\n\t\t\tvar target = this.source\r\n\t\t\treturn target && target.validate(target, target.schema)\r\n\t\t}\r\n\t})\r\n\r\n\tfunction makeSubVar(instance, value, Type) {\r\n\t\tif (instance instanceof Variable) {\r\n\t\t\tVariable.call(instance, value)\r\n\t\t} else {\r\n\t\t\treturn Type.with(value)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction objectUpdated(object) {\r\n\t\t// simply notifies any subscribers to an object, that it has changed\r\n\t\tvar listeners = propertyListenersMap.get(object)\r\n\t\tif (listeners) {\r\n\t\t\tfor (var i = 0, l = listeners.length; i < l; i++) {\r\n\t\t\t\tlisteners[i]._propertyChange(null, object)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar argsToArray = {\r\n\t\tapply: function(instance, args) {\r\n\t\t\treturn args\r\n\t\t},\r\n\t\treverse: function(value, args) {\r\n\t\t\t// reverse the conversion, putting an array of values into the source inputs\r\n\t\t\treturn args.map(function(arg, i) {\r\n\t\t\t\treturn arg.put(value[i])\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction all(array, transform) {\r\n\t\t// This is intended to mirror Promise.all. It actually takes\r\n\t\t// an iterable, but for now we are just looking for array-like\r\n\t\tif (array instanceof Array) {\r\n\t\t\tif (array.length > 0 || typeof transform === 'function') {\r\n\t\t\t\t// TODO: Return VArray Transform\r\n\t\t\t\treturn new Transform(array[0], typeof transform === 'function' ? transform : argsToArray, array, true)\r\n\t\t\t} else {\r\n\t\t\t\treturn new VArray([])\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (arguments.length > 1) {\r\n\t\t\t// support multiple arguments as an array\r\n\t\t\treturn new Transform(arguments[0], argsToArray, arguments, true).as(VArray)\r\n\t\t}\r\n\t\tif (typeof array === 'object') {\r\n\t\t\t// allow an object as a hash to be mapped\r\n\t\t\tvar keyMapping = []\r\n\t\t\tvar valueArray = []\r\n\t\t\tfor (var key in array) {\r\n\t\t\t\tkeyMapping.push(key)\r\n\t\t\t\tvalueArray.push(array[key])\r\n\t\t\t}\r\n\t\t\treturn new Variable(function(results) {\r\n\t\t\t\tvar resultObject = {}\r\n\t\t\t\tfor (var i = 0; i < results.length; i++) {\r\n\t\t\t\t\tresultObject[keyMapping[i]] = results[i]\r\n\t\t\t\t}\r\n\t\t\t\treturn resultObject\r\n\t\t\t}).apply(null, valueArray)\r\n\t\t}\r\n\t\tthrow new TypeError('Variable.all requires an array')\r\n\t}\r\n\r\n\tfunction hasOwn(Target, createForInstance) {\r\n\r\n\t\tvar ownedClasses = this.ownedClasses || (this.ownedClasses = new lang.WeakMap())\r\n\t\t// TODO: assign to super classes\r\n\t\tvar Class = this\r\n\t\townedClasses.set(Target, createForInstance || function() { return new Target() })\r\n\t\treturn this\r\n\t}\r\n\tfunction generalizeClass() {\r\n\t\tvar prototype = this.prototype\r\n\t\tvar prototypeNames = Object.getOwnPropertyNames(prototype)\r\n\t\tfor(var i = 0, l = prototypeNames.length; i < l; i++) {\r\n\t\t\tvar name = prototypeNames[i]\r\n\t\t\tObject.defineProperty(this, name, getGeneralizedDescriptor(Object.getOwnPropertyDescriptor(prototype, name), name, this))\r\n\t\t}\r\n\t}\r\n\tfunction getGeneralizedDescriptor(descriptor, name, Class) {\r\n\t\tif (typeof descriptor.value === 'function') {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: generalizeMethod(Class, name)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn descriptor\r\n\t\t}\r\n\t}\r\n\tfunction generalizeMethod(Class, name) {\r\n\t\t// I think we can just rely on `this`, but we could use the argument:\r\n\t\t// function(possibleEvent) {\r\n\t\t// \tvar target = possibleEvent && possibleEvent.target\r\n\t\tvar method = Class[name] = function() {\r\n\t\t\tvar instance = Class.for(this)\r\n\t\t\treturn instance[name].apply(instance, arguments)\r\n\t\t}\r\n\t\tmethod.for = function(context) {\r\n\t\t\tvar instance = Class.for(context)\r\n\t\t\treturn function() {\r\n\t\t\t\treturn instance[name].apply(instance, arguments)\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn method\r\n\t}\r\n\tfunction delayUpdate(variable, promise) {\r\n\t\tvar originalUpdated = variable.updated\r\n\t\tvariable.updated = function() {\r\n\t\t\tvar event = originalUpdated.apply(this, arguments)\r\n\t\t\tevent.visited.enqueueUpdate = function(update) {\r\n\t\t\t\tpromise.then(update)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar defaultContext = {\r\n\t\tname: 'Default context',\r\n\t\tdescription: 'This object is the default context for classes, corresponding to a singleton instance of that class',\r\n\t\tconstructor: {\r\n\t\t\tgetForClass: function(subject, Class) {\r\n\t\t\t\treturn Class.defaultInstance\r\n\t\t\t}\r\n\t\t},\r\n\t\tcontains: function() {\r\n\t\t\treturn true // contains everything\r\n\t\t}\r\n\t}\r\n\tfunction instanceForContext(Class, context) {\r\n\t\tif (!context) {\r\n\t\t\treturn Class.defaultInstance\r\n\t\t}\r\n\t\tvar instance = context.specify(Class)\r\n\t\tif (!context.instanceMap) {\r\n\t\t\tcontext.instanceMap = new Map()\r\n\t\t}\r\n\t\tcontext.instanceMap.set(Class, instance)\r\n\t\treturn instance\r\n//\t\tvar instance = context.subject.constructor.getForClass && context.subject.constructor.getForClass(context.subject, Class) || Class.defaultInstance\r\n//\t\tcontext.distinctSubject = mergeSubject(context.distinctSubject, instance.subject)\r\n//\t\treturn instance\r\n\t}\r\n\tVariable.valueOf = function(allowPromise) {\r\n\t\t// contextualized valueOf\r\n\t\treturn instanceForContext(this, context).valueOf(allowPromise)\r\n\t}\r\n\tVariable.then = function(callback, errback) {\r\n\t\t// contextualized valueOf\r\n\t\treturn instanceForContext(this, context).then(callback, errback)\r\n\t}\r\n\tVariable.getValue = function(forChild) {\r\n\t\t// contextualized getValue\r\n\t\treturn instanceForContext(this, context).getValue(forChild)\r\n\t}\r\n\tVariable.put = function(value) {\r\n\t\t// contextualized setValue\r\n\t\treturn instanceForContext(this, context).put(value)\r\n\t}\r\n\tVariable.for = function(subject) {\r\n\t\tif (subject != null) {\r\n\t\t\tif (typeof subject == 'object') {\r\n\t\t\t\tif (subject.target && !subject.constructor.getForClass) {\r\n\t\t\t\t\t// makes HTML events work\r\n\t\t\t\t\tsubject = subject.target\r\n\t\t\t\t}\r\n\t\t\t\tvar instance\r\n\t\t\t\tinstance = new Context(subject).specify(this)\r\n\t\t\t\tif (instance && !instance.subject) {\r\n\t\t\t\t\tinstance.subject = subject\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn this.collection.for(subject)\r\n\t\t\t}\r\n\t\t\t// TODO: Do we have a global context that we set on defaultInstance?\r\n\t\t\treturn instance || this.defaultInstance\r\n\t\t} else {\r\n\t\t\treturn this.defaultInstance\r\n\t\t}\r\n\t}\r\n\tVariable.from = function(value) {\r\n\t\tif (value && typeof value === 'object') {\r\n\t\t\t// a plain object, we use our own map to retrieve the instance (or create one)\r\n\t\t\tvar instanceMap = this.instanceMap || (this.instanceMap = new lang.WeakMap())\r\n\t\t\tvar instance = instanceMap.get(value)\r\n\t\t\tif (!instance) {\r\n\t\t\t\tinstanceMap.set(value, instance = new this(value))\r\n\t\t\t}\r\n\t\t\treturn instance\r\n\t\t} else {\r\n\t\t\t// a primitive, just unconditionally create a new variable for it\r\n\t\t\treturn new this(value)\r\n\t\t}\r\n\t}\r\n\tVariable.notifies = function(target) {\r\n\t\tvar instance = instanceForContext(this, context)\r\n\t\tinstance.notifies(target)\r\n\t\treturn instance\r\n\t}\r\n\tVariable.stopNotifies = function(target) {\r\n\t\tthis.defaultInstance.stopNotifies(target)\r\n\t}\r\n\tVariable.getCollectionOf = function () {\r\n\t\treturn this.collectionOf\r\n\t}\r\n\tVariable.updated = function(updateEvent, by) {\r\n\t\treturn instanceForContext(this, context).updated(updateEvent, by)\r\n\t}\r\n\tVariable._Transform = ContextualTransform;\r\n\r\n\t// delegate to the variable's collection\r\n\t['add', 'delete', 'clear', 'filter', 'map', 'forEach', 'slice', 'push', 'splice', 'pop', 'shift', 'unshift'].forEach(function(name) {\r\n\t\tVariable[name] = function() {\r\n\t\t\treturn this.collection[name].apply(this.collection, arguments)\r\n\t\t}\r\n\t\t// preserve array functionality on static methods of VArray\r\n\t\tVArray[name] = VArray.prototype[name]\r\n\t})\r\n\t// create a new variable with a default value\r\n\tVariable.default = function(value) {\r\n\t\treturn Variable.with({default: value})\r\n\t}\r\n\r\n\tvar proxyHandler = {\r\n\t\tget: function(target, name) {\r\n\t\t\tvar value = target[name]\r\n\t\t\treturn value === undefined ? target.property(name) : value\r\n\t\t},\r\n\t\tset: function(target, name, value) {\r\n\t\t\tvar oldValue = target[name]\r\n\t\t\tif (oldValue && oldValue.put) {\r\n\t\t\t\t// own property available to put into\r\n\t\t\t\toldValue.put(value)\r\n\t\t\t} else {\r\n\t\t\t\ttarget.set(name, value)\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t},\r\n\t\thas: function(target, name) {\r\n\t\t\treturn (name in target) || (name in target.valueOf())\r\n\t\t},\r\n\t\tdeleteProperty: function(target, name) {\r\n\t\t\treturn proxyHandler.set(target, name, undefined)\r\n\t\t},\r\n\t\townKeys: function(target) {\r\n\t\t\treturn Object.getOwnPropertyNames(target.valueOf())\r\n\t\t}\r\n\t}\r\n\tVariable.proxy = function(source) {\r\n\t\t// should we memoize?\r\n\t\treturn new Proxy(source instanceof this ? source : this.from(source), proxyHandler)\r\n\t}\r\n\tObject.defineProperty(Variable, 'collectionOf', {\r\n\t\tget: function() {\r\n\t\t\treturn this._collectionOf\r\n\t\t},\r\n\t\tset: function(ItemClass) {\r\n\t\t\tif (this._collectionOf != ItemClass) {\r\n\t\t\t\tthis._collectionOf = ItemClass\r\n\t\t\t\tItemClass.collection = this\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tObject.defineProperty(Variable, 'collection', {\r\n\t\tget: function() {\r\n\t\t\tif (this.hasOwnProperty('_collection')) {\r\n\t\t\t\treturn this._collection\r\n\t\t\t}\r\n\t\t\tthis.collection = new VCollection()\r\n\t\t\tthis.collection.fixed = true // by default a model collection does not need to replace the array each time it is changed\r\n\t\t\treturn this.collection\r\n\t\t},\r\n\t\tset: function(Collection) {\r\n\t\t\tif (!this.hasOwnProperty('_collection') || this._collection != Collection) {\r\n\t\t\t\tthis._collection = Collection\r\n\t\t\t\tCollection.collectionOf = this\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tVariable.generalize = generalizeClass\r\n\tVariable.call = Function.prototype.call // restore these\r\n\tVariable.apply = Function.prototype.apply\r\n\r\n\tfunction VFunction() {\r\n\t}\r\n\t(VFunction.returns = function(Type){\r\n\t\tfunction VFunction() {}\r\n\t\tVFunction.defineAs = function(method)\t{\r\n\t\t\treturn {\r\n\t\t\t\tvalue: function() {\r\n\t\t\t\t\tvar args = arguments\r\n\t\t\t\t\t// TODO: make these args part of the call so variables can be resolved\r\n\t\t\t\t\t// TODO: may actually want to do getValue().invoke()\r\n\t\t\t\t\treturn new Type(new Transform(this, function(value) {\r\n\t\t\t\t\t\t\treturn value == null ? undefined : value[method].apply(value, args)\r\n\t\t\t\t\t}))\r\n\t\t\t\t},\r\n\t\t\t\twritable: true,\r\n\t\t\t\tconfigurable: true\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn VFunction\r\n\t})\r\n\r\n\tfunction VMethod() {\r\n\t}\r\n\tVMethod.defineAs = function(method) {\r\n\t\treturn {\r\n\t\t\tvalue: function() {\r\n\t\t\t\tvar args = arguments\r\n\t\t\t\t// TODO: make these args part of the call so variables can be resolved\r\n\t\t\t\t// TODO: may actually want to do getValue().invoke()\r\n\t\t\t\tvar variable = this\r\n\t\t\t\treturn when(this.valueOf(), function(value) {\r\n\t\t\t\t\tif (!value || !value[method]) {\r\n\t\t\t\t\t\tvalue = new variable.constructor.wrapsType(value)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar returnValue = value[method].apply(value, args)\r\n\t\t\t\t\treturn when(variable.put(value), function() {\r\n\t\t\t\t\t\treturn returnValue\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\twritable: true,\r\n\t\t\tconfigurable: true\r\n\t\t}\r\n\t}\r\n\r\n\tfunction VString(value) {\r\n\t\treturn makeSubVar(this, (typeof value === 'object' || value === undefined) ? value : String(value), VString)\r\n\t}\r\n\r\n\tfunction VNumber(value) {\r\n\t\treturn makeSubVar(this, (typeof value === 'object' || value === undefined) ? value : Number(value), VNumber)\r\n\t}\r\n\r\n\tVString = Variable.with({\r\n\t\tcharAt: VFunction.returns(VString),\r\n\t\tcodeCharAt: VFunction.returns(VNumber),\r\n\t\tindexOf: VFunction.returns(VNumber),\r\n\t\tlastIndexOf: VFunction.returns(VNumber),\r\n\t\tmatch: VFunction.returns(VArray),\r\n\t\treplace: VFunction.returns(VString),\r\n\t\tsubstr: VFunction.returns(VString),\r\n\t\tslice: VFunction.returns(VString),\r\n\t\ttoUpperCase: VFunction.returns(VString),\r\n\t\ttoLowerCase: VFunction.returns(VString),\r\n\t\treplace: VFunction.returns(VString),\r\n\t\ttoString: function() {\r\n\t\t\treturn this.valueOf() || '' // if it is null or undefined, return blank string\r\n\t\t}\r\n\t\t//length: VNumber\r\n\t}, VString)\r\n\tVString.prototype.type = 'string'\r\n\tVString.isPrimitive = true\r\n\r\n\tVNumber = Variable.with({\r\n\t\ttoFixed: VFunction.returns(VString),\r\n\t\ttoExponential: VFunction.returns(VString),\r\n\t\ttoPrecision: VFunction.returns(VString),\r\n\t\ttoLocaleString: VFunction.returns(VString)\r\n\t}, VNumber)\r\n\tVNumber.prototype.type = 'number'\r\n\tVNumber.isPrimitive = true\r\n\r\n\tfunction VBoolean(value) {\r\n\t\treturn makeSubVar(this, typeof value === 'object' ? value : Boolean(value), VBoolean)\r\n\t}\r\n\tVBoolean = Variable.with({}, VBoolean)\r\n\tVBoolean.prototype.type = 'boolean'\r\n\tVBoolean.isPrimitive = true\r\n\r\n\tfunction VSet(value) {\r\n\t\treturn makeSubVar(this, value instanceof Array ? new lang.Set(value) : value, VSet)\r\n\t}\r\n\tVSet = Variable.with({\r\n\t\thas: function(value) {\r\n\t\t\treturn this.to(function(set) {\r\n\t\t\t\tif (set && set.has) { // ideally\r\n\t\t\t\t\treturn set.has(value)\r\n\t\t\t\t}\r\n\t\t\t\tif (set && set.indexOf) { // also handle arrays\r\n\t\t\t\t\treturn set.indexOf(value) > -1\r\n\t\t\t\t}\r\n\t\t\t\treturn false\r\n\t\t\t}).as(VBoolean)\r\n\t\t},\r\n\t\tadd: VMethod,\r\n\t\tclear: VMethod,\r\n\t\tdelete: VMethod\r\n\t}, VSet)\r\n\tObject.defineProperty(VSet.prototype, 'array', {\r\n\t\tget: function() {\r\n\t\t\treturn this._array || (this._array = this.to(setToArray).as(VArray))\r\n\t\t}\r\n\t})\r\n\tVSet.wrapsType = lang.Set\r\n\r\n\tvar VCollection = lang.compose(VArray, function VCollection(value) {\r\n\t\treturn makeSubVar(this, value, VCollection)\r\n\t}, {\r\n\t\tvalueOf: function(mode) {\r\n\t\t\t// skip past VArray valueOf, since it is redundant\r\n\t\t\tvar parentContext = context\r\n\t\t\tvar sourceContext = context = context ? context.newContext() : new Context()\r\n\t\t\tvar value = Variable.prototype.valueOf.call(this, mode)\r\n\t\t\tsourceContext.setVersion(this.version)\r\n\t\t\tvar varray = this\r\n\t\t\ttry {\r\n\t\t\t\treturn when(value, function(array) {\r\n\t\t\t\t\tif (!mode || !mode.getTyped) {\r\n\t\t\t\t\t\treturn array\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!array) {\r\n\t\t\t\t\t\treturn []\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar collectionOf = varray.getCollectionOf()\r\n\r\n\t\t\t\t\tif (collectionOf && (!varray._typedArray || !(varray._typedVersion >= sourceContext.version))) {\r\n\t\t\t\t\t\t// TODO: eventually we may want to do this even more lazily for slice operations\r\n\t\t\t\t\t\tvarray._typedArray = array.map(function(item, index) {\r\n\t\t\t\t\t\t\tif (!(item instanceof collectionOf)) {\r\n\t\t\t\t\t\t\t\titem = collectionOf === Variable ? exports.reactive(item) : collectionOf.from(item)\r\n\t\t\t\t\t\t\t\tif (!item.parent) {\r\n\t\t\t\t\t\t\t\t\t// set the parent; we may eventually put a check in place here to make sure we aren't\r\n\t\t\t\t\t\t\t\t\t// reparenting, but this could legimately be a different parent if the array originates\r\n\t\t\t\t\t\t\t\t\t// from another \"source\" variable that drives this.\r\n\t\t\t\t\t\t\t\t\titem.parent = varray\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (varray.isWritable) {\r\n\t\t\t\t\t\t\t\t\titem.key = index\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn item\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// items were converted, store the original array\r\n\t\t\t\t\t\tvarray._typedVersion = sourceContext.version\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarray = varray._typedArray || mode.allowUntyped && array\r\n\t\t\t\t\tif (varray.sortFunction && varray._sortedArray != array) {\r\n\t\t\t\t\t\t// we have a sort function, and a new incoming array, need to resort\r\n\t\t\t\t\t\tvar reversed = varray.reversed\r\n\t\t\t\t\t\tvar sortFunction = varray.sortFunction\r\n\t\t\t\t\t\tvarray.sortFunction = null // null this so we don't reenter here\r\n\t\t\t\t\t\tarray = varray.sort(sortFunction)\r\n\t\t\t\t\t\tif (reversed) {\r\n\t\t\t\t\t\t\tvarray.reversed()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn array\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tif (parentContext) {\r\n\t\t\t\t\tparentContext.setVersion(sourceContext.version)\r\n\t\t\t\t}\r\n\t\t\t\tcontext = parentContext\r\n\t\t\t}\r\n\t\t},\r\n\t\tproperty: function(key, PropertyClass) {\r\n\t\t\tif (this._typedArray) {\r\n\t\t\t\tvar entry = this._typedArray[key]\r\n\t\t\t\tentry.key = key\r\n\t\t\t\treturn entry\r\n\t\t\t}\r\n\t\t\treturn Variable.prototype.property.call(this, key, PropertyClass || typeof key === 'number' && this.collectionOf)\r\n\t\t},\r\n\t\tindexOf: function(idOrValue) {\r\n\t\t\tvar array = this.valueOf() || []\r\n\t\t\tvar collectionOf = this.collectionOf\r\n\t\t\tif (collectionOf.prototype.getId) {\r\n\t\t\t\tvar id = idOrValue && idOrValue.getId ? idOrValue.getId() : idOrValue\r\n\t\t\t\tfor (var i = 0, l = array.length; i < l; i++) {\r\n\t\t\t\t\tif (array[i].getId() == id) {\r\n\t\t\t\t\t\treturn i\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn -1\r\n\t\t\t} else {\r\n\t\t\t\treturn array.indexOf(idOrValue && idOrValue.valueOf())\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tfunction VDate(value) {\r\n\t\treturn makeSubVar(this, typeof value === 'object' ? value : new Date(value), VDate)\r\n\t}\r\n\tVDate = Variable.with({\r\n\t\ttoDateString: VFunction.returns(VString),\r\n\t\ttoTimeString: VFunction.returns(VString),\r\n\t\ttoGMTString: VFunction.returns(VString),\r\n\t\ttoUTCString: VFunction.returns(VString),\r\n\t\tgetTime: VFunction.returns(VNumber),\r\n\t\tsetTime: VMethod\r\n\t}, VDate)\r\n\r\n\tVDate.wrapsType = Date\r\n\r\n\tvar VPromise = lang.compose(Variable, function VPromise(value) {\r\n\t\treturn makeSubVar(this, value, VPromise)\r\n\t}, {\r\n\t\tvalueOf: function() {\r\n\t\t\treturn this.then()\r\n\t\t},\r\n\t})\r\n\r\n\tvar exports = {\r\n\t\t__esModule: true,\r\n\t\tVariable: Variable,\r\n\t\tVArray: VArray,\r\n\t\tdefault: Variable,\r\n\t\tVString: VString,\r\n\t\tVNumber: VNumber,\r\n\t\tVBoolean: VBoolean,\r\n\t\tVPromise: VPromise,\r\n\t\tVDate: VDate,\r\n\t\tVSet: VSet,\r\n\t\tVMap: VMap,\r\n\t\tGeneratorVariable: GeneratorVariable,\r\n\t\tTransform: Transform,\r\n\t\tdeny: deny,\r\n\t\tnoChange: noChange,\r\n\t\tContext: Context,\r\n\t\tItem: Item,\r\n\t\tNotifyingContext: NotifyingContext,\r\n\t\tall: all,\r\n\t\treact: react,\r\n\t\tdelayUpdate: delayUpdate,\r\n\t\tobjectUpdated: objectUpdated,\r\n\t\tNOT_MODIFIED: NOT_MODIFIED,\r\n\t\t_changeValue: changeValue,\r\n\t\tgetNextVersion: getNextVersion,\r\n\t\tReplacedEvent: ReplacedEvent,\r\n\t\tAddedEvent: AddedEvent,\r\n\t\tDeletedEvent: DeletedEvent,\r\n\t\tUpdateEvent: UpdateEvent,\r\n\t}\r\n\tObject.defineProperty(exports, 'currentContext', {\r\n\t\tget: function() {\r\n\t\t\treturn context\r\n\t\t},\r\n\t\tset: function(currentContext) {\r\n\t\t\tcontext = currentContext\r\n\t\t}\r\n\t})\r\n\r\n\tfunction getNextVersion() {\r\n\t\tvar dateBasedVersion = (Date.now() - 1500000000000) * 256\r\n\t\tif (dateBasedVersion > nextVersion) {\r\n\t\t\tnextVersion = dateBasedVersion\r\n\t\t}\r\n\t\treturn nextVersion++\r\n\t}\r\n\r\n\tvar IterativeMethod = lang.compose(Transform, function(source, method) {\r\n\t}, {\r\n\t\ttransform: function() {\r\n\t\t\tvar array = this.source.valueOf(GET_TYPED_OR_UNTYPED_ARRAY)\r\n\t\t\tvar method = this.method\r\n\t\t\tif (typeof method === 'string') {\r\n\t\t\t\t// apply method\r\n\t\t\t\treturn this.hasOwnProperty('source2') ?\r\n\t\t\t\t\t[][method].call(array, this.source1.valueOf(), this.source2) :\r\n\t\t\t\t\t[][method].call(array, this.source1.valueOf())\r\n\t\t\t} else {\r\n\t\t\t\treturn method(array, [this.source1.valueOf(), this.source2])\r\n\t\t\t}\r\n\t\t},\r\n\t\t_mappedItems: function(array) {\r\n\t\t\tvar source = this.source\r\n\t\t\tvar collectionOf = source && source.collectionOf\r\n\t\t\treturn collectionOf ? array.map(function(item, i) {\r\n\t\t\t\tvar wrapped = collectionOf.from(item)\r\n\t\t\t\twrapped.collection = source\r\n\t\t\t\treturn wrapped\r\n\t\t\t}) : array\r\n\t\t},\r\n\t\tslice: function(start, end) {\r\n\t\t\treturn when(this.valueOf(true), function(array) {\r\n\t\t\t\treturn array.slice(start, end)\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\tgetCollectionOf: function(){\r\n\t\t\treturn this.source.getCollectionOf()\r\n\t\t}\r\n\t})\r\n\r\n\tfunction defineIterativeFunction(method, constructor, properties, returns, definedOn) {\r\n\t\tvar IterativeResults = lang.compose(returns ? returns.as(IterativeMethod) : IterativeMethod, constructor, properties)\r\n\t\tIterativeResults.prototype.method || (IterativeResults.prototype.method = method)\r\n\t\tObject.defineProperty(IterativeResults.prototype, 'isIterable', {value: true});\r\n\t\tdefinedOn = definedOn || VArray;\r\n\t\tdefinedOn[method] = definedOn.prototype[method] = function(iteratee, arg2) {\r\n\t\t\tvar results = new IterativeResults(this)\r\n\t\t\tresults.source = this\r\n\t\t\tresults.source1 = iteratee\r\n\t\t\tif (arg2) {\r\n\t\t\t\tresults.source2 = arg2\r\n\t\t\t}\r\n\t\t\treturn results\r\n\t\t}\r\n\t}\r\n\r\n\tdefineIterativeFunction('filter', function Filtered(source) {\r\n\t}, {\r\n\t\tupdated: function(event, by, isDownstream) {\r\n\t\t\tif (!event || event.modifier === this || (event.modifier && event.modifier.constructor === this)) {\r\n\t\t\t\treturn Transform.prototype.updated.call(this, event, by)\r\n\t\t\t}\r\n\t\t\tvar contextualizedVariable = context && context.getContextualized(this) || this\r\n\t\t\tvar filterFunction = this.source1.valueOf()\r\n\t\t\tif (event.type === 'spliced') { // if we don't have unique items in the array, we can't match indices\r\n\t\t\t\tvar toAdd = []\r\n\t\t\t\tvar newItems = event.items\r\n\t\t\t\tfor (var i = 0; i < newItems.length; i++) {\r\n\t\t\t\t\t// filter, preserving the original untyped value\r\n\t\t\t\t\tif (filterFunction.call(newItems, newItems[i], i)) {\r\n\t\t\t\t\t\tif (newItems.untypedItems) {\r\n\t\t\t\t\t\t\ttoAdd.push(newItems.untypedItems[i])\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttoAdd.push(newItems[i])\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tvar toRemove = event.removed.filter(filterFunction)\r\n\t\t\t\tvar start, deleteCount\r\n\t\t\t\tif (toRemove.length > 1) {\r\n\t\t\t\t\t// bail and consider it a full refresh\r\n\t\t\t\t\treturn Transform.prototype.updated.call(this, new ReplacedEvent(event))\r\n\t\t\t\t} else if (toRemove.length == 1) {\r\n\t\t\t\t\t// removing one\r\n\t\t\t\t\tif (!toRemove[0].parent) {\r\n\t\t\t\t\t\t// if we are not dealing with unique variables, we bail\r\n\t\t\t\t\t\treturn Transform.prototype.updated.call(this, new ReplacedEvent(event))\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstart = contextualizedVariable.cachedValue.indexOf(toRemove[0])\r\n\t\t\t\t\tdeleteCount = 1\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstart = event.atEnd ? contextualizedVariable.cachedValue.length : 0\r\n\t\t\t\t\tdeleteCount = 0\r\n\t\t\t\t}\r\n\t\t\t\tarrayToModify(contextualizedVariable, function(array, doSplice) {\r\n\t\t\t\t\tdoSplice(start, deleteCount, toAdd)\r\n\t\t\t\t})\r\n\t\t\t} else if (event.type === 'entry') {\r\n\t\t\t\tvar object = event.value\r\n\t\t\t\tvar index = contextualizedVariable.cachedValue.indexOf(object)\r\n\t\t\t\tvar matches = [object].filter(filterFunction).length > 0\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\treturn Variable.prototype.updated.call(this, event, by, isDownstream)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarrayToModify(contextualizedVariable, function(array, doSplice) {\r\n\t\t\t\t\t\t\tdoSplice(index, 1, [])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tarrayToModify(contextualizedVariable, function(array, doSplice) {\r\n\t\t\t\t\t\t\tdoSplice(array.length, 0, [object])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// else nothing matches\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t} else {\r\n\t\t\t\treturn Transform.prototype.updated.call(this, event, by, isDownstream)\r\n\t\t\t}\r\n\t\t},\r\n\t\ttransform: function() {\r\n\t\t\tvar array = this.source.valueOf(GET_TYPED_OR_UNTYPED_ARRAY)\r\n\t\t\tvar source = this.source\r\n\t\t\tvar results = []\r\n\t\t\tvar callback = this.source1.valueOf()\r\n\t\t\treturn when(array, function(array) {\r\n\t\t\t\tvar untypedArray = source.valueOf() // wait until the variable is resolved to resolve this\r\n\t\t\t\tarray.forEach(function(value, index) {\r\n\t\t\t\t\tif (callback(value, index)) {\r\n\t\t\t\t\t\t// push the original values, so we preserve underlying and typed values\r\n\t\t\t\t\t\tresults.push(untypedArray[index])\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this.source2)\r\n\t\t\t\treturn results\r\n\t\t\t})\r\n\t\t},\r\n\t\t// just delegate directly to the source for these methods\r\n\t\tpush: function(value) {\r\n\t\t\treturn this.source.push.apply(this.source, arguments)\r\n\t\t},\r\n\t\tunshift: function(value) {\r\n\t\t\treturn this.source.unshift.apply(this.source, arguments)\r\n\t\t},\r\n\t\t// these rely on data from this array to compute the additions/removals to the source\r\n\t\tpop: function(value) {\r\n\t\t\treturn when(this.valueOf(), function(array) {\r\n\t\t\t\treturn array.length && this.source.remove(array[array.length - 1])\r\n\t\t\t})\r\n\t\t},\r\n\t\tshift: function(value) {\r\n\t\t\treturn when(this.valueOf(), function(array) {\r\n\t\t\t\treturn array.length && this.source.remove(array[0])\r\n\t\t\t})\r\n\t\t},\r\n\t\tsplice: function(value) {\r\n\t\t\tthrow new Error('Not supported yet')\r\n\t\t},\r\n\t\tgetCollectionOf: function() {\r\n\t\t\treturn this.source.getCollectionOf()\r\n\t\t}\r\n\t}, VCollection)\r\n\tdefineIterativeFunction('map', function Mapped(source) {\r\n\t}, {\r\n\t\tupdated: function(event, by, isDownstream) {\r\n\t\t\tif (!event || event.modifier === this || (event.modifier && event.modifier.constructor === this)) {\r\n\t\t\t\treturn Variable.prototype.updated.call(this, event, by)\r\n\t\t\t}\r\n\t\t\tvar contextualizedVariable = context && context.getContextualized(this) || this\r\n\t\t\tif (event.type === 'spliced') {\r\n\t\t\t\tthis.splice.apply(this, [event.start, event.deleteCount].concat(event.items.map(this.source1.valueOf())))\r\n\t\t\t} else if (event.type === 'property') {\r\n\t\t\t\tif (this.getCollectionOf()) {\r\n\t\t\t\t\treturn // if it has typed items, we don't need to propagate update events, since they will be handled by the variable item.\r\n\t\t\t\t}\r\n\t\t\t\tvar object = event.parent.valueOf()\r\n\t\t\t\tvar array = contextualizedVariable.cachedValue\r\n\t\t\t\tvar index = event.key\r\n\t\t\t\tvar value = event.value\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\t// update was to an index property of this array variable\r\n\t\t\t\t\tvalue = object[index]\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// update was inside an object inside of our array\r\n\t\t\t\t\tindex = array && array.map && array.indexOf(object)\r\n\t\t\t\t}\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tcontextualizedVariable.splice(index, 1, this.source1.valueOf().call(this.source2, this.source.property(index)))\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn Transform.prototype.updated.call(this, event, by, isDownstream)\r\n\t\t\t\t}\r\n\t\t\t} else if (event.type === 'entry') {\r\n\t\t\t\tif (this.getCollectionOf()) {\r\n\t\t\t\t\treturn // if it has typed items, we don't need to propagate update events, since they will be handled by the variable item.\r\n\t\t\t\t}\r\n\t\t\t\t// TODO: find the element\r\n\t\t\t} else {\r\n\t\t\t\treturn Transform.prototype.updated.call(this, event, by, isDownstream)\r\n\t\t\t}\r\n\t\t}\r\n\t}, VArray)\r\n\tdefineIterativeFunction('reduce', function Reduced() {})\r\n\tdefineIterativeFunction('reduceRight', function Reduced() {})\r\n\tdefineIterativeFunction('some', function Aggregated() {}, {}, VBoolean)\r\n\tdefineIterativeFunction('every', function Aggregated() {}, {}, VBoolean)\r\n\tdefineIterativeFunction('join', function Aggregated() {}, {}, VString)\r\n\tdefineIterativeFunction('keyBy', function UniqueIndex(source, args) {}, {\r\n\t\tproperty: VMap.prototype.property,\r\n\t\tmethod: function(array, args) {\r\n\t\t\tvar index = new Map()\r\n\t\t\tvar keyGenerator = args[0]\r\n\t\t\tvar valueGenerator = args[1]\r\n\t\t\tvar hasKeyFunction = typeof keyGenerator === 'function'\r\n\t\t\tvar hasValueFunction = typeof valueGenerator === 'function'\r\n\t\t\tvar hasKey = !!keyGenerator\r\n\t\t\tfor (var i = 0, l = array.length; i < l; i++) {\r\n\t\t\t\tvar element = array[i]\r\n\t\t\t\tindex.set(\r\n\t\t\t\t\thasKeyFunction ? keyGenerator(element, emit) :\r\n\t\t\t\t\t\thasKey ? element[keyGenerator] : element,\r\n\t\t\t\t\thasValueFunction ? valueGenerator(element) : element)\r\n\t\t\t}\r\n\t\t\tfunction emit(key, value) {\r\n\t\t\t\tindex.set(key, value)\r\n\t\t\t}\r\n\t\t\treturn index\r\n\t\t}\r\n\t})\r\n\r\n\tdefineIterativeFunction('groupBy', function UniqueIndex(source, args) {}, {\r\n\t\tproperty: VMap.prototype.property,\r\n\t\tmethod: function(array, args) {\r\n\t\t\tvar index = new Map()\r\n\t\t\tvar keyGenerator = args[0]\r\n\t\t\tvar valueGenerator = args[1]\r\n\t\t\tvar hasKeyFunction = typeof keyGenerator === 'function'\r\n\t\t\tvar hasValueFunction = typeof valueGenerator === 'function'\r\n\t\t\tvar hasKey = !!keyGenerator\r\n\t\t\tfor (var i = 0, l = array.length; i < l; i++) {\r\n\t\t\t\tvar element = array[i]\r\n\t\t\t\tvar key = hasKeyFunction ? keyGenerator(element) :\r\n\t\t\t\t\t\thasKey ? element[keyGenerator] : element\r\n\t\t\t\tvar group = index.get(key)\r\n\t\t\t\tif (!group) {\r\n\t\t\t\t\tindex.set(key, group = [])\r\n\t\t\t\t}\r\n\t\t\t\tgroup.push(hasValueFunction ? valueGenerator(element) : element)\r\n\t\t\t}\r\n\t\t\tfunction emit(key, value) {\r\n\t\t\t\tvar group = index.get(key)\r\n\t\t\t\tif (!group) {\r\n\t\t\t\t\tindex.set(key, group = [])\r\n\t\t\t\t}\r\n\t\t\t\tgroup.push(value)\r\n\t\t\t}\r\n\t\t\treturn index\r\n\t\t}\r\n\t})\r\n\r\n\tvar getGeneratorDescriptor = Variable.getGeneratorDescriptor = function(value) {\r\n\t\tvar variables\r\n\t\treturn {\r\n\t\t\tget: function() {\r\n\t\t\t\tif (!variables) {\r\n\t\t\t\t\t variables = new lang.WeakMap()\r\n\t\t\t\t}\r\n\t\t\t\tvar variable = variables.get(this)\r\n\t\t\t\tif (!variable) {\r\n\t\t\t\t\tvariables.set(this, variable = new GeneratorVariable(value.bind(this)))\r\n\t\t\t\t}\r\n\t\t\t\treturn variable\r\n\t\t\t},\r\n\t\t\tenumerable: true\r\n\t\t}\r\n\t}\r\n\r\n\tfunction react(generator, options) {\r\n\t\tif (typeof generator !== 'function') {\r\n\t\t\tthrow new Error('react() must be called with a generator.')\r\n\t\t}\r\n\t\tif (options && options.reverse) {\r\n\t\t\tgenerator.reverse = options.reverse\r\n\t\t}\r\n\t\treturn new GeneratorVariable(generator)\r\n\t}\r\n\r\n\tVariable.all = all\r\n\tVariable.Context = Context\r\n\r\n\tvar g = typeof global != 'undefined' ? global : window;\r\n\t(g.devtoolsFormatters || (g.devtoolsFormatters = [])).push({\r\n\t\theader: function(variable, config) {\r\n\t\t\tif (variable && variable instanceof Variable) {\r\n\t\t\t\tvar copy = Object.assign({}, variable)\r\n\t\t\t\tcopy[Symbol.toStringTag] = variable.constructor.name\r\n\t\t\t\tvar variableTime = variable.version / 256 + 1500000000000\r\n\t\t\t\treturn ['span', {}, '',\r\n\t\t\t\t\t(variable.readyState === 'invalidated' ? ' invalidated ' :\r\n\t\t\t\t\t\ttypeof variable.valueOf() === 'object' ? ['object', { object: variable.valueOf() }] : ['span', {}, ' = ' + variable]),\r\n\t\t\t\t\t['object', { object: copy }],\r\n\t\t\t\t\t['span', {}, ' (' +\r\n\t\t\t\t\t(variable.version ? new Date(variableTime)[Date.now() - variableTime > 30000000 ? 'toLocaleString' : 'toLocaleTimeString']() : '') +\r\n\t\t\t\t\t(variable.listeners ? ' live)' : ')')]]\r\n\t\t\t}\r\n\t\t\treturn null // ignore all other objects\r\n\t\t},\r\n\t\thasBody: function(request) {\r\n\t\t\treturn false // default\r\n\t\t},\r\n\t\tbody: function(variable) {\r\n\t\t\tvar variableTime = variable.version / 256 + 1500000000000\r\n\t\t\tvar properties = ['div', {}, ['div', {}, 'version: ' + (variableTime && new Date(variableTime).toLocaleString())],\r\n\t\t\t\t['div', {}, 'readyState: ' + variable.readyState]]\r\n\t\t\tif (variable.valueOf())\r\n\t\t\t\tproperties.push(['div', {}, ['object', { object: variable.valueOf() }], '(value)'])\r\n\t\t\tif (variable.listeners) {\r\n\t\t\t\tproperties.push(['div', {}, ['object', { object: variable.listeners }], '(listeners)'])\r\n\t\t\t}\r\n\t\t\tvar source, i = 0\r\n\t\t\twhile (source = variable['source' + (i || '')]) {\r\n\t\t\t\tproperties.push(['div', {}, ['object', { object: variable['source' + (i || '')] }], ['div', { float: 'left' }, '(source ' + i + ')']])\r\n\t\t\t\ti++\r\n\t\t\t}\r\n\t\t\treturn properties\r\n\t\t}\r\n\t})\r\n\r\n\treturn exports\r\n}))\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./util/lang', './Variable'], factory) } else if (typeof module === 'object' && module.exports) {\r\n  module.exports = factory(require('./util/lang'), require('./Variable')) // Node\r\n}}(this, function (lang, VariableExports) {\r\n\tvar doc = typeof document !== 'undefined' && document\r\n\tvar invalidatedElements\r\n\tvar queued\r\n\tvar toRender = []\r\n\tvar nextId = 1\r\n\tvar requestAnimationFrame = lang.requestAnimationFrame\r\n\tvar Context = VariableExports.Context\r\n\r\n\tfunction Renderer(options) {\r\n\t\tvar variable = options.variable\r\n\r\n\t\tthis.variable = variable\r\n\t\tif (options.selector) {\r\n\t\t\tthis.selector = options.selector\r\n\t\t}\r\n\t\tif (options.getElements) {\r\n\t\t\tthis.getElements = options.getElements\r\n\t\t}\r\n\t\telse if (options.element) {\r\n\t\t\tvar element = this.element = options.element;\r\n\t\t\t(element.alkaliRenderers || (element.alkaliRenderers = [])).push(this)\r\n\t\t} else {\r\n\t\t\tthrow new Error('No element provided to Renderer')\r\n\t\t}\r\n\t\tif (options.update) {\r\n\t\t\tthis.updateRendering = options.update\r\n\t\t}\r\n\t\tif (options.shouldRender) {\r\n\t\t\tthis.shouldRender = options.shouldRender\r\n\t\t}\r\n\t\tif (options.renderUpdate) {\r\n\t\t\tthis.renderUpdate = options.renderUpdate\r\n\t\t}\r\n\t\tif (options.alwaysUpdate) {\r\n\t\t\tthis.alwaysUpdate = options.alwaysUpdate\r\n\t\t}\r\n\t\tif (options.updateOnStart === false){\r\n\t\t\tvar contextualized = this.contextualized || this.variable\r\n\t\t\tthis.variable.valueOf(this)\r\n\t\t\t// even if we don't render on start, we still need to compute the value so we can depend on the computed\r\n\t\t\t// TODO: we may need to handle recontextualization if it returns a promise\r\n\t\t\tcontextualized.notifies(this)\r\n\t\t} else if (element) {\r\n\t\t\tthis.updateRendering(true)\r\n\t\t} else {\r\n\t\t\t// bound to a class, just do notification\r\n\t\t\tthis.variable.notifies(this)\r\n\t\t}\r\n\t}\r\n\tRenderer.prototype = {\r\n\t\tconstructor: Renderer,\r\n\t\tversion: 0,\r\n\t\tnotifies: true,\r\n\t\tupdateRendering: function () {\r\n\t\t\tthrow new Error ('updateRendering must be implemented by sub class of Renderer')\r\n\t\t},\r\n\t\tupdated: function (updateEvent, by, context) {\r\n\t\t\tif (!this.invalidated) {\r\n\t\t\t\tif (this.getElements) {\r\n\t\t\t\t\tvar variable = this.variable\r\n\t\t\t\t\tvar invalidated = this.invalidated || (this.invalidated = new lang.Set())\r\n\t\t\t\t\tthis.getElements().forEach(function(element) {\r\n\t\t\t\t\t\tif (!updateEvent.doesAffect || updateEvent.doesAffect(element)){\r\n\t\t\t\t\t\t\tinvalidated.add(element)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t/*if (element.constructor.getForClass(element, variable) == by) {\r\n\t\t\t\t\t\t\tinvalidated.add(element)\r\n\t\t\t\t\t\t}*/\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// do this only once, until we render again\r\n\t\t\t\t\tthis.invalidated = true\r\n\t\t\t\t}\r\n\t\t\t\tif (this.deferredRender) {\r\n\t\t\t\t\tthis.deferredRender.isCanceled = true\r\n\t\t\t\t\tthis.deferredRender = null\r\n\t\t\t\t}\r\n\t\t\t\tvar renderer = this;\r\n\t\t\t\t(updateEvent.visited.enqueueUpdate || requestAnimationFrame)(function() {\r\n\t\t\t\t\tif (renderer.invalidated === true) {\r\n\t\t\t\t\t\trenderer.updateRendering(renderer.alwaysUpdate, renderer.element)\r\n\t\t\t\t\t} else if (renderer.invalidated) {\r\n\t\t\t\t\t\trenderer.invalidated.forEach(function(element) {\r\n\t\t\t\t\t\t\trenderer.updateRendering(renderer.alwaysUpdate, element)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\texecuteWithin: Context.prototype.executeWithin,\r\n\t\tsetVersion: function(){\r\n\t\t\t// this doesn't need its own version/hash\r\n\t\t},\r\n\t\tnewContext: function() {\r\n\t\t\treturn new Context(this.element, true)\r\n\t\t},\r\n\t\tgetContextualized: function(Variable) {\r\n\t\t\treturn Context.prototype.getContextualized.call(this, Variable)\r\n\t\t\t//return this.contextualized || this.variable\r\n\t\t},\r\n\t\tspecify: function(Variable) {\r\n\t\t\treturn this.contextualized = Context.prototype.specify.call(this, Variable)\r\n\t\t\t// a new context to get this\r\n\t\t\tthis.contextualized = this.newContext(null, true).specify(Variable)\r\n\r\n\t\t},\r\n\t\tmerge: function(){\r\n\t\t\t// noop\r\n\t\t},\r\n\t\tcontextMatches: function(context) {\r\n\t\t\treturn true\r\n\t\t},\r\n\t\tinvalidateElement: function(element) {\r\n\t\t\tif(!invalidatedElements){\r\n\t\t\t\tinvalidatedElements = new WeakMap(null, 'invalidated')\r\n\t\t\t}\r\n\t\t\tvar invalidatedParts = invalidatedElements.get(element)\r\n\t\t\tinvalidatedElements.set(element, invalidatedParts = {})\r\n\t\t\tif (!invalidatedParts[id]) {\r\n\t\t\t\tinvalidatedParts[id] = true\r\n\t\t\t}\r\n\t\t\tif (!queued) {\r\n\t\t\t\tlang.queueTask(processQueue)\r\n\t\t\t\tqueued = true\r\n\t\t\t}\r\n\t\t\tvar renderer = this\r\n\t\t\ttoRender.push(function(){\r\n\t\t\t\trenderer.invalidated = false\r\n\t\t\t\trenderer.updateElement(element)\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetId: function(){\r\n\t\t\treturn this.id || (this.id = nextId++)\r\n\t\t},\r\n\t\tstop: function() {\r\n\t\t\tvar contextualized = this.contextualized || this.variable\r\n\t\t\tcontextualized.stopNotifies(this)\r\n\t\t\tif (this.builtList) {\r\n\t\t\t\tthis.builtList = false\r\n\t\t\t\tthis.omitValueOf = false\r\n\t\t\t}\r\n\t\t},\r\n\t\trestart: function() {\r\n\t\t\tthis.updateRendering(true)\r\n\t\t},\r\n\t\tisSameProperty: function(renderer) {\r\n\t\t\treturn renderer.constructor === this.constructor && renderer.name === this.name\r\n\t\t}\r\n\t}\r\n\tObject.defineProperty(Renderer.prototype, 'subject', {\r\n\t\tget: function() {\r\n\t\t\treturn this.element\r\n\t\t}\r\n\t})\r\n\r\n\tfunction ElementRenderer(options) {\r\n\t\tRenderer.call(this, options)\r\n\t}\r\n\tElementRenderer.prototype = Object.create(Renderer.prototype)\r\n\tElementRenderer.prototype.shouldRender = function (element) {\r\n\t\treturn document.body.contains(element)\r\n\t}\r\n\tElementRenderer.prototype.getSubject = function () {\r\n\t\treturn this.element\r\n\t}\r\n\tElementRenderer.prototype.updateRendering = function (always, element) {\r\n\t\tif (!element && this.elements) {\r\n\t\t\tvar elements = this.elements\r\n\t\t\tif(!elements.length){\r\n\t\t\t\tif(this.selector){\r\n\t\t\t\t\telements = document.querySelectorAll(this.selector)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthrow new Error('No element or selector was provided to the Renderer')\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tfor(var i = 0, l = elements.length; i < l; i++){\r\n\t\t\t\tthis.updateRendering(always, elements[i])\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar thisElement = element || this.element\r\n\r\n\t\t\tif(always || this.shouldRender(thisElement)){\r\n\t\t\t\t// it is connected\r\n\t\t\t\tthis.updateElement(thisElement)\r\n\t\t\t} else {\r\n\t\t\t\tvar id = this.getId()\r\n\t\t\t\tvar renderers = thisElement.renderersOnShow\r\n\t\t\t\tif(!renderers){\r\n\t\t\t\t\trenderers = thisElement.renderersOnShow = []\r\n\t\t\t\t\tthisElement.className += ' needs-rerendering'\r\n\t\t\t\t}\r\n\t\t\t\tif (!renderers[id]) {\r\n\t\t\t\t\trenderers[id] = this\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tElementRenderer.prototype.addElement = function (element) {\r\n\t\tif (this.selector) {\r\n\t\t\telement.renderersOnShow = [this]\r\n\t\t} else {\r\n\t\t\tthis.elements.push(element)\r\n\t\t}\r\n\t\t// and immediately do an update\r\n\t\tthis.updateElement(element)\r\n\t}\r\n\tElementRenderer.prototype.updateElement = function(element) {\r\n\t\tthis.invalidated = false\r\n\t\tif (this.omitValueOf) {\r\n\t\t\tthis.started = true\r\n\t\t\tthis.renderUpdate(undefined, element)\r\n\t\t\treturn\r\n\t\t}\r\n\t\tvar Element = element.constructor\r\n\t\tvar generalized = Element._generalized\r\n\t\tvar resolved\r\n\t\tvar renderer = element === this.element ? this : Object.create(this, { element: { value: element} })\r\n\t\tvar deferredRender\r\n\t\trenderer.executeWithin(function() {\r\n\t\t\tdeferredRender = renderer.variable.then(function(value) {\r\n\t\t\t\tresolved = true\r\n\t\t\t\tif (deferredRender) {\r\n\t\t\t\t\tif (deferredRender === renderer.deferredRender) {\r\n\t\t\t\t\t\trenderer.deferredRender = null\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (deferredRender.isCanceled) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!renderer.invalidated) {\r\n\t\t\t\t\tif (renderer.contextualized && renderer.contextualized !== renderer.variable) {\r\n\t\t\t\t\t\trenderer.contextualized.stopNotifies(renderer)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (generalized) {\r\n\t\t\t\t\t\tvar rendererIdentifier = renderer.toString()\r\n\t\t\t\t\t\tif (!generalized[rendererIdentifier]) {\r\n\t\t\t\t\t\t\tgeneralized[rendererIdentifier] = true;\r\n\t\t\t\t\t\t\t(renderer.contextualized = renderer.variable).notifies(renderer)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trenderer.executeWithin(function() {\r\n\t\t\t\t\t\t\trenderer.contextualized = renderer.variable.notifies(renderer)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(value !== undefined || renderer.started){\r\n\t\t\t\t\t\trenderer.started = true\r\n\t\t\t\t\t\trenderer.renderUpdate(value, element)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, function(error) {\r\n\t\t\t\tconsole.error('Error rendering', renderer, error)\r\n\t\t\t})\r\n\t\t})\r\n\t\tif(!resolved){\r\n\t\t\t// start listening for changes immediately\r\n\t\t\tif (generalized) {\r\n\t\t\t\tvar rendererIdentifier = renderer.toString()\r\n\t\t\t\tif (!generalized[rendererIdentifier]) {\r\n\t\t\t\t\tgeneralized[rendererIdentifier] = true;\r\n\t\t\t\t\t(renderer.contextualized = renderer.variable).notifies(renderer)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\trenderer.executeWithin(function() {\r\n\t\t\t\t\trenderer.contextualized = renderer.variable.notifies(renderer)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tthis.deferredRender = deferredRender\r\n\t\t\tif (this.renderLoading) {\r\n\t\t\t\t// if we have loading renderer call it\r\n\t\t\t\tthis.renderLoading(deferredRender, element)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tElementRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\tthrow new Error('renderUpdate(newValue) must be implemented')\r\n\t}\r\n\tRenderer.Renderer = Renderer\r\n\tRenderer.ElementRenderer = ElementRenderer\r\n\r\n\tfunction AttributeRenderer(options) {\r\n\t\tif(options.name){\r\n\t\t\tthis.name = options.name\r\n\t\t}\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tAttributeRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tAttributeRenderer.prototype.type = 'AttributeRenderer'\r\n\tAttributeRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\tif (typeof newValue == 'boolean' || newValue == null) {\r\n\t\t\t// for booleans or null/undefined, treat the attribute boolean-like, setting and removing\r\n\t\t\tif (newValue) {\r\n\t\t\t\telement.setAttribute(this.name, '') // \"set\" the attribute to enabled\r\n\t\t\t} else {\r\n\t\t\t\telement.removeAttribute(this.name) // disable the attribute, removing it\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// otherwise, assign value as string\r\n\t\t\telement.setAttribute(this.name, newValue)\r\n\t\t}\r\n\t}\r\n\tRenderer.AttributeRenderer = AttributeRenderer\r\n\r\n\tfunction PropertyRenderer(options) {\r\n\t\tif (options.name) {\r\n\t\t\tthis.name = options.name\r\n\t\t}\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tPropertyRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tPropertyRenderer.prototype.type = 'PropertyRenderer'\r\n\tPropertyRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\telement[this.name] = newValue\r\n\t}\r\n\tRenderer.PropertyRenderer = PropertyRenderer\r\n\r\n\tfunction InputPropertyRenderer(options) {\r\n\t\tif (options.element && options.element.tagName === 'SELECT' && options.name === 'value') {\r\n\t\t\t// use the deferred value assignment for <select>\r\n\t\t\tthis.renderUpdate = this.renderSelectValueUpdate\r\n\t\t}\r\n\t\tPropertyRenderer.apply(this, arguments)\r\n\t}\r\n\tInputPropertyRenderer.prototype = Object.create(PropertyRenderer.prototype)\r\n\tInputPropertyRenderer.prototype.type = 'InputPropertyRenderer'\r\n\tInputPropertyRenderer.prototype.renderUpdate = function(newValue, element) {\r\n\t\tif (newValue == null || (element.type === 'number' && isNaN(newValue))) {\r\n\t\t\tnewValue = ''\r\n\t\t}\r\n\t\tvar oldValue = element[this.name]\r\n\t\tif (typeof oldValue === 'string' && typeof newValue !== 'string') {\r\n\t\t\tnewValue = newValue == null ? '' : String(newValue)\r\n\t\t}\r\n\t\tif (oldValue != newValue) {\r\n\t\t\telement[this.name] = newValue\r\n\t\t}\r\n\t}\r\n\tInputPropertyRenderer.prototype.renderSelectValueUpdate = function (newValue, element) {\r\n\t\telement.value = newValue\r\n\t\tif (element.value != newValue && !element.value) {\r\n\t\t\t// if we didn't successfully set the value of a <select>, we may need to wait until the children are constructed\r\n\t\t\telement.eventualValue = newValue\r\n\t\t\tlang.nextTurn(function() {\r\n\t\t\t\tif (element.eventualValue) {\r\n\t\t\t\t\telement.value = element.eventualValue\r\n\t\t\t\t\telement.eventualValue = undefined\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\telement.eventualValue = undefined\r\n\t\t}\r\n\t}\r\n\tRenderer.InputPropertyRenderer = InputPropertyRenderer\r\n\r\n\tfunction StyleRenderer(options) {\r\n\t\tif(options.name){\r\n\t\t\tthis.name = options.name\r\n\t\t}\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tStyleRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tStyleRenderer.prototype.type = 'StyleRenderer'\r\n\tStyleRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\telement.style[this.name] = newValue\r\n\t}\r\n\tRenderer.StyleRenderer = StyleRenderer\r\n\r\n\tfunction ContentRenderer(options) {\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tContentRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tContentRenderer.prototype.type = 'ContentRenderer'\r\n\tContentRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\telement.innerHTML = ''\r\n\t\tif (newValue === undefined){\r\n\t\t\tnewValue = ''\r\n\t\t}\r\n\t\telement.appendChild(document.createTextNode(newValue))\r\n\t}\r\n\tRenderer.ContentRenderer = ContentRenderer\r\n\r\n\tfunction TextRenderer(options) {\r\n\t\tthis.position = options.position\r\n\t\tthis.textNode = options.textNode\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tTextRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tTextRenderer.prototype.type = 'TextRenderer'\r\n\tTextRenderer.prototype.updated = function (updateEvent, context) {\r\n\t\tif (this.builtList) {\r\n\t\t\tif (updateEvent.type === 'replaced') {\r\n\t\t\t\tthis.builtList = false\r\n\t\t\t\tthis.omitValueOf = false\r\n\t\t\t} else {\r\n\t\t\t\t(this.updates || (this.updates = [])).push(updateEvent)\r\n\t\t\t}\r\n\t\t}\r\n\t\tElementRenderer.prototype.updated.call(this, updateEvent, context)\r\n\t}\r\n\tTextRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\tif (newValue == null){\r\n\t\t\tnewValue = ''\r\n\t\t}\r\n\t\tif (newValue.create) {\r\n\t\t\tnewValue = newValue.create({parent: element})\r\n\t\t}\r\n\t\tif (newValue.nodeType) {\r\n\t\t\tif (this.textNode && this.textNode.parentNode == element) {\r\n\t\t\t\t// text node is attached, we can replace it with the node\r\n\t\t\t\telement.replaceChild(newValue, this.textNode)\r\n\t\t\t} else {\r\n\t\t\t\telement.appendChild(newValue)\r\n\t\t\t}\r\n\t\t\tthis.textNode = newValue\r\n\t\t} else if (newValue instanceof Array) {\r\n\t\t\tthis.renderUpdate = ListRenderer.prototype.renderUpdate\r\n\t\t\tthis.omitValueOf = true\r\n\t\t\tthis.renderUpdate(newValue, element)\r\n\t\t} else {\r\n\t\t\t(this.textNode || element.childNodes[this.position]).nodeValue = newValue\r\n\t\t}\r\n\t}\r\n\tRenderer.TextRenderer = TextRenderer\r\n\r\n\tfunction ListRenderer(options) {\r\n\t\tif (options.each) {\r\n\t\t\tthis.each = options.each\r\n\t\t}\r\n\t\tElementRenderer.apply(this, arguments)\r\n\t}\r\n\tListRenderer.prototype = Object.create(ElementRenderer.prototype)\r\n\tListRenderer.prototype.updated = function (updateEvent, context) {\r\n\t\tif (this.builtList) {\r\n\t\t\tif (updateEvent.type === 'replaced') {\r\n\t\t\t\tthis.builtList = false\r\n\t\t\t\tthis.omitValueOf = false\r\n\t\t\t} else {\r\n\t\t\t\t(this.updates || (this.updates = [])).push(updateEvent)\r\n\t\t\t}\r\n\t\t}\r\n\t\tElementRenderer.prototype.updated.call(this, updateEvent, context)\r\n\t}\r\n\tListRenderer.prototype.type = 'ListRenderer'\r\n\tListRenderer.prototype.renderUpdate = function (newValue, element) {\r\n\t\tvar container\r\n\t\tvar each = this.each || function(item) { // TODO: make a single identity function\r\n\t\t\treturn item\r\n\t\t}\r\n\t\tvar thisElement = this.element\r\n\t\tvar renderer = this\r\n\t\tif (!this.builtList) {\r\n\t\t\tthis.builtList = true\r\n\t\t\tthis.omitValueOf = true\r\n\t\t\telement.innerHTML = ''\r\n\t\t\tvar childElements = this.childElements = []\r\n\t\t\tif (each.defineHasOwn) {\r\n\t\t\t\teach.defineHasOwn()\r\n\t\t\t}\r\n\t\t\tif (newValue) {\r\n\t\t\t\tvar renderEach = function(item) {\r\n\t\t\t\t\tchildElements.push(Renderer.append(thisElement, eachItem(item)))\r\n\t\t\t\t}\r\n\t\t\t\tvar variable = this.variable\r\n\t\t\t\tif (variable.collectionOf) {\r\n\t\t\t\t\tthis.executeWithin(function() {\r\n\t\t\t\t\t\tvariable.forEach(renderEach)\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewValue.forEach(renderEach)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar contextualized = this.contextualized || this.variable\r\n\t\t\tcontextualized.notifies(this)\r\n\r\n\t\t\t// TODO: restore using a doc fragment to add these items:\r\n\t\t\t// thisElement.appendChild(container)\r\n\t\t} else {\r\n\t\t\tvar childElements = this.childElements\r\n\t\t\tvar updates = this.updates\r\n\t\t\tcontainer = thisElement\r\n\t\t\tupdates.forEach(function(update) {\r\n\t\t\t\tif (update.type === 'replaced') {\r\n\t\t\t\t\trenderer.builtList = false\r\n\t\t\t\t\tfor (var i = 0, l = childElements.length; i < l; i++) {\r\n\t\t\t\t\t\tthisElement.removeChild(childElements[i])\r\n\t\t\t\t\t}\r\n\t\t\t\t\trenderer.updateElement(thisElement)\r\n\t\t\t\t} else if (update.type === 'spliced') {\r\n\t\t\t\t\tvar index = update.start\r\n\t\t\t\t\tfor (var i = 0; i < update.deleteCount; i++) {\r\n\t\t\t\t\t\tthisElement.removeChild(childElements[update.start + i])\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchildElements.splice(update.start, update.deleteCount)\r\n\t\t\t\t\tfor (var i = 0; i < update.items.length; i++) {\r\n\t\t\t\t\t\tvar value = update.items[i]\r\n\t\t\t\t\t\tvar nextChild = childElements[i + update.start]\r\n\t\t\t\t\t\tvar newElement = Renderer.append(thisElement, eachItem(value))\r\n\t\t\t\t\t\tif (nextChild) {\r\n\t\t\t\t\t\t\tthisElement.insertBefore(newElement, nextChild)\r\n\t\t\t\t\t\t\tchildElements.splice(i + update.start, 0, newElement)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchildElements.push(newElement)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (update.type === 'property') {\r\n\t\t\t\t\t// should be handled by sub-renderers\r\n\t\t\t\t\t/*thisElement.removeChild(childElements[update.key])\r\n\t\t\t\t\tvar nextChild = childElements[update.key + 1]\r\n\t\t\t\t\tvar newElement = Renderer.append(thisElement, eachItem(update.target))\r\n\t\t\t\t\tthisElement.insertBefore(newElement, nextChild)\r\n\t\t\t\t\tchildElements[update.key] = newElement*/\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tthis.updates = [] // clear the updates\r\n\t\t}\r\n\t\tfunction eachItem(item) {\r\n\t\t\tvar childElement\r\n\t\t\tif (each.create) {\r\n\t\t\t\tchildElement = each.create({parent: thisElement, _item: item}) // TODO: make a faster object here potentially\r\n\t\t\t} else {\r\n\t\t\t\tchildElement = each(item, thisElement)\r\n\t\t\t\tif (childElement.create) {\r\n\t\t\t\t\tchildElement = childElement.create({parent: thisElement, _item: item})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn childElement\r\n\t\t}\r\n\t}\r\n\tRenderer.ListRenderer = ListRenderer\r\n\r\n\tRenderer.onShowElement = function(shownElement){\r\n\t\trequestAnimationFrame(function(){\r\n\t\t\tinvalidatedElements = null\r\n\t\t\tvar elements = [].slice.call(shownElement.getElementsByClassName('needs-rerendering'))\r\n\t\t\tif (shownElement.className.indexOf('needs-rerendering') > 0){\r\n\t\t\t\tvar includingTop = [shownElement]\r\n\t\t\t\tincludingTop.push.apply(includingTop, elements)\r\n\t\t\t\telements = includingTop\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, l = elements.length; i < l; i++){\r\n\t\t\t\tvar element = elements[i]\r\n\t\t\t\tvar renderers = element.renderersOnShow\r\n\t\t\t\tif(renderers){\r\n\t\t\t\t\telement.renderersOnShow = null\r\n\t\t\t\t\t// remove needs-rerendering class\r\n\t\t\t\t\telement.className = element.className.replace(/\\s?needs\\-rerendering\\s?/g, '')\r\n\t\t\t\t\tfor (var id in renderers) {\r\n\t\t\t\t\t\tvar renderer = renderers[id]\r\n\t\t\t\t\t\trenderer.updateElement(element)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tfunction onElementRemoval(element){\r\n\t\t// cleanup element renderers\r\n\t\tif(element.alkaliRenderers){\r\n\t\t\tvar renderers = element.alkaliRenderers\r\n\t\t\tfor(var i = 0; i < renderers.length; i++){\r\n\t\t\t\tvar renderer = renderers[i]\r\n\t\t\t\trenderer.variable.stopNotifies(renderer)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tRenderer.onElementRemoval = function(element, onlyChildren){\r\n\t\tif(!onlyChildren){\r\n\t\t\tonElementRemoval(element)\r\n\t\t}\r\n\t\tvar children = element.getElementsByTagName('*')\r\n\t\tfor(var i = 0, l = children.length; i < l; i++){\r\n\t\t\tvar child = children[i]\r\n\t\t\tif(child.alkaliRenderers){\r\n\t\t\t\tonElementRemoval(child)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn Renderer\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./Variable'], factory) } else if (typeof module === 'object' && module.exports) {        \r\n  module.exports = factory(require('./Variable')) // Node\r\n}}(this, function (VariableExports) {\r\n\r\n\tvar VBoolean = VariableExports.VBoolean\r\n\tvar VNumber = VariableExports.VNumber\r\n\tvar operatingFunctions = {};\r\n\tvar operators = {};\r\n\tfunction getOperatingFunction(expression){\r\n\t\t// jshint evil: true\r\n\t\treturn operatingFunctions[expression] ||\r\n\t\t\t(operatingFunctions[expression] =\r\n\t\t\t\tnew Function('a', 'b', 'return ' + expression));\r\n\t}\r\n\tfunction operator(operator, type, name, precedence, forward, reverseA, reverseB){\r\n\t\t// defines the standard operators\r\n\t\tvar reverse = function(output, inputs){\r\n\t\t\tvar a = inputs[0],\r\n\t\t\t\tb = inputs[1]\r\n\t\t\tvar firstError\r\n\t\t\tif(a && a.put){\r\n\t\t\t\ttry {\r\n\t\t\t\t\treturn a.put(reverseA(output, b && b.valueOf()))\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tif (error.deniedPut) {\r\n\t\t\t\t\t\tfirstError = error\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow error\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(b && b.put){\r\n\t\t\t\tb.put(reverseB(output, a && a.valueOf()))\r\n\t\t\t} else {\r\n\t\t\t\tthrow (firstError && firstError.message ? firstError : new Error('Can not assign change value to constant operators'))\r\n\t\t\t}\r\n\t\t};\r\n\t\t// define a function that can lazily ensure the operating function\r\n\t\t// is available\r\n\t\tvar operatorHandler = {\r\n\t\t\tapply: function(instance, args){\r\n\t\t\t\tforward = getOperatingFunction(forward);\r\n\t\t\t\treverseA = reverseA && getOperatingFunction(reverseA);\r\n\t\t\t\treverseB = reverseB && getOperatingFunction(reverseB);\r\n\t\t\t\tforward.reverse = reverse;\r\n\t\t\t\toperators[operator] = operatorHandler = new VariableExports.Variable(forward);\r\n\r\n\t\t\t\taddFlags(operatorHandler);\r\n\t\t\t\targs = Array.prototype.slice.call(args);\r\n\t\t\t\treturn operatorHandler.apply(instance, args);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfunction addFlags(operatorHandler){\r\n\t\t\toperatorHandler.precedence = precedence;\r\n\t\t\toperatorHandler.infix = reverseB !== false;\r\n\t\t}\r\n\t\taddFlags(operatorHandler);\r\n\t\toperators[operator] = operatorHandler;\r\n\t\toperators[name] = function() {\r\n\t\t\tvar result = operatorHandler.apply(null, arguments)\r\n\t\t\treturn type ? result.as(type) : result\r\n\t\t}\r\n\t}\r\n\t// using order precedence from:\r\n\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence\r\n\toperator('+', VNumber, 'add', 6, 'a+b', 'a-b', 'a-b');\r\n\toperator('-', VNumber, 'subtract', 6, 'a-b', 'a+b', 'b-a');\r\n\toperator('*', VNumber, 'multiply', 5, 'a*b', 'a/b', 'a/b');\r\n\toperator('/', VNumber, 'divide', 5, 'a/b', 'a*b', 'b/a');\r\n//\toperator('^', 7, 'a^b', 'a^(-b)', 'Math.log(a)/Math.log(b)');\r\n\toperator('?', null, 'if', 16, 'b[a?0:1]', 'a===b[0]||(a===b[1]?false:(function(){throw new Error()})())', '[a,b]');\r\n\toperator(':', null, 'choose', 15, '[a,b]', 'a[0]?a[1]:(function(){throw new Error()})()', 'a[1]');\r\n\toperator('!', VBoolean, 'not', 4, '!a', '!a', false);\r\n\toperator('%', VNumber, 'remainder', 5, 'a%b');\r\n\toperator('>', VBoolean, 'greater', 8, 'a>b');\r\n\toperator('>=', VBoolean, 'greaterOrEqual', 8, 'a>=b');\r\n\toperator('<', VBoolean, 'less', 8, 'a<b');\r\n\toperator('<=', VBoolean, 'lessOrEqual', 8, 'a<=b');\r\n\toperator('===', VBoolean, 'strictEqual', 9, 'a===b');\r\n\toperator('==', VBoolean, 'equal', 9, 'a==b');\r\n\toperator('&', VBoolean, 'and', 8, 'a&&b');\r\n\toperator('|', VBoolean, 'or', 8, 'a||b');\r\n\toperator('nint', VNumber, 'round', 8, 'Math.round(a*Math.pow(10,b||1)/Math.pow(10,b||1))', 'a', 'a');\r\n\treturn operators;\r\n}))","/// <reference path=\"./typings.d.ts\" />\r\n(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n  define(['./Element', './Renderer', './reactive', './Copy', './operators', './Variable', './util/lang', './util/ContextualPromise'], factory) } else if (typeof module === 'object' && module.exports) {\r\n  module.exports = factory(require('./Element'), require('./Renderer'), require('./reactive'), require('./Copy'), require('./operators'), require('./Variable'), require('./util/lang'), require('./util/ContextualPromise')) // Node\r\n}}(this, function (Element, Renderer, reactive, Copy, operators, VariableExports, lang, ContextualPromise) {\r\n\r\n\tvar main = Object.create(Element)\r\n\tmain.Copy = Copy\r\n\tmain.Element = Element\r\n\tlang.copy(main, VariableExports)\r\n\tObject.defineProperty(main, 'currentContext', Object.getOwnPropertyDescriptor(VariableExports, 'currentContext'))\r\n\tmain.reactive = reactive\r\n\tlang.copy(main.react, reactive) // For backwards compatibility with babel transform\r\n\tmain.spawn = lang.spawn\r\n\tmain.Renderer = Renderer.ElementRenderer\r\n\tlang.copy(main, Renderer)\r\n\tlang.copy(main, operators)\r\n\tmain.ContextualPromise = ContextualPromise\r\n\tmain.default = reactive // default export\r\n\tvar localGlobal = typeof window == 'undefined' ? global : window\r\n\tif (localGlobal.alkali) {\r\n\t\tconsole.warn('Multiple instances of alkali have been defined, which can cause alkali context instances to be out of sync')\r\n\t}\r\n\treturn localGlobal.alkali = main\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./util/lang', './Renderer', './Variable'], factory) } else if (typeof module === 'object' && module.exports) {\r\n\tmodule.exports = factory(require('./util/lang'), require('./Renderer'), require('./Variable')) // Node\r\n}}(this, function (lang, Renderer, VariableExports) {\r\n\tvar Variable = VariableExports.Variable\r\n\tvar knownElementProperties = [\r\n\t\t'textContent', // Node\r\n\t\t'id', 'className', 'innerHTML', // Element\r\n\t\t'title', 'lang', 'hidden', 'translate', 'dir', 'tabIndex', 'accessKey', 'draggable', 'dropzone', 'spellcheck', 'contentEditable', 'innerText', // HTMLElement\r\n\t\t'translate', 'webkitdropzone'] // HTMLElement\r\n\r\n\tvar SELECTOR_REGEX = /^(\\.|#)([-\\w]+)(.+)?/\r\n\tvar isGenerator = lang.isGenerator\r\n\tvar Context = VariableExports.Context\r\n\tvar PropertyRenderer = Renderer.PropertyRenderer\r\n\tvar InputPropertyRenderer = Renderer.InputPropertyRenderer\r\n\tvar AttributeRenderer = Renderer.AttributeRenderer\r\n\tvar StyleRenderer = lang.compose(Renderer.StyleRenderer, function StyleRenderer() {\r\n\t\tRenderer.StyleRenderer.apply(this, arguments)\r\n\t}, {\r\n\t\trenderUpdate: function(newValue, element) {\r\n\t\t\tvar definition = styleDefinitions[this.name]\r\n\t\t\tif (definition) {\r\n\t\t\t\tdefinition(element, newValue, this.name)\r\n\t\t\t} else {\r\n\t\t\t\telement.style[this.name] = newValue\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tvar construct = typeof Reflect !== 'undefined' ? Reflect.construct :\r\n\t\tfunction(Constructor, args, Class) {\r\n\t\t\treturn Constructor.apply(Object.create(Class.prototype), args)\r\n\t\t}\r\n\r\n\tvar constructOrCall = lang.constructOrCall\r\n\tvar ClassNameRenderer = lang.compose(Renderer.ElementRenderer, function ClassNameRenderer(options) {\r\n\t\tthis.name = options.name\r\n\t\tRenderer.apply(this, arguments)\r\n\t}, {\r\n\t\trenderUpdate: function(newValue, element) {\r\n\t\t\tvar currentClassName = element.className\r\n\t\t\tvar changingClassName = this.name\r\n\t\t\t// remove the className (needed for addition or removal)\r\n\t\t\t// see http://jsperf.com/remove-class-name-algorithm/2 for some tests on this\r\n\t\t\tvar removed = currentClassName && (' ' + currentClassName + ' ').replace(' ' + changingClassName + ' ', ' ')\r\n\t\t\tif (newValue) {\r\n\t\t\t\t// addition, add the className\r\n\t\t\t\tchangingClassName = currentClassName ? (removed + changingClassName).slice(1) : changingClassName;\r\n\t\t\t} else {\r\n\t\t\t\t// we already have removed the class, just need to trim\r\n\t\t\t\tchangingClassName = removed.slice(1, removed.length - 1)\r\n\t\t\t}\r\n\t\t\t// only assign if it changed, this can save a lot of time\r\n\t\t\tif (changingClassName != currentClassName) {\r\n\t\t\t\telement.className = changingClassName\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tvar PropertiesRenderer = lang.compose(Renderer.ElementRenderer, function PropertiesRenderer(options) {\r\n\t\tthis.PropertyRenderer = options.PropertyRenderer\r\n\t\tRenderer.apply(this, arguments)\r\n\t}, {\r\n\t\trenderUpdate: function(newValue, element) {\r\n\t\t\tvar newProperties = []\r\n\t\t\t// assign properties based on object properties\r\n\t\t\tfor (var name in newValue) {\r\n\t\t\t\tthis.PropertyRenderer.prototype.renderUpdate.call({\r\n\t\t\t\t\tname: name\r\n\t\t\t\t}, newValue[name], element)\r\n\t\t\t\tnewProperties.push(name)\r\n\t\t\t}\r\n\t\t\tvar lastProperties = this.lastProperties\r\n\t\t\tif (lastProperties) {\r\n\t\t\t\t// if previous state existed, remove old names of any properties that don't exist anymore\r\n\t\t\t\tfor (var i = 0, l = lastProperties.length; i < l; i++) {\r\n\t\t\t\t\tvar name = lastProperties[i]\r\n\t\t\t\t\tif (!(name in newValue)) {\r\n\t\t\t\t\t\tthis.PropertyRenderer.prototype.renderUpdate.call({\r\n\t\t\t\t\t\t\tname: name\r\n\t\t\t\t\t\t}, undefined, element)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.lastProperties = newProperties // store the class names if we need to remove any on next state change\r\n\t\t}\r\n\t})\r\n\r\n\t// TODO: check for renderContent with text updater\r\n\tvar TextRenderer = Renderer.TextRenderer\r\n\tvar ListRenderer = Renderer.ListRenderer\r\n\r\n\tvar doc = typeof document !== 'undefined' ? document : {\r\n\t\tcreateElement: function(tag) {\r\n\t\t\treturn {}\r\n\t\t},\r\n\t\taddEventListener: function() {\r\n\t\t}\r\n\t}\r\n\r\n\tvar inputs = {\r\n\t\tINPUT: 1,\r\n\t\tTEXTAREA: 1\r\n\t\t// SELECT: 1, we exclude this, so the default \"content\" of the element can be the options\r\n\t}\r\n\r\n\tvar canExtendBuiltinElements\r\n\tvar buggyConstructorSetter = false\r\n\tvar testElement = doc.createElement('font')\r\n\tvar originalConstructor = testElement.constructor\r\n\ttestElement.constructor = function(){}\r\n\tif (doc.createElement('font').constructor == testElement.constructor) {\r\n\t\t// In safari, setting the constructor can actually assign it at the prototype level, instead of at the instance\r\n\t\ttestElement.__proto__.constructor = originalConstructor // restore the original constructor\r\n\t\tbuggyConstructorSetter = true\r\n\t\tlang.buggyConstructorSetter = buggyConstructorSetter\r\n\t}\r\n\r\n\r\n\tfunction booleanStyle(options) {\r\n\t\treturn function(element, value, key) {\r\n\t\t\tif (typeof value !== 'string') {\r\n\t\t\t\t// use the boolean conversion\r\n\t\t\t\tvalue = options[value ? 0 : 1]\r\n\t\t\t}\r\n\t\t\telement.style[key] = value\r\n\t\t}\r\n\t}\r\n\r\n\tfunction defaultStyle(element, value, key) {\r\n\t\tif (typeof value === 'number') {\r\n\t\t\tvalue = value + 'px'\r\n\t\t}\r\n\t\telement.style[key] = value\r\n\t}\r\n\tfunction directStyle(element, value, key) {\r\n\t\telement.style[key] = value\r\n\t}\r\n\r\n\tvar styleDefinitions = {\r\n\t\tdisplay: booleanStyle(['', 'none']),\r\n\t\tvisibility: booleanStyle(['visible', 'hidden']),\r\n\t\tcolor: directStyle,\r\n\t\topacity: directStyle,\r\n\t\tzoom: directStyle,\r\n\t\tminZoom: directStyle,\r\n\t\tmaxZoom: directStyle,\r\n\t\tfontWeight: directStyle,\r\n\t\tposition: booleanStyle(['absolute', '']),\r\n\t\ttextDecoration: booleanStyle(['underline', '']),\r\n\t\tfontWeight: directStyle // numbers are allowed here (TODO: eventually allow booleans too)\r\n\t}\r\n\t;[\"alignContent\",\"alignItems\",\"alignSelf\",\"animation\",\"animationDelay\",\"animationDirection\",\"animationDuration\",\"animationFillMode\",\"animationIterationCount\",\"animationName\",\"animationPlayState\",\"animationTimingFunction\",\"backfaceVisibility\",\"background\",\"backgroundAttachment\",\"backgroundBlendMode\",\"backgroundClip\",\"backgroundColor\",\"backgroundImage\",\"backgroundOrigin\",\"backgroundPosition\",\"backgroundPositionX\",\"backgroundPositionY\",\"backgroundRepeat\",\"backgroundRepeatX\",\"backgroundRepeatY\",\"backgroundSize\",\"baselineShift\",\"border\",\"borderBottom\",\"borderBottomColor\",\"borderBottomLeftRadius\",\"borderBottomRightRadius\",\"borderBottomStyle\",\"borderBottomWidth\",\"borderCollapse\",\"borderColor\",\"borderImage\",\"borderImageOutset\",\"borderImageRepeat\",\"borderImageSlice\",\"borderImageSource\",\"borderImageWidth\",\"borderLeft\",\"borderLeftColor\",\"borderLeftStyle\",\"borderLeftWidth\",\"borderRadius\",\"borderRight\",\"borderRightColor\",\"borderRightStyle\",\"borderRightWidth\",\"borderSpacing\",\"borderStyle\",\"borderTop\",\"borderTopColor\",\"borderTopLeftRadius\",\"borderTopRightRadius\",\"borderTopStyle\",\"borderTopWidth\",\"borderWidth\",\"bottom\",\"boxShadow\",\"boxSizing\",\"bufferedRendering\",\"captionSide\",\"clear\",\"clip\",\"clipPath\",\"clipRule\",\"color\",\"colorInterpolation\",\"colorInterpolationFilters\",\"colorRendering\",\"counterIncrement\",\"counterReset\",\"cursor\",\"direction\",\"display\",\"emptyCells\",\"fill\",\"fillOpacity\",\"fillRule\",\"filter\",\"flex\",\"flexBasis\",\"flexDirection\",\"flexFlow\",\"flexGrow\",\"flexShrink\",\"flexWrap\",\"float\",\"floodColor\",\"floodOpacity\",\"font\",\"fontFamily\",\"fontFeatureSettings\",\"fontKerning\",\"fontSize\",\"fontStretch\",\"fontStyle\",\"fontVariant\",\"fontVariantLigatures\",\"fontWeight\",\"height\",\"imageRendering\",\"isolation\",\"justifyContent\",\"left\",\"letterSpacing\",\"lightingColor\",\"lineHeight\",\"listStyle\",\"listStyleImage\",\"listStylePosition\",\"listStyleType\",\"margin\",\"marginBottom\",\"marginLeft\",\"marginRight\",\"marginTop\",\"marker\",\"markerEnd\",\"markerMid\",\"markerStart\",\"mask\",\"maskType\",\"maxHeight\",\"maxWidth\",\"maxZoom\",\"minHeight\",\"minWidth\",\"minZoom\",\"mixBlendMode\",\"motion\",\"motionOffset\",\"motionPath\",\"motionRotation\",\"objectFit\",\"objectPosition\",\"opacity\",\"order\",\"orientation\",\"orphans\",\"outline\",\"outlineColor\",\"outlineOffset\",\"outlineStyle\",\"outlineWidth\",\"overflow\",\"overflowWrap\",\"overflowX\",\"overflowY\",\"padding\",\"paddingBottom\",\"paddingLeft\",\"paddingRight\",\"paddingTop\",\"page\",\"pageBreakAfter\",\"pageBreakBefore\",\"pageBreakInside\",\"paintOrder\",\"perspective\",\"perspectiveOrigin\",\"pointerEvents\",\"position\",\"quotes\",\"resize\",\"right\",\"shapeImageThreshold\",\"shapeMargin\",\"shapeOutside\",\"shapeRendering\",\"size\",\"speak\",\"src\",\"stopColor\",\"stopOpacity\",\"stroke\",\"strokeDasharray\",\"strokeDashoffset\",\"strokeLinecap\",\"strokeLinejoin\",\"strokeMiterlimit\",\"strokeOpacity\",\"strokeWidth\",\"tabSize\",\"tableLayout\",\"textAlign\",\"textAlignLast\",\"textAnchor\",\"textCombineUpright\",\"textDecoration\",\"textIndent\",\"textOrientation\",\"textOverflow\",\"textRendering\",\"textShadow\",\"textTransform\",\"top\",\"touchAction\",\"transform\",\"transformOrigin\",\"transformStyle\",\"transition\",\"transitionDelay\",\"transitionDuration\",\"transitionProperty\",\"transitionTimingFunction\",\"unicodeBidi\",\"unicodeRange\",\"userZoom\",\"vectorEffect\",\"verticalAlign\",\"visibility\",\"whiteSpace\",\"widows\",\"width\",\"willChange\",\"wordBreak\",\"wordSpacing\",\"wordWrap\",\"writingMode\",\"zIndex\",\"zoom\"].forEach(function(property) {\r\n\t\tstyleDefinitions[property] = styleDefinitions[property] || defaultStyle\r\n\t})\r\n\tvar styleSheet\r\n\tvar presumptiveParentMap = new lang.WeakMap()\r\n\r\n\tvar setPrototypeOf = lang.setPrototypeOf\r\n\tvar getPrototypeOf = Object.getPrototypeOf || (function(base) { return base.__proto__ })\r\n\tfunction createCssRule(selector) {\r\n\t\tif (!styleSheet) {\r\n\t\t\tvar styleSheetElement = doc.createElement(\"style\")\r\n\t\t\tstyleSheetElement.setAttribute(\"type\", \"text/css\")\r\n//\t\t\tstyleSheet.appendChild(doc.createTextNode(css))\r\n\t\t\tdoc.head.insertBefore(styleSheetElement, doc.head.firstChild)\r\n\t\t\tstyleSheet = styleSheetElement.sheet\r\n\t\t}\r\n\t\tvar cssRules = styleSheet.cssRules || styleSheet.rules\r\n\t\treturn cssRules[styleSheet.insertRule(selector + ' {}', cssRules.length)]\r\n\t}\r\n\r\n\t// TODO: Need to do some more testing to see if that would improve performance:\r\n\t// var fragmentThresholdHeuristic = (typeof navigator !== 'undefined' && navigator.userAgent.indexOf('Chrome') > 0) ? 1 : 3\r\n\r\n\tfunction layoutChildren(parent, children, container, prepend) {\r\n\t\tvar fragment = (children.length > 1 || prepend) ? doc.createDocumentFragment() : parent\r\n\t\tfor(var i = 0, l = children.length; i < l; i++) {\r\n\t\t\tvar child = children[i]\r\n\t\t\tvar childNode\r\n\t\t\tif (child != null) { // we just skip nulls and undefined, helps make it easier to write conditional element logic\r\n\t\t\t\tif (child.notifies) {\r\n\t\t\t\t\t// a variable\r\n\t\t\t\t\tvar ref = child.isIterable ? fragment : parent\r\n\t\t\t\t\tfragment.appendChild(childNode = variableAsContent(ref, child))\r\n\t\t\t\t} else if (typeof child === 'function') {\r\n\t\t\t\t\t// an element constructor\r\n\t\t\t\t\tcurrentParent = parent\r\n\t\t\t\t\tchildNode = new child()\r\n\t\t\t\t\tfragment.appendChild(childNode)\r\n\t\t\t\t\tif (child.isContentNode) {\r\n\t\t\t\t\t\tcontainer.contentNode = childNode\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (typeof child == 'object') {\r\n\t\t\t\t\tif (child instanceof Array) {\r\n\t\t\t\t\t\t// array of sub-children\r\n\t\t\t\t\t\tcontainer = container || parent\r\n\t\t\t\t\t\tchildNode = childNode || parent\r\n\t\t\t\t\t\tlayoutChildren(childNode.contentNode || childNode, child, container)\r\n\t\t\t\t\t} else if (child.nodeType) {\r\n\t\t\t\t\t\t// an element itself\r\n\t\t\t\t\t\tfragment.appendChild(childNode = child)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// TODO: apply properties to last child, but with binding to the parent (for events)\r\n\t\t\t\t\t\tthrow new Error('Unknown child type ' + child)\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// a primitive value\r\n\t\t\t\t\tchildNode = doc.createTextNode(child)\r\n\t\t\t\t\tfragment.appendChild(childNode)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (fragment != parent) {\r\n\t\t\tif (prepend) {\r\n\t\t\t\tparent.insertBefore(fragment, parent.firstChild)\r\n\t\t\t} else {\r\n\t\t\t\tparent.appendChild(fragment)\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn childNode\r\n\t}\r\n\tfunction variableAsContent(parent, content) {\r\n\t\tif (content == null) {\r\n\t\t\treturn doc.createTextNode('')\r\n\t\t}\r\n\t\tvar textNode\r\n\t\tif (content.notifies) {\r\n\t\t\ttextNode = doc.createTextNode('')\r\n\t\t\tvar renderer = new TextRenderer({\r\n\t\t\t\telement: parent,\r\n\t\t\t\ttextNode: textNode,\r\n\t\t\t\tvariable: content\r\n\t\t\t})\r\n\t\t\ttextNode = renderer.textNode // it can be swapped for another node\r\n\t\t} else {\r\n\t\t\ttextNode = doc.createTextNode(content)\r\n\t\t}\r\n\t\treturn textNode\r\n\t}\r\n\r\n\tfunction bidirectionalHandler(element, value, key) {\r\n\t\tif (value && value.notifies) {\r\n\t\t\tnew InputPropertyRenderer({\r\n\t\t\t\tname: key,\r\n\t\t\t\tvariable: value,\r\n\t\t\t\telement: element\r\n\t\t\t})\r\n\t\t\tif (inputs[element.tagName] || element.tagName === 'SELECT') {\r\n\t\t\t\tbindChanges(element, value, key)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (element.tagName === 'SELECT' && key === 'value') {\r\n\t\t\t\t// use the deferred <select> value assignment\r\n\t\t\t\tInputPropertyRenderer.prototype.renderSelectValueUpdate(value, element)\r\n\t\t\t} else {\r\n\t\t\t\tif (element.type === 'number') {\r\n\t\t\t\t\tif (isNaN(value)) {\r\n\t\t\t\t\t\tvalue = ''\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telement[key] = value\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction noop() {}\r\n\tvar propertyHandlers = {\r\n\t\tchildren: noop,\r\n\t\ttagName: noop,\r\n\t\t_generators: noop,\r\n\t\tclasses: function(element, classes) {\r\n\t\t\tif (classes.notifies && classes.put) {\r\n\t\t\t\t// it is a variable\r\n\t\t\t\tnew PropertiesRenderer({\r\n\t\t\t\t\tPropertyRenderer: ClassNameRenderer,\r\n\t\t\t\t\telement: element,\r\n\t\t\t\t\tvariable: classes\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tvar isArray\r\n\t\t\tif (classes.length > -1) {\r\n\t\t\t\tisArray = true\r\n\t\t\t} else {\r\n\t\t\t\t// index the classes, if necessary\r\n\t\t\t\tvar i = 0\r\n\t\t\t\tfor (var key in classes) {\r\n\t\t\t\t\tif (!classes[i]) {\r\n\t\t\t\t\t\tclasses[i] = key\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti++\r\n\t\t\t\t}\r\n\t\t\t\tclasses.length = i\r\n\t\t\t}\r\n\t\t\tfor (var i = 0, l = classes.length; i < l; i++) {\r\n\t\t\t\t// find each class name\r\n\t\t\t\tvar className = classes[i]\r\n\t\t\t\tvar flag = classes[className]\r\n\t\t\t\tif (flag && flag.notifies) {\r\n\t\t\t\t\t// if it is a variable, we react to it\r\n\t\t\t\t\tnew ClassNameRenderer({\r\n\t\t\t\t\t\telement: element,\r\n\t\t\t\t\t\tname: className,\r\n\t\t\t\t\t\tvariable: flag\r\n\t\t\t\t\t})\r\n\t\t\t\t} else if (flag || isArray) {\r\n\t\t\t\t\telement.className += ' ' + className\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tclass: applyAttribute,\r\n\t\tfor: applyAttribute, // TODO: move to label?\r\n\t\trole: applyAttribute,\r\n\t\trender: function(element, value, key, properties) {\r\n\t\t\t// TODO: This doesn't need to be a property updater (is in place for *render())\r\n\t\t\t// we should also verify it is a generator\r\n\t\t\t// and maybe, at some point, find an optimization to eliminate the bind()\r\n\t\t\tnew PropertyRenderer({\r\n\t\t\t\tname: key,\r\n\t\t\t\tvariable: typeof value === 'function' ? new VariableExports.GeneratorVariable(value.bind(element, properties)) : value, // if it was defined on the constructor, it should already be bound\r\n\t\t\t\telement: element\r\n\t\t\t})\r\n\t\t},\r\n\t\tdataset: applySubProperties(function(newValue, element, key) {\r\n\t\t\tkey = key || this.name\r\n\t\t\tif (newValue == null) {\r\n\t\t\t\tdelete element.dataset[key]\r\n\t\t\t} else {\r\n\t\t\t\telement.dataset[key] = newValue\r\n\t\t\t}\r\n\t\t}),\r\n\t\tattributes: applySubProperties(function(newValue, element, key) {\r\n\t\t\tAttributeRenderer.prototype.renderUpdate.call({\r\n\t\t\t\tname: key || this.name\r\n\t\t\t}, newValue, element)\r\n\t\t}),\r\n\t\tstyle: function(element, value, key) {\r\n\t\t\tif (typeof value === 'string') {\r\n\t\t\t\telement.setAttribute('style', value)\r\n\t\t\t} else if (value && value.notifies) {\r\n\t\t\t\tnew AttributeRenderer({\r\n\t\t\t\t\tname: 'style',\r\n\t\t\t\t\tvariable: value,\r\n\t\t\t\t\telement: element\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tstyleObjectHandler(element, value, key)\r\n\t\t\t}\r\n\t\t},\r\n\t\t_item: function(element, value) {\r\n\t\t\tsetForClass(element, value.constructor, value)\r\n\t\t}\r\n\t}\r\n\r\n\tknownElementProperties.forEach(function(property) {\r\n\t\tpropertyHandlers[property] = true\r\n\t})\r\n\tif (typeof HTMLElement !== 'undefined') {\r\n\t\tHTMLElement.prototype._propertyHandlers = propertyHandlers // inherit this, at least for now\r\n\t}\r\n\tvar elementPropertyHandlers = {\r\n\t\tinput: lang.copy(['accept', 'alt', 'autocomplete', 'autofocus', 'capture', 'defaultChecked', 'dirName', 'disabled', 'form', 'files', 'formAction', 'formEnctype', 'formMethod', 'formNoValidate', 'formTarget', 'indeterminate', 'inputMode', 'list', 'max', 'maxLength', 'min', 'minLength', 'multiple', 'name', 'pattern', 'placeholder', 'readOnly', 'required', 'size', 'src', 'step', 'type', 'defaultValue', 'willValidate', 'validity', 'validationMessage', 'useMap', 'autocapitalize', 'webkitdirectory', 'incremental', 'stepUp', 'stepDown'], {\r\n\t\t\tvalue: bidirectionalHandler,\r\n\t\t\tvalueAsNumber: bidirectionalHandler,\r\n\t\t\tvalueAsDate: bidirectionalHandler,\r\n\t\t\tchecked: bidirectionalHandler,\r\n\t\t\ttype: function(element, value) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\telement.type = value\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\t// IE 11 will throw an error here\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}),\r\n\t\tselect: lang.copy(['disabled', 'name', 'size', 'type', 'selectedIndex', 'validationMessage'], {\r\n\t\t\tvalue: bidirectionalHandler\r\n\t\t}),\r\n\t\ttextarea: lang.copy(['cols', 'dirName', 'maxLength', 'minLength', 'name', 'placeholder', 'rows', 'wrap', 'type', 'defaultValue', 'textLength', 'validationMessage', 'autocapitalize'], {\r\n\t\t\tvalue: bidirectionalHandler\r\n\t\t}),\r\n\t\ta: ['target', 'download', 'ping', 'rel', 'hreflang', 'type', 'referrerPolicy', 'href', 'media'],\r\n\t\tarea: ['target', 'download', 'coords', 'rel', 'hreflang', 'type', 'referrerPolicy', 'href', 'media', 'alt', 'shape'],\r\n\t\tbutton: ['disabled', 'formAction', 'formEnctype', 'formMethod', 'formTarget', 'name', 'type', 'value', 'validationMessage'],\r\n\t\tdetails: ['open'],\r\n\t\tdialog: ['open'],\r\n\t\tembed: ['src', 'type', 'name'],\r\n\t\tfieldset: ['disabled', 'form', 'name'],\r\n\t\tform: ['acceptCharset', 'action', 'autocomplete', 'enctype', 'encoding', 'method', 'name', 'target', 'novalidate'],\r\n\t\tframe: ['name', 'scrolling', 'src', 'frameBorder'],\r\n\t\tframeset: ['cols', 'rows'],\r\n\t\tiframe: ['src', 'srcdoc', 'name', 'referrerPolicy', 'align', 'scrolling', 'frameBorder', 'longDesc'],\r\n\t\timg: ['src', 'alt', 'crossorigin', 'ismap', 'longdesc', 'sizes', 'srcset', 'usemap', 'referrerpolicy'],\r\n\t\toption: ['label', 'value', 'text', 'index'],\r\n\t\toptgroup: ['label'],\r\n\t\toutput: ['name', 'type', 'defaultValue', 'value', 'validationMessage'],\r\n\t\tlabel: ['htmlFor'],\r\n\t\ttd: ['colSpan', 'rowSpan'],\r\n\t\tth: ['colSpan', 'rowSpan'],\r\n\t\tscript: ['src', 'type', 'charset', 'text', 'event', 'htmlFor', 'integrity'],\r\n\t\tstyle: ['media', 'type'],\r\n\t\ttrack: ['kind', 'src', 'srclang', 'label'],\r\n\t\tlink: ['href', 'rel', 'media', 'hreflang', 'type', 'charset', 'rev', 'target', 'integrity', 'as'],\r\n\t\tmeta: ['name', 'httpEquiv', 'content', 'scheme'],\r\n\t\tmeter: ['value', 'min', 'max', 'low', 'high', 'optimum'],\r\n\t\tprogress: ['value', 'max', 'position'],\r\n\t\tdel: ['cite', 'dateTime'],\r\n\t\tins: ['cite', 'dateTime'],\r\n\t\tsource: ['src', 'type', 'srcset', 'sizes', 'media'],\r\n\t\tvideo: ['videoWidth', 'videoHeight', 'poster', 'webkitDecodedFrameCount', 'webkitDroppedFrameCount'],\r\n\t\tkeygen: ['challenge', 'keytype', 'name', 'type', 'validationMessage'],\r\n\t\tobject: ['data', 'type', 'name', 'useMap', 'validationMessage', 'archive', 'code', 'hspace', 'standby', 'vspace', 'codeBase', 'codeType'],\r\n\t\tparam: ['name', 'value', 'type', 'valueType']\r\n\t}\r\n\r\n\tfunction applyAttribute(element, value, key) {\r\n\t\tif (value && value.notifies) {\r\n\t\t\tnew AttributeRenderer({\r\n\t\t\t\tname: key,\r\n\t\t\t\tvariable: value,\r\n\t\t\t\telement: element\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\telement.setAttribute(key, value)\r\n\t\t}\r\n\t}\r\n\r\n\tvar styleObjectHandler = applySubProperties(function(newValue, element, key) {\r\n\t\telement.style[key || this.name] = newValue\r\n\t})\r\n\r\n\tfunction applySubProperties(renderer) {\r\n\t\tvar SubPropertyRenderer = lang.compose(PropertyRenderer, function SubPropertyRenderer(options) {\r\n\t\t\tPropertyRenderer.apply(this, arguments)\r\n\t\t}, {\r\n\t\t\trenderUpdate: renderer\r\n\t\t})\r\n\t\treturn function(element, value, key) {\r\n\t\t\tif (value.notifies && value.put) {\r\n\t\t\t\tnew PropertiesRenderer({\r\n\t\t\t\t\tPropertyRenderer: SubPropertyRenderer,\r\n\t\t\t\t\tvariable: value,\r\n\t\t\t\t\telement: element\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tfor (var subKey in value) {\r\n\t\t\t\tvar subValue = value[subKey]\r\n\t\t\t\tif (subValue && subValue.notifies) {\r\n\t\t\t\t\tnew SubPropertyRenderer({\r\n\t\t\t\t\t\tname: subKey,\r\n\t\t\t\t\t\tvariable: subValue,\r\n\t\t\t\t\t\telement: element\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderer(subValue, element, subKey)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction assignProperties(element, properties) {\r\n\t\tvar propertyHandlers = element._propertyHandlers\r\n\t\tvar Element = element.constructor\r\n\t\tfor (var key in properties) {\r\n\t\t\tvar value = properties[key]\r\n\t\t\tvar VariableClass = Element[key]\r\n\t\t\tif (typeof VariableClass === 'function' && VariableClass.notifies && VariableClass !== value) {\r\n\t\t\t\thasOwn(Element, VariableClass)\r\n\t\t\t\t// if (value instanceof VariableClass) { TODO: assign the value as the owned instance\r\n\t\t\t\tVariableClass.for(element).put(value)\r\n\t\t\t}\r\n\t\t\tvar styleDefinition\r\n\t\t\tvar propertyHandler = propertyHandlers[key]\r\n\t\t\tif (propertyHandler) {\r\n\t\t\t\tif (propertyHandler === true) {\r\n\t\t\t\t\tif (value && value.notifies) {\r\n\t\t\t\t\t// a standard, known element property\r\n\t\t\t\t\t\tnew PropertyRenderer({\r\n\t\t\t\t\t\t\tname: key,\r\n\t\t\t\t\t\t\tvariable: value,\r\n\t\t\t\t\t\t\telement: element\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\telement[key] = value\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpropertyHandler(element, value, key, properties)\r\n\t\t\t\t}\r\n\t\t\t} else if ((styleDefinition = styleDefinitions[key])) {\r\n\t\t\t\tif (value && value.notifies) {\r\n\t\t\t\t\tnew StyleRenderer({\r\n\t\t\t\t\t\tname: key,\r\n\t\t\t\t\t\tvariable: value,\r\n\t\t\t\t\t\telement: element\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstyleDefinition(element, value, key)\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === 'function' && key.slice(0, 2) === 'on') {\r\n\t\t\t\t// event listener\r\n\t\t\t\tif (element[key] !== null && !element['_registeredEvent_' + key]) {\r\n\t\t\t\t\t// setup custom event listener\r\n\t\t\t\t\telement['_registeredEvent_' + key] = true\r\n\t\t\t\t\telement.addEventListener(key.slice(2), function(event) {\r\n\t\t\t\t\t\tthis['on' + event.type](event)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telement[key] = value // standard assignment\r\n\t\t\t} else if (element[key] == null) {\r\n\t\t\t\t// we are working an unknown/unstandard property (or a standard/registered event listener)\r\n\t\t\t\t// undefined or null means we can safely set\r\n\t\t\t\telement[key] = value\r\n\t\t\t} else {\r\n\t\t\t\t// otherwise bypass/override the native getter/setter\r\n\t\t\t\tObject.defineProperty(element, key, {\r\n\t\t\t\t\tvalue: value,\r\n\t\t\t\t\tenumerable: true,\r\n\t\t\t\t\tconfigurable: true,\r\n\t\t\t\t\twritable: true\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction assignGenerators(element, properties) {\r\n\t\tvar generators = properties._generators\r\n\t\tvar customGenerators\r\n\t\tvar styleGenerators\r\n\t\tvar nativeGenerators\r\n\t\tvar propertyHandlers = element._propertyHandlers\r\n\t\tfor (var key in generators) {\r\n\t\t\tvar variable = new VariableExports.GeneratorVariable(generators[key].bind(element, properties))\r\n\t\t\tif (propertyHandlers[key]) {\r\n\t\t\t\t(nativeGenerators || (nativeGenerators = {}))[key] = variable\r\n\t\t\t} else if (styleDefinitions[key]) {\r\n\t\t\t\t(styleGenerators || (styleGenerators = {}))[key] = variable\r\n\t\t\t} else {\r\n\t\t\t\t(customGenerators || (customGenerators = {}))[key] = variable\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (customGenerators) {\r\n\t\t\t// custom ones must go first\r\n\t\t\tassignProperties(element, customGenerators)\r\n\t\t}\r\n\t\tif (styleGenerators) {\r\n\t\t\tassignProperties(element, styleGenerators)\r\n\t\t}\r\n\t\tif (nativeGenerators) {\r\n\t\t\t// native ones must come last so they can access custom ones\r\n\t\t\tassignProperties(element, nativeGenerators)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction buildContent(element, content, key, properties) {\r\n\t\tvar each = element.each || properties.each\r\n\t\tif (each && content) {\r\n\t\t\t// render as list\r\n\t\t\tif (each.create) {\r\n\t\t\t\teach.defineHasOwn = function () {\r\n\t\t\t\t\thasOwn(each, Item, function (element) {\r\n\t\t\t\t\t\tvar itemVariable = Item.from(element._item)\r\n\t\t\t\t\t\treturn itemVariable\r\n\t\t\t\t\t})\r\n\t\t\t\t\tvar ItemClass = content.getCollectionOf && content.getCollectionOf()\r\n\t\t\t\t\tif (ItemClass) {\r\n\t\t\t\t\t\t// if it is typed, make it available through the typed class as well.\r\n\t\t\t\t\t\thasOwn(each, ItemClass, function (element) {\r\n\t\t\t\t\t\t\tvar itemVariable = ItemClass.from(element._item)\r\n\t\t\t\t\t\t\treturn itemVariable\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (content.notifies) {\r\n\t\t\t\tnew ListRenderer({\r\n\t\t\t\t\teach: each,\r\n\t\t\t\t\tvariable: content,\r\n\t\t\t\t\telement: element\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tvar fragment = doc.createDocumentFragment()\r\n\t\t\t\tif (each.defineHasOwn) {\r\n\t\t\t\t\teach.defineHasOwn()\r\n\t\t\t\t}\r\n\t\t\t\tcontent.forEach(function(item) {\r\n\t\t\t\t\tif (each.create) {\r\n\t\t\t\t\t\tchildElement = each.create({parent: element, _item: item}) // TODO: make a faster object here potentially\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchildElement = each(item, element)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfragment.appendChild(childElement)\r\n\t\t\t\t})\r\n\t\t\t\telement.appendChild(fragment)\r\n\t\t\t}\r\n\t\t} else if (inputs[element.tagName]) {\r\n\t\t\t// render into input\r\n\t\t\tbuildInputContent(element, content)\r\n\t\t} else if (content instanceof Array) {\r\n\t\t\t// treat array as children (potentially of the content node)\r\n\t\t\telement = element.contentNode || element\r\n\t\t\tlayoutChildren(element, content, element)\r\n\t\t} else if (typeof content === 'function' && content.for) {\r\n\t\t\t// a child constructor\r\n\t\t\telement = element.contentNode || element\r\n\t\t\tlayoutChildren(element, [content], element)\r\n\t\t} else {\r\n\t\t\t// render as string\r\n\t\t\telement.appendChild(variableAsContent(element, content))\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindChanges(element, variable, key, conversion) {\r\n\t\tlang.nextTurn(function() { // wait for next turn in case inputChanges isn't set yet\r\n\t\t\tvar inputEvents = element.inputEvents || ['change', 'alkali-change']\r\n\t\t\tfor (var i = 0, l = inputEvents.length; i < l; i++) {\r\n\t\t\t\telement.addEventListener(inputEvents[i], function (event) {\r\n\t\t\t\t\tvar value = element[key]\r\n\t\t\t\t\tnew Context(element).executeWithin(function() {\r\n\t\t\t\t\t\tvar result = variable.put(conversion ? conversion(value, element) : value)\r\n\t\t\t\t\t\tif (result === VariableExports.deny) {\r\n\t\t\t\t\t\t\tthrow new Error('Variable change denied')\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tdoc.addEventListener('click', function(event) {\r\n\t\tvar target = event.target\r\n\t\tif (target.type === 'radio') {\r\n\t\t\tvar radios = doc.querySelectorAll('input[type=radio]')\r\n\t\t\tfor (var i = 0, l = radios.length; i < l; i++) {\r\n\t\t\t\tvar radio = radios[i]\r\n\t\t\t\tif (radio.name === target.name && radio !== target) {\r\n\t\t\t\t\tradio.dispatchEvent(new Event('alkali-change', {}))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\tfunction conversion(value, element) {\r\n\t\tif (element.type == 'number') {\r\n\t\t\treturn parseFloat(value)\r\n\t\t}\r\n\t\treturn value\r\n\t}\r\n\r\n\tfunction buildInputContent(element, content) {\r\n\t\tvar inputType = element.type\r\n\t\tvar inputProperty = inputType in {date: 1, datetime: 1, time: 1} ?\r\n\t\t\t\t'valueAsDate' : (inputType === 'checkbox' || inputType === 'radio') ?\r\n\t\t\t\t\t'checked' : 'value'\r\n\r\n\t\tif (content && content.notifies) {\r\n\t\t\t// a variable, respond to changes\r\n\t\t\tnew InputPropertyRenderer({\r\n\t\t\t\tvariable: content,\r\n\t\t\t\tname: inputProperty,\r\n\t\t\t\telement: element\r\n\t\t\t})\r\n\t\t\t// and bind the other way as well, updating the variable in response to input changes\r\n\t\t\tbindChanges(element, content, inputProperty, conversion)\r\n\t\t} else {\r\n\t\t\t// primitive\r\n\t\t\telement[inputProperty] = content\r\n\t\t}\r\n\t}\r\n\r\n\tfunction mergeObject(Element, value, key, properties) {\r\n\t\tvar existing = properties[key]\r\n\t\tif (existing) {\r\n\t\t\tfor (var subKey in value) {\r\n\t\t\t\texisting[subKey] = value[subKey]\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tproperties[key] = value\r\n\t\t}\r\n\t}\r\n\r\n\tvar classHandlers = {\r\n\t\tclasses: mergeObject,\r\n\t\t_generators: mergeObject,\r\n\t\tdataset: mergeObject,\r\n\t\tattributes: mergeObject,\r\n\t\tstyle: mergeObject,\r\n\t\thasOwn: function(Element, value) {\r\n\t\t\thasOwn(Element, value)\r\n\t\t},\r\n\t\tchildren: function(Element, value) {\r\n\t\t\tElement.children = value\r\n\t\t},\r\n\t\tshadow: function(Element, value) {\r\n\t\t\tElement.shadow = value\r\n\t\t}\r\n\t}\r\n\r\n\tfunction applyToConstructor(argument, Element) {\r\n\t\tvar applyOnCreate = Element._applyOnCreate\r\n\t\tif (argument && typeof argument === 'object') {\r\n\t\t\tif (argument instanceof Array || argument.notifies) {\r\n\t\t\t\tapplyOnCreate.content = argument\r\n\t\t\t} else {\r\n\t\t\t\tfor (var key in argument) {\r\n\t\t\t\t// TODO: eventually we want to be able to set these as rules statically per element\r\n\t\t\t\t/*if (styleDefinitions[key]) {\r\n\t\t\t\t\tvar styles = Element.styles || (Element.styles = [])\r\n\t\t\t\t\tstyles.push(key)\r\n\t\t\t\t\tstyles[key] = descriptor.value\r\n\t\t\t\t} else {*/\r\n\t\t\t\t\tvar value = argument[key]\r\n\t\t\t\t\tvar VariableClass = Element[key]\r\n\t\t\t\t\tif (typeof value === 'function') {\r\n\t\t\t\t\t\tif (value.notifies) {\r\n\t\t\t\t\t\t\tif (value === Variable) {\r\n\t\t\t\t\t\t\t\tvalue = Variable() // create a branded variable if we are using a generic one\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// for Variable classes we make them statically available on the element\r\n\t\t\t\t\t\t\tif (Element[key]) {\r\n\t\t\t\t\t\t\t\tObject.defineProperty(Element, key, {\r\n\t\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\t\tenumerable: true\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tElement[key] = value\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (isGenerator(value)) {\r\n\t\t\t\t\t\t\tif (key.slice(0, 4) === 'get_') {\r\n\t\t\t\t\t\t\t\tkey = key.slice(4)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t(applyOnCreate._generators || (applyOnCreate._generators = {}))[key] = value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (value && value.notifies) {\r\n\t\t\t\t\t\t// also store any variables as statically available properties\r\n\t\t\t\t\t\tif (Element[key]) {\r\n\t\t\t\t\t\t\tObject.defineProperty(Element, key, {\r\n\t\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\t\tenumerable: true\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tElement[key] = value\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (classHandlers[key]) { // Could eliminate this if we got rid of hasOwn\r\n\t\t\t\t\t\tclassHandlers[key](Element, value, key, applyOnCreate)\r\n\t\t\t\t\t} else if (typeof VariableClass === 'function' && VariableClass.notifies) {\r\n\t\t\t\t\t\tapplyOnCreate[key] = new VariableClass(value)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapplyOnCreate[key] = value\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (typeof argument === 'function' && !argument.for) {\r\n\t\t\tthrow new TypeError('Function as argument not supported')\r\n\t\t} else {\r\n\t\t\tapplyOnCreate.content = argument\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getApplySet(Class) {\r\n\t\tif (Class.hasOwnProperty('_applyOnCreate')) {\r\n\t\t\treturn Class._applyOnCreate\r\n\t\t}\r\n\t\t// this means we didn't extend and evaluate the prototype yet\r\n\t\tif (Class.getForClass) {\r\n\t\t\t// we are extending an alkali constructor\r\n\t\t\t// if this class is inheriting from an alkali constructor, work our way up the chain\r\n\t\t\tvar applyOnCreate = Class._applyOnCreate = {}\r\n\t\t\tvar parentApplySet = getApplySet(getPrototypeOf(Class))\r\n\t\t\tfor (var key in parentApplySet) {\r\n\t\t\t\tapplyOnCreate[key] = classHandlers[key] ? Object.create(parentApplySet[key]) : parentApplySet[key]\r\n\t\t\t}\r\n\t\t\t// we need to check the prototype for event handlers\r\n\t\t\tvar prototype = Class.prototype\r\n\t\t\tvar propertyHandlers\r\n\t\t\tvar keys = Object.getOwnPropertyNames(prototype)\r\n\t\t\tfor (var i = 0, l = keys.length; i < l; i++) {\r\n\t\t\t\tvar key = keys[i]\r\n\t\t\t\tif (key.slice(0, 2) === 'on' || (key === 'render' && isGenerator(prototype[key]))) {\r\n\t\t\t\t\tif (Element.disallowClassEventHandlers && getPrototypeOf(prototype)[key] === null) {\r\n\t\t\t\t\t\tthrow new Error('Defining event handlers through class methods is not allowed (due to incompatibility with compiled code)')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapplyOnCreate[key] = prototype[key]\r\n\t\t\t\t} else if (key.slice(0, 6) === 'render') {\r\n\t\t\t\t\tvar propertyName = key[6].toLowerCase() + key.slice(7)\r\n\t\t\t\t\tif (!propertyHandlers) {\r\n\t\t\t\t\t\tpropertyHandlers = prototype._propertyHandlers = Object.create(prototype._propertyHandlers)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpropertyHandlers[propertyName] = true // TODO: is it better to implement this with property handlers?\r\n\t\t\t\t\tObject.defineProperty(prototype, propertyName, renderDescriptor(key))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn applyOnCreate\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tfunction renderDescriptor(renderMethod) {\r\n\t\tvar map = new lang.WeakMap()\r\n\t\treturn {\r\n\t\t\tget: function() {\r\n\t\t\t\treturn map.has(this) ? map.get(this) : null\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tmap.set(this, value)\r\n\t\t\t\tthis[renderMethod](value)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction makeElementConstructor(BaseClass) {\r\n\t\tvar isNativeElement = !BaseClass.with // TODO: Create a separate constructor for this\r\n\t\t// this is an optimization to allow consecutive alkali constructors to bypass each other\r\n\t\tif (Object.setPrototypeOf) {\r\n\t\t\twhile (BaseClass.prototype.constructor !== BaseClass && !BaseClass.hasOwnProperty('with')) {\r\n\t\t\t\tBaseClass = getPrototypeOf(BaseClass)\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar isNativeClass = Object.getOwnPropertyDescriptor(BaseClass, 'prototype').writable === false\r\n\t\treturn constructOrCall(BaseClass, isNativeElement && create, withProperties, isNativeClass)\r\n\t}\r\n\r\n\tfunction withProperties(selector, properties) {\r\n\t\tvar Element = makeElementConstructor(this)\r\n\t\tif (this.with) {\r\n\t\t\t// TODO: Might consider only doing this for derivatives of derivatives, since we don't need to inherit from base constructors\r\n\t\t\t// or only doing this in the case of element having custom properties (could mark it with a flag)\r\n\t\t\tsetPrototypeOf(Element, this)\r\n\t\t\tElement.ownedClasses = null\r\n\t\t} else {\r\n\t\t\tElement.create = create\r\n\t\t\tElement.with = withProperties\r\n\t\t\tElement.defineElement = defineElement\r\n\t\t\tElement.for = forTarget\r\n\t\t\tElement.property = propertyForElement\r\n\t\t\tElement.getForClass = getForClass\r\n\t\t}\r\n\t\tElement.prototype = this.prototype\r\n\r\n\t\tvar applyOnCreate = Element._applyOnCreate = {}\r\n\t\tvar parentApplySet = getApplySet(this)\r\n\t\t// copy parent properties\r\n\t\tfor (var key in parentApplySet) {\r\n\t\t\tapplyOnCreate[key] = classHandlers[key] ? Object.create(parentApplySet[key]) : parentApplySet[key]\r\n\t\t}\r\n\r\n\t\tvar i = 0 // for arguments\r\n\t\tif (typeof selector === 'string') {\r\n\t\t\tvar selectorMatch = selector.match(SELECTOR_REGEX)\r\n\t\t\tif (selectorMatch) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tvar operator = selectorMatch[1]\r\n\t\t\t\t\tvar name = selectorMatch[2]\r\n\t\t\t\t\tif (operator == '.') {\r\n\t\t\t\t\t\tif (applyOnCreate.className) {\r\n\t\t\t\t\t\t\tapplyOnCreate.className += ' ' + name\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tapplyOnCreate.className = name\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapplyOnCreate.id = name\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar remaining = selectorMatch[3]\r\n\t\t\t\t\tselectorMatch = remaining && remaining.match(SELECTOR_REGEX)\r\n\t\t\t\t} while (selectorMatch)\r\n\t\t\t} else {\r\n\t\t\t\tapplyOnCreate.content = selector\r\n\t\t\t}\r\n\t\t\ti++ // skip the first argument\r\n\t\t}\r\n\r\n\t\tfor (var l = arguments.length; i < l; i++) {\r\n\t\t\tapplyToConstructor(arguments[i], Element)\r\n\t\t}\r\n\t\treturn Element\r\n\t}\r\n\tvar currentParent\r\n\tfunction create(selector, properties) {\r\n\t\t// TODO: make this a symbol\r\n\t\tvar applyOnCreate = getApplySet(this)\r\n\t\tif (currentParent) {\r\n\t\t\tvar parent = currentParent\r\n\t\t\tcurrentParent = null\r\n\t\t}\r\n/*\t\tif (this._initialized != this) {\r\n\t\t\tthis._initialized = this\r\n\t\t\tthis.initialize && this.initialize()\r\n\t\t\tvar styles = this.styles\r\n\t\t\tif (styles) {\r\n\t\t\t\tvar rule = createCssRule(getUniqueSelector(this))\r\n\t\t\t\tfor (var i = 0, l = styles.length; i < l; i++) {\r\n\t\t\t\t\tvar key = styles[i]\r\n\t\t\t\t\tvar value = styles[key]\r\n\t\t\t\t\t// TODO: if it is a contextualized variable, do this on the element\r\n\t\t\t\t\tvar styleDefinition = styleDefinitions[key]\r\n\t\t\t\t\tif (styleDefinition) {\r\n\t\t\t\t\t\tstyleDefinition(rule, value, key)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!this.hasOwnProperty('_applyOnCreate')) {\r\n\t\t\t\tapplyOnCreate = getApplySet(this)\r\n\t\t\t}\r\n\t\t}*/\r\n\t\tvar element = this._ElementClass ?\r\n\t\t\tconstruct(this._BaseElementClass || HTMLElement, arguments, this._ElementClass) : // does HTMLElement differ from any other constructors?\r\n\t\t\tdoc.createElement(this.tagName)\r\n\t\tif (selector && selector.parent) {\r\n\t\t\tparent = selector.parent\r\n\t\t}\r\n\t\tif (parent) {\r\n\t\t\tpresumptiveParentMap.set(element, parent)\r\n\t\t}\r\n\t\tif (!(element instanceof this)) {\r\n\t\t\t// ideally we want to avoid this call, as it is expensive, but for classes that\r\n\t\t\t// don't register a tag name, we have to make sure the prototype chain is correct\r\n\t\t\tsetPrototypeOf(element, this.prototype)\r\n\t\t}\r\n\t\tif (element.constructor != this) {\r\n\t\t\telement.constructor = this // need to do this for hasOwn contextualization to work\r\n\t\t}\r\n\t\tvar hasArguments = arguments.length > 0\r\n\t\tif (hasArguments || element.created || element.ready) {\r\n\t\t\t// copy applyOnCreate when we have arguments or method that accepts applyOnCreate\r\n\t\t\tvar ElementApplyOnCreate = applyOnCreate\r\n\t\t\tapplyOnCreate = {}\r\n\t\t\tfor (var key in ElementApplyOnCreate) {\r\n\t\t\t\tapplyOnCreate[key] = classHandlers[key] ? Object.create(ElementApplyOnCreate[key]) : ElementApplyOnCreate[key]\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tif (hasArguments) {\r\n\t\t\tvar i = 0\r\n\t\t\tif (typeof selector == 'string') {\r\n\t\t\t\ti++\r\n\t\t\t\tvar selectorMatch = selector.match(SELECTOR_REGEX)\r\n\t\t\t\tif (selectorMatch) {\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tvar operator = selectorMatch[1]\r\n\t\t\t\t\t\tvar name = selectorMatch[2]\r\n\t\t\t\t\t\tif (operator == '.') {\r\n\t\t\t\t\t\t\tif (applyOnCreate.className) {\r\n\t\t\t\t\t\t\t\tapplyOnCreate.className += ' ' + name\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (element.className) {\r\n\t\t\t\t\t\t\t\t\t\telement.className += ' ' + name\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\telement.className = name\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (applyOnCreate.id) {\r\n\t\t\t\t\t\t\t\tapplyOnCreate.id = name\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// just skip right to the element\r\n\t\t\t\t\t\t\t\telement.id = name\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar remaining = selectorMatch[3]\r\n\t\t\t\t\t\tselectorMatch = remaining && remaining.match(SELECTOR_REGEX)\r\n\t\t\t\t\t} while (selectorMatch)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tapplyOnCreate.content = selector\r\n\t\t\t\t}\r\n\t\t\t} else if (selector && selector._item) {\r\n\t\t\t\t// this is kind of hack, to get the Item available before the properties, eventually we may want to\r\n\t\t\t\t// order static properties before variable binding applications, but for now.\r\n\t\t\t\telement._item = selector._item\r\n\t\t\t}\r\n\t\t\tfor (var l = arguments.length; i < l; i++) {\r\n\t\t\t\tvar argument = arguments[i]\r\n\t\t\t\tif (argument && typeof argument === 'object') {\r\n\t\t\t\t\tif (argument instanceof Array || argument.notifies) {\r\n\t\t\t\t\t\tapplyOnCreate.content = argument\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (var key in argument) {\r\n\t\t\t\t\t\t\tif (classHandlers[key]) {\r\n\t\t\t\t\t\t\t\tclassHandlers[key](this, argument[key], key, applyOnCreate)\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tapplyOnCreate[key] = argument[key]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (typeof argument === 'function' && argument.for) {\r\n\t\t\t\t\tapplyOnCreate.content = argument.for(element)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tapplyOnCreate.content = argument\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (element.created) {\r\n\t\t\tapplyOnCreate = element.created(applyOnCreate) || applyOnCreate\r\n\t\t} else if (applyOnCreate.created) {\r\n\t\t\tapplyOnCreate = applyOnCreate.created.call(element, applyOnCreate) || applyOnCreate\r\n\t\t}\r\n\t\t// TODO: inline this for better performance, possibly\r\n\t\tassignProperties(element, applyOnCreate)\r\n\r\n\t\tif (applyOnCreate._generators) {\r\n\t\t\tassignGenerators(element, applyOnCreate)\r\n\t\t}\r\n\r\n\t\tif (this.children) {\r\n\t\t\tlayoutChildren(element, this.children, element)\r\n\t\t}\r\n\t\tif (this.shadow) {\r\n\t\t\tlayoutChildren(element.attachShadow({mode: 'open'}), this.shadow, element)\r\n\t\t}\r\n\t\t// always do this last, so it can be properly inserted inside the children\r\n\t\tif (element.content != null) {\r\n\t\t\tbuildContent(element, element.content, 'content', applyOnCreate)\r\n\t\t}\r\n\t\telement.ready && element.ready(applyOnCreate)\r\n\t\treturn element\r\n\t}\r\n\r\n\tvar slice = [].slice\r\n\tfunction append(parent){\r\n\t\treturn this.nodeType ?\r\n\t\t\tlayoutChildren(this, arguments, this) : // called as a method\r\n\t\t\tlayoutChildren(parent, slice.call(arguments, 1), parent) // called as a function\r\n\t}\r\n\r\n\tfunction prepend(parent){\r\n\t\treturn this.nodeType ?\r\n\t\t\tlayoutChildren(this, arguments, this, true) : // called as a method\r\n\t\t\tlayoutChildren(parent, slice.call(arguments, 1), parent, true) // called as a function\r\n\t}\r\n\r\n\tfunction defineElement(tagSelector, Element) {\r\n\t\tif (!Element) {\r\n\t\t\tif (typeof tagSelector === 'string') {\r\n\t\t\t\t// allow calling as target\r\n\t\t\t\tElement = this\r\n\t\t\t} else {\r\n\t\t\t\t// allow optional first param\r\n\t\t\t\treturn tagSelector.with()\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar extendElement = Element.nativeTagName === undefined ? Element.tagName : Element.nativeTagName\r\n\t\tvar selector = tagSelector.match(/[\\.\\#].+/)\r\n\t\tvar tagName = selector ? tagSelector.slice(0, tagSelector.length - (selector = selector[0]).length) : tagSelector\r\n\t\tif (!extendElement) {\r\n\t\t\tElement.tagName = tagName\r\n\t\t}\r\n\t\tElement.nativeTagName = extendElement || null // regardless of subclassing, want to preserve the original native tag name\r\n\r\n\t\tif (typeof customElements === 'object') {\r\n\t\t\tif (canExtendBuiltinElements === undefined) {\r\n\t\t\t\tvar TestSupport = function() {}\r\n\t\t\t\tcustomElements.define('alkali-test-support', TestSupport, { extends: 'div' })\r\n\t\t\t\tcanExtendBuiltinElements = false\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconstruct(HTMLDivElement, [], TestSupport)\r\n\t\t\t\t\tcanExtendBuiltinElements = true\r\n\t\t\t\t} catch (error) {}\r\n\t\t\t}\r\n\t\t\tif (!extendElement || canExtendBuiltinElements) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (Element._ElementClass = customElements.get(tagName)) {\r\n\t\t\t\t\t\tconsole.warn('Element', tagName, 'already registered')\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcustomElements.define(tagName, Element, { extends: extendElement })\r\n\t\t\t\t\t\tElement._ElementClass = Element\r\n\t\t\t\t\t\tif (extendElement)\r\n\t\t\t\t\t\t\tElement._BaseElementClass = customElements.get(extendElement) || doc.createElement(extendElement).constructor\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(error) {\r\n\t\t\t\t\tconsole.warn(error)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Element.with) {\r\n\t\t\tElement.with = withProperties\r\n\t\t}\r\n\t\treturn bindElementClass(Element, {\r\n\t\t\tselector: selector,\r\n\t\t\tuniqueTag: true\r\n\t\t})\r\n\t}\r\n\r\n\tvar Element = setupElement(typeof HTMLElement !== 'undefined' ? HTMLElement : function() {})\r\n\r\n\tElement.defineElement = defineElement\r\n\tElement.assign = function(target, properties) {\r\n\t\tif (typeof target === 'function') {\r\n\t\t\t// assign properties to an existing constructor/class\r\n\t\t\tgetApplySet(target) // make sure we have our own applyOnCreate first\r\n\t\t\tapplyToConstructor(properties, target)\r\n\t\t} else {\r\n\t\t\t// assign to an element\r\n\t\t\t// TODO: Handle content property separately\r\n\t\t\tvar renderers = target.alkaliRenderers\r\n\t\t\tvar startingRenderers = renderers ? renderers.length : 0\r\n\t\t\tassignProperties(target, properties)\r\n\t\t\tvar endingRenderers = renderers ? renderers.length : 0\r\n\t\t\t// look for duplicate renderers so overriden renderers can be stopped and removed\r\n\t\t\tfor (var newIndex = startingRenderers; newIndex < endingRenderers; newIndex++) {\r\n\t\t\t\tfor (var oldIndex = 0; oldIndex < startingRenderers; oldIndex++) {\r\n\t\t\t\t\tif (renderers[oldIndex].isSameProperty(renderers[newIndex])) {\r\n\t\t\t\t\t\trenderers[oldIndex].stop()\r\n\t\t\t\t\t\trenderers.splice(oldIndex, 1)\r\n\t\t\t\t\t\t// adjust the indices\r\n\t\t\t\t\t\toldIndex = -1\r\n\t\t\t\t\t\tstartingRenderers--\r\n\t\t\t\t\t\tendingRenderers--\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tElement.within = function(element){\r\n\t\t// find closest child\r\n\t}\r\n\r\n\tgenerate([\r\n\t\t'Video',\r\n\t\t'Source',\r\n\t\t'Media',\r\n\t\t'Audio',\r\n\t\t'UL',\r\n\t\t'U',\r\n\t\t'Track',\r\n\t\t'Title',\r\n\t\t'TextArea',\r\n\t\t'Template',\r\n\t\t'TBody',\r\n\t\t'THead',\r\n\t\t'TFoot',\r\n\t\t'TR',\r\n\t\t'Table',\r\n\t\t'Col',\r\n\t\t'ColGroup',\r\n\t\t'TH',\r\n\t\t'TD',\r\n\t\t'Caption',\r\n\t\t'Sup',\r\n\t\t'Sub',\r\n\t\t'Style',\r\n\t\t'Strong',\r\n\t\t'Span',\r\n\t\t'Small',\r\n\t\t'Shadow',\r\n\t\t'Select',\r\n\t\t'Script',\r\n\t\t'S',\r\n\t\t'Quote',\r\n\t\t'Progress',\r\n\t\t'Pre',\r\n\t\t'Picture',\r\n\t\t'Param',\r\n\t\t'P',\r\n\t\t'Output',\r\n\t\t'Option',\r\n\t\t'Optgroup',\r\n\t\t'Object',\r\n\t\t'OL',\r\n\t\t'Ins',\r\n\t\t'I',\r\n\t\t'Del',\r\n\t\t'Meter',\r\n\t\t'Meta',\r\n\t\t'Menu',\r\n\t\t'Map',\r\n\t\t'Link',\r\n\t\t'Legend',\r\n\t\t'Label',\r\n\t\t'LI',\r\n\t\t'KeyGen',\r\n\t\t'Input',\r\n\t\t'Img',\r\n\t\t'IFrame',\r\n\t\t'H1',\r\n\t\t'H2',\r\n\t\t'H3',\r\n\t\t'H4',\r\n\t\t'H5',\r\n\t\t'H6',\r\n\t\t'Hr',\r\n\t\t'FrameSet',\r\n\t\t'Frame',\r\n\t\t'Form',\r\n\t\t'Font',\r\n\t\t'FieldSet',\r\n\t\t'Embed',\r\n\t\t'Em',\r\n\t\t'Code',\r\n\t\t'Cite',\r\n\t\t'Dfn',\r\n\t\t'B',\r\n\t\t'Article',\r\n\t\t'Aside',\r\n\t\t'Abbr',\r\n\t\t'Footer',\r\n\t\t'Figure',\r\n\t\t'FigCaption',\r\n\t\t'Header',\r\n\t\t'Main',\r\n\t\t'Mark',\r\n\t\t'MenuItem',\r\n\t\t'Nav',\r\n\t\t'Section',\r\n\t\t'Slot',\r\n\t\t'Summary',\r\n\t\t'WBr',\r\n\t\t'Div',\r\n\t\t'Dialog',\r\n\t\t'Details',\r\n\t\t'DataList',\r\n\t\t'DL',\r\n\t\t'DT',\r\n\t\t'DD',\r\n\t\t'Canvas',\r\n\t\t'Button',\r\n\t\t'Base',\r\n\t\t'Br',\r\n\t\t'Area',\r\n\t\t'A'\r\n\t])\r\n\tgenerateInputs([\r\n\t\t'Checkbox',\r\n\t\t'Password',\r\n\t\t'Submit',\r\n\t\t'Radio',\r\n\t\t'Color',\r\n\t\t'Date',\r\n\t\t'DateTime',\r\n\t\t'Email',\r\n\t\t'Month',\r\n\t\t'Number',\r\n\t\t'Range',\r\n\t\t'Search',\r\n\t\t'Tel',\r\n\t\t'Time',\r\n\t\t'Url',\r\n\t\t'Week'])\r\n\r\n\tvar tags = {}\r\n\tfunction getConstructor(tagName) {\r\n\t\ttagName = tagName.toLowerCase()\r\n\t\treturn tags[tagName] ||\r\n\t\t\t(tags[tagName] =\r\n\t\t\t\tsetupElement(doc.createElement(tagName).constructor, tagName))\r\n\t}\r\n\r\n\tfunction setupElement(HTMLConstructor, tagName, type) {\r\n\t\tif (buggyConstructorSetter) {\r\n\t\t\t// fix safari's broken constructor property\r\n\t\t\tObject.defineProperty(HTMLConstructor.prototype, 'constructor', {\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn this._constructor\r\n\t\t\t\t},\r\n\t\t\t\tset: function(constructor) {\r\n\t\t\t\t\tthis._constructor = constructor\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tHTMLConstructor.prototype._constructor = HTMLConstructor\r\n\t\t}\r\n\t\tvar Element = type ?\r\n\t\t\twithProperties.call(HTMLConstructor, { type: type }) :\r\n\t\t\twithProperties.call(HTMLConstructor)\r\n\t\tvar props = elementPropertyHandlers[tagName]\r\n\t\tif (props && !props.assigned) {\r\n\t\t\tvar handlers = Element.prototype._propertyHandlers = Object.create(propertyHandlers)\r\n\t\t\tfor (var i = 0, l = props.length; i < l; i++) {\r\n\t\t\t\thandlers[props[i]] = true\r\n\t\t\t}\r\n\t\t\tif (props.value) {\r\n\t\t\t\tfor (var i in props) {\r\n\t\t\t\t\tif (!(i > -1)) { // assign any string properties if necessary\r\n\t\t\t\t\t\thandlers[i] = props[i]\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprops.assigned = true\r\n\t\t}\r\n\t\tElement.tagName = tagName\r\n\t\t// once https://bugs.chromium.org/p/chromium/issues/detail?id=648828&desc=4 is implemented we can do:\r\n\t\t// Element._HTMLConstructor = HTMLConstructor\r\n\t\treturn Element\r\n\t}\r\n\tfunction generate(elements) {\r\n\t\telements.forEach(function(elementName) {\r\n\t\t\tvar ElementClass\r\n\t\t\tObject.defineProperty(Element, elementName, {\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn ElementClass || (ElementClass = getConstructor(elementName))\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\tfunction generateInputs(elements) {\r\n\t\telements.forEach(function(inputType) {\r\n\t\t\tvar ElementClass\r\n\t\t\tObject.defineProperty(Element, inputType, {\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\t// TODO: make all inputs extend from input generated from generate\r\n\t\t\t\t\treturn ElementClass || (ElementClass = setupElement(HTMLInputElement, 'input', inputType.toLowerCase()))\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// alias all the inputs with an Input suffix\r\n\t\t\tObject.defineProperty(Element, inputType + 'Input', {\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn this[inputType]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tvar aliases = {\r\n\t\tAnchor: 'A',\r\n\t\tImage: 'Img',\r\n\t\tParagraph: 'P',\r\n\t\tTextarea: 'TextArea',\r\n\t\tDList: 'DL',\r\n\t\tUList: 'UL',\r\n\t\tOList: 'OL',\r\n\t\tListItem: 'LI',\r\n\t\tText: 'Input',\r\n\t\tTextInput: 'Input',\r\n\t\tTableRow: 'TR',\r\n\t\tTableCell: 'TD',\r\n\t\tTableHeaderCell: 'TH',\r\n\t\tTableHeader: 'THead',\r\n\t\tTableBody: 'TBody'\r\n\t}\r\n\tfor (var alias in aliases) {\r\n\t\t(function(alias, to) {\r\n\t\t\tObject.defineProperty(Element, alias, {\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\treturn this[to]\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})(alias, aliases[alias])\r\n\t}\r\n\r\n\tElement.append = append\r\n\tRenderer.append = append // make it available to the renderer\r\n\tElement.prepend = prepend\r\n\tElement.refresh = Renderer.refresh\r\n\tElement.options = {\r\n\t\tmoveLiveElementsEnabled: true,\r\n\t}\r\n\tElement.content = function(Element){\r\n\t\t// container marker\r\n\t\tfunction Content() {\r\n\t\t\treturn new Element()\r\n\t\t}\r\n\t\tContent.isContentNode = true\r\n\t\treturn Content\r\n\t}\r\n\r\n\tElement.ElementClass = function() {}\r\n\tif (typeof Symbol !== 'undefined') {\r\n\t\t// make instanceof work for Element\r\n\t\tObject.defineProperty(Element.ElementClass, Symbol.hasInstance, { value: function(target) {\r\n\t\t\treturn target && (target.create && target.with)\r\n\t\t}})\r\n\t}\r\n\r\n\t// TODO: unify this in lang\r\n\tElement.extend = function(Class, properties) {\r\n\t\tfunction ExtendedElement() {\r\n\t\t\treturn Class.apply(this, arguments)\r\n\t\t}\r\n\t\tsetPrototypeOf(ExtendedElement, Class)\r\n\t\tvar prototype = ExtendedElement.prototype = Object.create(Class.prototype, {\r\n\t\t\tconstructor: { value: ExtendedElement }\r\n\t\t})\r\n\t\tObject.getOwnPropertyNames(properties).forEach(function(key) {\r\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(properties, key)\r\n\t\t\tif (classHandlers[key]) {\r\n\t\t\t\tclassHandlers[key](ExtendedElement, descriptor.value, key, properties)\r\n\t\t\t} else {\r\n\t\t\t\tObject.defineProperty(prototype, key, descriptor)\r\n\t\t\t}\r\n\t\t})\r\n\t\treturn ExtendedElement\r\n\t}\r\n\r\n\tfunction makePreBoundVariable(variable) {\r\n\t\t// once the variable has been bound for the whole collection, we don't want to\r\n\t\t// create a listener for each instance\r\n\t\treturn {\r\n\t\t\tvariable: variable,\r\n\t\t\tthen: function(callback, errorHandler) {\r\n\t\t\t\treturn this.variable.then(callback, errorHandler)\r\n\t\t\t},\r\n\t\t\tnotifies: function() {}, // noop in this case\r\n\t\t\tstopNotifies: function() {}\r\n\t\t}\r\n\t}\r\n\r\n\tElement.bindElementClass = bindElementClass\r\n\tfunction bindElementClass(Element, options) {\r\n\t\toptions = options || {}\r\n\t\tvar applyOnCreate = getApplySet(Element)\r\n\t\tvar preBoundProperties = {}\r\n\t\tvar propertyHandlers = Element.prototype._propertyHandlers\r\n\t\tvar cssRule\r\n\t\tfor (var key in applyOnCreate) {\r\n\t\t\tvar value = applyOnCreate[key]\r\n\t\t\tif (value && value.notifies && propertyHandlers[key] === true) {\r\n\t\t\t\tnew PropertyRenderer({\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvariable: value.collection || value,\r\n\t\t\t\t\tgetElements: function() {\r\n\t\t\t\t\t\tif (options.uniqueTag) {\r\n\t\t\t\t\t\t\treturn document.getElementsByTagName(BoundElement.tagName)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn getElementInstances(BoundElement, options.parent)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tpreBoundProperties[key] = makePreBoundVariable(value)\r\n\t\t\t} else if (styleDefinitions[key]) {\r\n\t\t\t\tif (value && value.notifies) {\r\n\t\t\t\t\tnew StyleRenderer({\r\n\t\t\t\t\t\tname: key,\r\n\t\t\t\t\t\tvariable: value.collection || value,\r\n\t\t\t\t\t\tgetElements: function() {\r\n\t\t\t\t\t\t\tif (options.uniqueTag) {\r\n\t\t\t\t\t\t\t\treturn document.getElementsByTagName(BoundElement.tagName)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn getElementInstances(BoundElement, options.parent)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tpreBoundProperties[key] = makePreBoundVariable(value)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcssRule = cssRule || createCssRule(options.uniqueTag ? Element.tagName :\r\n\t\t\t\t\t\t(Element.tagName + '.' + applyOnCreate.className))\r\n\t\t\t\t\tstyleDefinitions[key](cssRule, value, key)\r\n\t\t\t\t\tpreBoundProperties[key] = undefined\r\n\t\t\t\t}\r\n\t\t\t} else if (key === 'style' && value && !value.notifies) {\r\n\t\t\t\tcssRule = cssRule || createCssRule(options.uniqueTag ? Element.tagName :\r\n\t\t\t\t\t(Element.tagName + '.' + applyOnCreate.className))\r\n\t\t\t\tfor (var name in value) {\r\n\t\t\t\t\tcssRule.style[name] = value[name]\r\n\t\t\t\t}\r\n\t\t\t\tpreBoundProperties.style = undefined\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Element._cssRule && options.uniqueTag) {\r\n\t\t\t// make the inherited rule apply to this tag too\r\n\t\t\tElement._cssRule.selectorText += ',' + Element.tagName\r\n\t\t}\r\n\r\n\t\tif (Element.children) {\r\n\t\t\tvar newChildren = []\r\n\t\t\tfor (var i = 0; i < Element.children.length; i++) {\r\n\t\t\t\tvar child = Element.children[i]\r\n\t\t\t\tif (child) {\r\n\t\t\t\t\tif (child.notifies) {\r\n\t\t\t\t\t\tthrow new Error('Variables can not be used as child nodes in generalized/bound classes, consider wrapping with a span')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof child === 'function') {\r\n\t\t\t\t\t\tchild = bindElementClass(child, {\r\n\t\t\t\t\t\t\tparent: options.parent\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnewChildren[i] = child\r\n\t\t\t}\r\n\t\t\tpreBoundProperties.children = newChildren\r\n\t\t}\r\n\t\tvar content = applyOnCreate.content\r\n\t\tif (content) {\r\n\t\t\tif (content.notifies) {\r\n\t\t\t\tvar renderer = new TextRenderer({\r\n\t\t\t\t\tgetElements: function() {\r\n\t\t\t\t\t\tif (options.uniqueTag) {\r\n\t\t\t\t\t\t\treturn document.getElementsByTagName(BoundElement.tagName)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn getElementInstances(BoundElement, options.parent)\r\n\t\t\t\t\t}, // TODO: find main text node\r\n\t\t\t\t\tvariable: content.collection || content,\r\n\t\t\t\t\tposition: 0\r\n\t\t\t\t})\r\n\t\t\t\tpreBoundProperties.content = makePreBoundVariable(content)\r\n\t\t\t} else if (content instanceof Array) {\r\n\t\t\t\tpreBoundProperties.content = content.map(function(child) {\r\n\t\t\t\t\tif (child.notifies) {\r\n\t\t\t\t\t\t// TODO: Maybe we can support this with position\r\n\t\t\t\t\t\tthrow new Error('Variables can not be used as child nodes in generalized/bound classes, consider wrapping with a span')\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof child === 'function') {\r\n\t\t\t\t\t\tchild = bindElementClass(child, {\r\n\t\t\t\t\t\t\tparent: options.parent\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn child\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar BoundElement = options.selector ? Element.with(options.selector, preBoundProperties) : Element.with(preBoundProperties)\r\n\t\tif (cssRule) {\r\n\t\t\tBoundElement._cssRule = cssRule\r\n\t\t}\r\n\t\treturn BoundElement\r\n\t}\r\n\r\n\tfunction getElementInstances(Element, parent) {\r\n\t\tvar selector = Element.tagName\r\n\t\tvar className = Element._applyOnCreate.className\r\n\t\tif (className) {\r\n\t\t\tselector += '.' + className\r\n\t\t}\r\n\t\treturn [].filter.call((parent || document).querySelectorAll(selector), function(element) {\r\n\t\t\treturn element.constructor === Element\r\n\t\t})\r\n\t}\r\n\r\n\tfunction forTarget(target) {\r\n\t\treturn target.constructor.getForClass(target, this)\r\n\t}\r\n\r\n\tfunction hasOwn(From, Target, createInstance) {\r\n\t\tif (typeof Target === 'object') {\r\n\t\t\t// we were given an actual instance, use that\r\n\t\t\tvar elementMap = From.ownedClasses || (From.ownedClasses = new lang.WeakMap())\r\n\t\t\tvar instanceMap = {get: function () {\r\n\t\t\t\treturn Target\r\n\t\t\t}}\r\n\t\t\telementMap.set(Target.constructor, instanceMap)\r\n\t\t\treturn hasOwn(From, Target.Class, Target.createInstance)\r\n\t\t}\r\n\t\tif (Target instanceof Array) {\r\n\t\t\treturn Target.forEach(function(Target) {\r\n\t\t\t\thasOwn(From, Target)\r\n\t\t\t})\r\n\t\t}\r\n\t\tvar elementMap = From.ownedClasses || (From.ownedClasses = new lang.WeakMap())\r\n\t\t// TODO: Go up through prototype chain of Target and set each one\r\n\t\tif (!elementMap.has(Target)) {\r\n\t\t\tvar instanceMap = new lang.WeakMap()\r\n\t\t\tinstanceMap.createInstance = createInstance\r\n\t\t\telementMap.set(Target, instanceMap)\r\n\t\t}\r\n\t\treturn From\r\n\t}\r\n\r\n\tfunction getForClass(element, Target) {\r\n\t\tvar createInstance\r\n\t\twhile (element && !(createInstance = element.constructor.ownedClasses && element.constructor.ownedClasses.get(Target))) {\r\n\t\t\telement = element.parentNode || presumptiveParentMap.get(element)\r\n\t\t}\r\n\t\tif (createInstance) {\r\n\t\t\tvar ownedInstances = element.ownedInstances || (element.ownedInstances = new lang.WeakMap())\r\n\t\t\tvar instance = ownedInstances.get(Target)\r\n\t\t\tif (instance === undefined) {\r\n\t\t\t\townedInstances.set(Target, instance = createInstance(element))\r\n\t\t\t\tinstance.subject = element\r\n\t\t\t}\r\n\t\t\treturn instance\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setForClass(element, Target, instance) {\r\n\t\tvar From = element.constructor\r\n\t\tvar ownedClasses = From.ownedClasses || (From.ownedClasses = new lang.WeakMap())\r\n\t\tvar instanceMap = ownedClasses.get(Target)\r\n\t\tif (!instanceMap) {\r\n\t\t\townedClasses.set(Target, instanceMap = new lang.WeakMap())\r\n\t\t}\r\n\t\tvar ownedInstances = element.ownedInstances || (element.ownedInstances = new lang.WeakMap())\r\n\t\townedInstances.set(Target, instance)\r\n\t\tinstanceMap.set(element, instance)\r\n\t}\r\n\r\n\tfunction propertyForElement(key) {\r\n\t\t// we just need to establish one Variable class for each element, so we cache it\r\n\t\tThisElementVariable = this._Variable\r\n\t\tif (!ThisElementVariable) {\r\n\t\t\t// need our own branded variable class for this element class\r\n\t\t\tThisElementVariable = this._Variable = Variable()\r\n\r\n\t\t\thasOwn(this, ThisElementVariable, function(element) {\r\n\t\t\t\t// TODO: we might want to do this in init instead\r\n\t\t\t\tvar elementOverlay\r\n\t\t\t\tif (element.alkaliRenderers) {\r\n\t\t\t\t\tvar variableProperties = {}\r\n\t\t\t\t\tfor (var i = 0; i < element.alkaliRenderers.length; i++){\r\n\t\t\t\t\t\tvar renderer = element.alkaliRenderers[i]\r\n\t\t\t\t\t\tif (renderer.name) {\r\n\t\t\t\t\t\t\tvariableProperties[renderer.name] = {value: renderer.variable}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telementOverlay = Object.create(element, variableProperties)\r\n\t\t\t\t} else {\r\n\t\t\t\t\telementOverlay = element\r\n\t\t\t\t}\r\n\t\t\t\tvar instance = new ThisElementVariable(elementOverlay)\r\n\t\t\t\t// we are not observing, because you can't delegate getters and setters in safari\r\n\t\t\t\t// instance.observeObject()\r\n\t\t\t\treturn instance\r\n\t\t\t})\r\n\t\t}\r\n\t\t// now actually get the property class\r\n\t\treturn ThisElementVariable.property(key)\r\n\t}\r\n\r\n\tvar Item = Element.Item = VariableExports.Item\r\n\r\n\tfunction enterRenderer(Renderer, options/*, target*/) {\r\n\t\t// this will be used for optimized class-level variables\r\n\t\t/*if (target.started) { // TODO: Might want to pass in started as a parameter\r\n\t\t\t// this means that the renderer has already been created, so we just need to add this instance\r\n\t\t\tRenderer.prototype.renderUpdate.call(options, element)\r\n\t\t} else {*/\r\n\t\tnew Renderer(options)\r\n\t\t//}\r\n\t}\r\n\r\n\tfunction cleanup(target) {\r\n\t\tvar renderers = target.alkaliRenderers\r\n\t\tif (renderers) {\r\n\t\t\tfor (var i = 0, l = renderers.length; i < l; i++) {\r\n\t\t\t\trenderers[i].stop()\r\n\t\t\t}\r\n\t\t\ttarget.needsRestart = true\r\n\t\t}\r\n\t}\r\n\tfunction restart(target) {\r\n\t\tvar renderers = target.alkaliRenderers\r\n\t\tif (renderers) {\r\n\t\t\tfor (var i = 0, l = renderers.length; i < l; i++) {\r\n\t\t\t\trenderers[i].restart()\r\n\t\t\t}\r\n\t\t}\r\n\t\ttarget.needsRestart = false\r\n\t}\r\n\t// setup the mutation observer so we can be notified of attachments and removals\r\n\tfunction elementAttached(element) {\r\n\t\tvar Class = element.constructor\r\n\t\tif (Class.create) {\r\n/*\t\t\tif (Class.attachedInstances) {\r\n\t\t\t\tClass.attachedInstances.push(element)\r\n\t\t\t\tif (Class.attachedInstances.length === 1 && Class.needsRestart) {\r\n\t\t\t\t\trestart(Class)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tClass.attachedInstances = [element]\r\n\t\t\t}*/\r\n\t\t\tif (element.needsRestart) {\r\n\t\t\t\trestart(element)\r\n\t\t\t}\r\n\t\t\tif (element.attached) {\r\n\t\t\t\telement.attached()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction elementDetached(element) {\r\n\t\t/*var attachedInstances = element.constructor.attachedInstances\r\n\t\tif (attachedInstances) {\r\n\t\t\tvar index = attachedInstances.indexOf(element)\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tattachedInstances.splice(index, 1)\r\n\t\t\t\tif (attachedInstances.length === 0) {\r\n\t\t\t\t\tcleanup(Class)\r\n\t\t\t\t}\r\n\t\t\t}*/\r\n\t\t\tif (element.detached) {\r\n\t\t\t\telement.detached()\r\n\t\t\t}\r\n\t\t\tcleanup(element)\r\n\t\t//}\r\n\t}\r\n\tvar lifeStates = [{\r\n\t\tname: 'detached',\r\n\t\tnodes: 'removedNodes',\r\n\t\taction: elementDetached\r\n\t}, {\r\n\t\tname: 'attached',\r\n\t\tnodes: 'addedNodes',\r\n\t\taction: elementAttached\r\n\t}]\r\n\tfunction firstVisit(node, state) {\r\n\t\tif (state.name === 'attached') {\r\n\t\t\tif (node.__alkaliAttached__) {\r\n\t\t\t\treturn false\r\n\t\t\t} else {\r\n\t\t\t\tnode.__alkaliAttached__ = true\r\n\t\t\t\tstate.action(node)\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t} else if (node.__alkaliAttached__) {\r\n\t\t\tif (doc.body.contains(node)) {\r\n\t\t\t\t// detached event, but it is actually still attached (will get attached in a later mutation record)\r\n\t\t\t\t// so don't get through the detached/attached lifecycle\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\tnode.__alkaliAttached__ = false\r\n\t\t\tstate.action(node)\r\n\t\t}\r\n\t\treturn true\r\n\t}\r\n\tif (typeof MutationObserver === 'function') {\r\n\t\tvar observer = new MutationObserver(function(mutations) {\r\n\t\t\tfor (var i = 0, il = mutations.length; i < il; i++) {\r\n\t\t\t\tvar mutation = mutations[i]\r\n\t\t\t\t// invoke action on element if we haven't already\r\n\t\t\t\tactionIteration:\r\n\t\t\t\tfor (var j = 0, jl = lifeStates.length; j < jl; j++) { // two steps, removed nodes and added nodes\r\n\t\t\t\t\tvar state = lifeStates[j]\r\n\t\t\t\t\tvar nodes = mutation[state.nodes]\r\n\t\t\t\t\t// iterate over node list\r\n\t\t\t\t\tnodeIteration:\r\n\t\t\t\t\tfor (var k = 0, kl = nodes.length; k < kl; k++) {\r\n\t\t\t\t\t\tvar baseNode = nodes[k]\r\n\t\t\t\t\t\tif (firstVisit(baseNode, state)) {\r\n\t\t\t\t\t\t\t// start traversal with child, if it exists\r\n\t\t\t\t\t\t\tvar currentNode = baseNode.firstChild\r\n\t\t\t\t\t\t\tif (currentNode) {\r\n\t\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t\tvar nextNode\r\n\t\t\t\t\t\t\t\t\tif (currentNode.nodeType === 1 && firstVisit(currentNode, state)) {\r\n\t\t\t\t\t\t\t\t\t\t// depth-first search\r\n\t\t\t\t\t\t\t\t\t\tnextNode = currentNode.firstChild\r\n\t\t\t\t\t\t\t\t\t\tif (!nextNode) {\r\n\t\t\t\t\t\t\t\t\t\t\tnextNode = currentNode.nextSibling\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tnextNode = currentNode.nextSibling\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (!nextNode) {\r\n\t\t\t\t\t\t\t\t\t\t// come back out to parents\r\n\t\t\t\t\t\t\t\t\t\t// TODO: try keeping a stack to make this faster\r\n\t\t\t\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\t\t\t\tcurrentNode = currentNode.parentNode\r\n\t\t\t\t\t\t\t\t\t\t\tif (currentNode === baseNode) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tcontinue nodeIteration\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} while (!(nextNode = currentNode.nextSibling))\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tcurrentNode = nextNode\r\n\t\t\t\t\t\t\t\t} while (true)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if (options.moveLiveElementsEnabled) {\r\n\t\t\t\t\t\t// TODO: any options that we can really do here?\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t\tobserver.observe(doc.body || doc, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true\r\n\t\t})\r\n\t} else if (typeof document !== 'undefined') {\r\n\t\t// polling for ancient IE browsers\r\n\t\tsetInterval(function() {\r\n\t\t\tvar all = document.all\r\n\t\t\tvar state = lifeStates[1]\r\n\t\t\tfor (var i = 0, l = all.length; i < l; i++) {\r\n\t\t\t\tfirstVisit(all[i], state)\r\n\t\t\t}\r\n\t\t}, 300)\r\n\t}\r\n\r\n\tlang.copy(VariableExports.Context.prototype, {\r\n\t\tspecify: function(Variable) {\r\n\t\t\tvar element = this.subject\r\n\t\t\tvar distinctive = true\r\n\t\t\t;(this.generics || (this.generics = [])).push(Variable)\r\n\t\t\twhile (element) {\r\n\t\t\t\tif (this.distinctSubject === element) {\r\n\t\t\t\t\tdistinctive = false\r\n\t\t\t\t}\r\n\t\t\t\tvar subjectMap = element.constructor.ownedClasses\r\n\t\t\t\tif (subjectMap) {\r\n\t\t\t\t\tvar instanceMap = subjectMap.get(Variable)\r\n\t\t\t\t\tif (instanceMap) {\r\n\t\t\t\t\t\tif (distinctive) {\r\n\t\t\t\t\t\t\tthis.distinctSubject = element\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tspecifiedInstance = instanceMap.get(element)\r\n\t\t\t\t\t\tif (!specifiedInstance) {\r\n\t\t\t\t\t\t\tinstanceMap.set(element, specifiedInstance = instanceMap.createInstance ?\r\n\t\t\t\t\t\t\t\tinstanceMap.createInstance(element) : new Variable())\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn specifiedInstance\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telement = element.parentNode || presumptiveParentMap.get(element)\r\n\t\t\t}\r\n\t\t\t// else if no specific context is found, return default instance\r\n\t\t\treturn Variable.defaultInstance\r\n\t\t},\r\n\r\n\t\tgetContextualized: function(variable) {\r\n\t\t\t// returns a variable that has already been contextualized\r\n\t\t\tvar element = this.subject\r\n\t\t\tif (!element) {\r\n\t\t\t\t// no element, just use the default variable\r\n\t\t\t\treturn variable\r\n\t\t\t}\r\n\t\t\tif (variable._contextMap) {\r\n\t\t\t\tdo {\r\n\t\t\t\t\tvar instance = variable._contextMap.get(element)\r\n\t\t\t\t\tif (instance && instance.context.matches(element)) {\r\n\t\t\t\t\t\treturn instance\r\n\t\t\t\t\t}\r\n\t\t\t\t} while ((element = element.parentNode || presumptiveParentMap.get(element)))\r\n\t\t\t}\r\n\t\t\tif (variable.context && variable.context.matches(this.subject)) {\r\n\t\t\t\t// check if the default variable is allowed\r\n\t\t\t\treturn variable\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tmerge: function(childContext) {\r\n\t\t\tif (!this.distinctSubject ||\r\n\t\t\t\t\t(this.distinctSubject !== childContext.distinctSubject && this.distinctSubject.contains(childContext.distinctSubject))) {\r\n\t\t\t\tthis.distinctSubject = childContext.distinctSubject\r\n\t\t\t}\r\n\t\t\t[].push.apply(this.generics || (this.generics = []), childContext.generics)\r\n\t\t},\r\n\t\tgetDistinctElement: function(Variable, element) {\r\n\t\t\tdo {\r\n\t\t\t\tvar subjectMap = element.constructor.ownedClasses\r\n\t\t\t\tif (subjectMap) {\r\n\t\t\t\t\tvar instanceMap = subjectMap.get(Variable)\r\n\t\t\t\t\tif (instanceMap && instanceMap.has(element)) {\r\n\t\t\t\t\t\treturn element\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} while ((element = element.parentNode || presumptiveParentMap.get(element)))\r\n\t\t},\r\n\t\tmatches: function(element) {\r\n\t\t\tvar generics = this.generics\r\n\t\t\tif (generics) {\r\n\t\t\t\tfor (var i = 0, l = generics.length; i < l; i++) {\r\n\t\t\t\t\tif (this.getDistinctElement(generics[i], element) !== this.distinctSubject) {\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t}\r\n\t})\r\n\r\n\treturn Element\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./util/lang', './operators', './Variable'], factory) } else if (typeof module === 'object' && module.exports) {\r\n\tmodule.exports = factory(require('./util/lang'), require('./operators'), require('./Variable')) // Node\r\n}}(this, function (lang, operators, VariableExports) {\r\n\r\n\tvar Transform = VariableExports.Transform\r\n\tvar Variable = VariableExports.Variable\r\n\tvar changeValue = VariableExports._changeValue\r\n\tvar VArray = VariableExports.VArray\r\n\tvar isGenerator = lang.isGenerator\r\n\tvar ObjectTransform = lang.compose(Transform, function ObjectTransform(source, transform, sources) {\r\n\t\tthis.sources = sources\r\n\t\tTransform.apply(this, arguments)\r\n\t}, {\r\n\t\t_getAsObject: function() {\r\n\t\t\treturn this.transform.apply(this, preserveObjects(this.sources))\r\n\t\t}\r\n\t})\r\n\tfunction preserveObjects(sources) {\r\n\t\tfor (var i = 0, l = sources.length; i < l; i++) {\r\n\t\t\tvar source = sources[i]\r\n\t\t\tif (source && source._getAsObject) {\r\n\t\t\t\tsources[i] = source._getAsObject()\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sources\r\n\t}\r\n\r\n\tvar typeMappings = new Map()\r\n\ttypeMappings.set('string', VariableExports.VString)\r\n\ttypeMappings.set('number', VariableExports.VNumber)\r\n\ttypeMappings.set('boolean', VariableExports.VBoolean)\r\n\ttypeMappings.set('undefined', Variable)\r\n\ttypeMappings.set(null, Variable)\r\n\ttypeMappings.set(Array, VArray)\r\n\ttypeMappings.set(Map, VariableExports.VMap)\r\n\ttypeMappings.set(Set, VariableExports.VSet)\r\n\tfunction reactive(value) {\r\n\t\treturn fromValue(value)\r\n\t}\r\n\tVariableExports.reactive = reactive\r\n\tfunction fromValue(value, isProperty, deferObject) {\r\n\r\n\t\t// get the type for primitives or known constructors (or null)\r\n\t\tvar Type = typeMappings.get(typeof value) || typeMappings.get(value && value.constructor) || value instanceof Variable && !(value instanceof Transform) && value.constructor\r\n\t\tif (Type) {\r\n\t\t\treturn new Type(isProperty ? undefined : value)\r\n\t\t}\r\n\t\tif (deferObject) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// an object\r\n\t\tvar objectVar\r\n\t\tif (isProperty) {\r\n\t\t\tobjectVar = new Variable()\r\n\t\t} else {\r\n\t\t\tobjectVar = new Variable(value)\r\n\t\t\tif (value && typeof value == 'object') {\r\n\t\t\t\t// by default, if given an object (or variable or array), treat it as fixed\r\n\t\t\t\tobjectVar.fixed = true\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (value.then) {\r\n\t\t\t// incoming promise or variable, just as a proxy\r\n\t\t\treturn objectVar\r\n\t\t}\r\n\t\tfor (var key in value) {\r\n\t\t\tif (value.hasOwnProperty(key)) {\r\n\t\t\t\tvar propertyValue = value[key]\r\n\t\t\t\tvar propertyVariable = fromValue(propertyValue, true, true)\r\n\t\t\t\tif (propertyVariable) {\r\n\t\t\t\t\tpropertyVariable.key = key\r\n\t\t\t\t\tpropertyVariable.parent = objectVar\r\n\t\t\t\t\tif (objectVar[key] === undefined) {\r\n\t\t\t\t\t\tobjectVar[key] = propertyVariable\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t(objectVar._properties || (objectVar._properties = {}))[key] = propertyVariable\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// deferred, use getter/setter\r\n\t\t\t\t\tdefineValueProperty(objectVar, key, value)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn objectVar\r\n\t}\r\n\r\n\r\n\tfunction defineValueProperty(target, key, object) {\r\n\t\tvar Type\r\n\t\tObject.defineProperty(target, key, {\r\n\t\t\tget: function() {\r\n\t\t\t\treturn reactive.get(this, key, function() { return fromValue(object[key], true) })\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\treactive.set(this, key, value)\r\n\t\t\t},\r\n\t\t\tenumerable: true\r\n\t\t})\r\n\t}\r\n\tlang.copy(reactive, {\r\n\t\tfrom: function(value, options) {\r\n\t\t\tif (value && value.property) {\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t\tif (typeof value === 'function' && isGenerator(value)) {\r\n\t\t\t\treturn VariableExports.react(value, options)\r\n\t\t\t}\r\n\t\t\treturn Variable.from(value)\r\n\t\t},\r\n\t\tgetp: function(object, property) {\r\n\t\t\tif (object) {\r\n\t\t\t\t// TODO: Use a static set of public methods/properties that can be accessed\r\n\t\t\t\tif (object.property) {\r\n\t\t\t\t\t// it is a variable already, but check to see if we are using a method/property directly on the variable\r\n\t\t\t\t\tvar directPropertyValue = object[property]\r\n\t\t\t\t\treturn directPropertyValue !== undefined ? directPropertyValue : object.property(property)\r\n\t\t\t\t}\r\n\t\t\t\treturn object[property]\r\n\t\t\t}\r\n\t\t\t// not even truthy, return undefined\r\n\t\t},\r\n\t\tget: function(target, key, Type) { // for TS/Babel decorators\r\n\t\t\tvar property = (target._properties || (target._properties = {}))[key]\r\n\t\t\tif (!property) {\r\n\t\t\t\ttarget._properties[key] = property = new (getType(Type))()\r\n\t\t\t\tif (target.getValue) {\r\n\t\t\t\t\tproperty.key = key\r\n\t\t\t\t\tproperty.parent = target\r\n\t\t\t\t\tif (property.listeners) {\r\n\t\t\t\t\t\t// if it already has listeners, need to reinit it with the parent\r\n\t\t\t\t\t\tproperty.init()\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn property\r\n\t\t},\r\n\t\tset: function(target, key, value) {\r\n\t\t\tvar property = target[key]\r\n\t\t\tproperty.parent ? changeValue(property, 3, value) : property.put(value)\r\n\t\t},\r\n\t\tprop: function(Type) {\r\n\t\t\treturn function(prototype, key) {\r\n\t\t\t\tdefineProperty(prototype, key, Type)\r\n\t\t\t}\r\n\t\t},\r\n\t\tcond: function(test, consequent, alternate) {\r\n\t\t\treturn operators.if(test, operators.choose(consequent, alternate))\r\n\t\t},\r\n\t\tfcall: function(target, args) {\r\n\t\t\tif (target.property && typeof target === 'function') {\r\n\t\t\t\treturn target.apply(null, preserveObjects(args))\r\n\t\t\t}\r\n\t\t\treturn new Transform(args[0], target, args)\r\n\t\t},\r\n\t\tmcall: function(target, key, args) {\r\n\t\t\tvar method = target[key]\r\n\t\t\tif (typeof method === 'function' && method.property || key === 'bind') {\r\n\t\t\t\t// for now we check to see if looks like it could handle a variable, or is a bind call\r\n\t\t\t\treturn method.apply(target, preserveObjects(args))\r\n\t\t\t}\r\n\t\t\treturn new Transform(args[0], target[key].bind(target), args)\r\n\t\t},\r\n\t\tncall: function(target, args) {\r\n\t\t\tif (target.property && typeof target === 'function') {\r\n\t\t\t\treturn new (target.bind.apply(target, [null].concat(preserveObjects(args))))()\r\n\t\t\t}\r\n\t\t\treturn new Transform(args[0], function() {\r\n\t\t\t\treturn new (target.bind.apply(target, [null].concat(arguments)))()\r\n\t\t\t}, args)\r\n\t\t},\r\n\r\n\t\tobj: function(sources) {\r\n\t\t\treturn sources\r\n\t\t\t//return new ObjectTransform(sources[0], transform, sources)\r\n\t\t},\r\n\r\n\t\tval: function(value) {\r\n\t\t\treturn value && value.valueOf()\r\n\t\t},\r\n\t\tcls: function(definitions) {\r\n\t\t\treactive = this // TODO: clean this up\r\n\t\t\treturn function(Class) {\r\n\t\t\t\tvar prototype = Class.prototype\r\n\t\t\t\tif (!(prototype instanceof Variable)) {\r\n\t\t\t\t\tif (Object.getPrototypeOf(prototype) == Object.prototype) {\r\n\t\t\t\t\t\tObject.setPrototypeOf(Class, Variable)\r\n\t\t\t\t\t\tObject.setPrototypeOf(prototype, Variable.prototype)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn('Unable to make class a reactive variable')\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (var key in definitions) {\r\n\t\t\t\t\tdefineProperty(prototype, key, definitions[key])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\tlang.copy(reactive, operators)\r\n\r\n\tfunction getType(Type) {\r\n\t\tif (typeMappings.has(Type)) {\r\n\t\t\treturn typeMappings.get(Type)\r\n\t\t} else if (typeof Type === 'object') {\r\n\t\t\tif (Type instanceof Array) {\r\n\t\t\t\tif (Type[0]) {\r\n\t\t\t\t\treturn VArray.of(getType(Type[0]))\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn VArray\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar typedObject = {}\r\n\t\t\tvar hasKeys\r\n\t\t\tfor (var key in Type) {\r\n\t\t\t\ttypedObject[key] = getType(Type[key])\r\n\t\t\t\thasKeys = true\r\n\t\t\t}\r\n\t\t\treturn hasKeys ? Variable.with(typedObject) : Variable\r\n\t\t}\r\n\t\treturn Type\r\n\t}\r\n\r\n\tfunction defineProperty(target, key, Type) {\r\n\t\tif (!Type) {\r\n\t\t\tconsole.warn('Invalid type specified for', target && target.constructor.name, 'property', key, '(ensure you are using a concrete type, not an interface)')\r\n\t\t} else if (!Type.notifies) {\r\n\t\t\tType = getType(Type) || Variable\r\n\t\t}\r\n\t\tObject.defineProperty(target, key, {\r\n\t\t\tget: function() {\r\n\t\t\t\treturn reactive.get(this, key, Type)\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\treactive.set(this, key, value)\r\n\t\t\t},\r\n\t\t\tenumerable: true\r\n\t\t})\r\n\t}\r\n\r\n\treturn reactive\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./util/lang', './Variable'], factory) } else if (typeof module === 'object' && module.exports) {\r\n  module.exports = factory(require('./util/lang'), require('./Variable')) // Node\r\n}}(this, function (lang, VariableExports) {\r\n\tvar Variable = VariableExports.Variable\r\n\r\n\tfunction deepCopy(source, target, derivativeMap) {\r\n\t\tif (source && typeof source == 'object') {\r\n\t\t\tif (source instanceof Array) {\r\n\t\t\t\ttarget = [] // always create a new array for array targets\r\n\t\t\t\tfor(var i = 0, l = source.length; i < l; i++) {\r\n\t\t\t\t\ttarget[i] = deepCopy(source[i], null, derivativeMap)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (!target || typeof target !== 'object') {\r\n\t\t\t\t\ttarget = derivativeMap && derivativeMap.get(source)\r\n\t\t\t\t\tif (!target) {\r\n\t\t\t\t\t\ttarget = {}\r\n\t\t\t\t\t\tderivativeMap && derivativeMap.set(source, target)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i in source) {\r\n\t\t\t\t\ttarget[i] = deepCopy(source[i], target[i], derivativeMap)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn target\r\n\t\t}\r\n\t\treturn source\r\n\t}\r\n\r\n\tvar Copy = lang.compose(Variable, function(copiedFrom) {\r\n\t\t// this is the variable that we derive from\r\n\t\tthis.copiedFrom = copiedFrom\r\n\t\tthis.derivativeMap = new lang.WeakMap(null, 'derivative')\r\n\t\tthis.isDirty = new Variable(false)\r\n\t}, {\r\n\t\tgetValue: function(sync, forModification, forChild) {\r\n\t\t\tif(this.state) {\r\n\t\t\t\tthis.state = null\r\n\t\t\t}\r\n\t\t\tvar value = this.copiedFrom.valueOf()\r\n\t\t\tif(value && typeof value == 'object') {\r\n\t\t\t\tvar derivative = this.derivativeMap.get(value)\r\n\t\t\t\tif (derivative == null) {\r\n\t\t\t\t\tthis.derivativeMap.set(value, derivative = deepCopy(value, undefined, this.derivativeMap))\r\n\t\t\t\t\tthis.value = derivative\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(this.value === undefined) {\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t\treturn Variable.prototype.getValue.call(this, sync, forModification, forChild)\r\n\t\t},\r\n\t\tgetCopyOf: function(value) {\r\n\t\t\tvar derivative = this.derivativeMap.get(value)\r\n\t\t\tif (derivative == null) {\r\n\t\t\t\tthis.derivativeMap.set(value, derivative = deepCopy(value, undefined, this.derivativeMap))\r\n\t\t\t}\r\n\t\t\treturn derivative\r\n\t\t},\r\n\t\tsave: function() {\r\n\t\t\t// copy back to the original object\r\n\t\t\tif (this.copiedFrom.put) { // copiedFrom doesn't have to be a variable, it can be a plain object\r\n\t\t\t\t// just assign it now\r\n\t\t\t\tthis.copiedFrom.put(this.valueOf())\r\n\t\t\t} else {\r\n\t\t\t\t// copy back into the original object\r\n\t\t\t\tvar original = this.copiedFrom.valueOf()\r\n\t\t\t\tvar newCopiedFrom = deepCopy(this.valueOf(), original)\r\n\t\t\t}\r\n\t\t\tthis.isDirty.put(false)\r\n\t\t\tthis.onSave && this.onSave()\r\n\t\t},\r\n\t\trevert: function() {\r\n\t\t\tvar original = this.copiedFrom.valueOf()\r\n\t\t\tthis.derivativeMap = new lang.WeakMap(null, 'derivative') // clear out the mapping, so we can start fresh\r\n\t\t\tthis.put(deepCopy(original, undefined, this.derivativeMap))\r\n\t\t\tthis.isDirty.put(false)\r\n\t\t},\r\n\t\tupdated: function() {\r\n\t\t\tthis.isDirty.put(true)\r\n\t\t\treturn Variable.prototype.updated.apply(this, arguments)\r\n\t\t}\r\n\t})\r\n\treturn Copy\r\n}))\r\n","(function (root, factory) { if (typeof define === 'function' && define.amd) {\r\n\tdefine(['./lang', '../Variable'], factory) } else if (typeof module === 'object' && module.exports) {\r\n  module.exports = factory(require('./lang'), require('../Variable')) // Node\r\n}}(this, function (lang, VariableExports) {\r\n\r\nvar Promise = (typeof global != 'undefined' ? global : window).Promise\r\nfunction ContextualPromise(executor) {\r\n\tthis.context = VariableExports.currentContext\r\n\tthis.promise = new Promise(executor)\r\n}\r\nlang.copy(ContextualPromise.prototype, {\r\n\tthen: function(onFulfilled, onRejected) {\r\n\t\tvar context = this.context\r\n\t\tvar promise = this.promise\r\n\t\tif (context && promise.notifies) {\r\n\t\t\tvar contextualPromise = this\r\n\t\t\treturn context.executeWithin(function() {\r\n\t\t\t\treturn new ContextualPromiseFromPromise(promise.then(\r\n\t\t\t\t\tgetExecutor(onFulfilled, context),\r\n\t\t\t\t\tgetExecutor(onRejected, context)\r\n\t\t\t\t), context, contextualPromise)\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn new ContextualPromiseFromPromise(promise.then(\r\n\t\t\tgetExecutor(onFulfilled, context),\r\n\t\t\tgetExecutor(onRejected, context)\r\n\t\t), context, this)\r\n\t},\r\n\t'catch': function(onRejected) {\r\n\t\tvar context = this.context\r\n\t\treturn new ContextualPromiseFromPromise(this.promise.catch(\r\n\t\t\tgetExecutor(onRejected, context)\r\n\t\t), context, this)\r\n\t},\r\n\t'finally': function(onResolved) {\r\n\t\tvar context = this.context\r\n\t\treturn new ContextualPromiseFromPromise(this.promise.finally(\r\n\t\t\tgetExecutor(onResolved, context)\r\n\t\t), context, this)\r\n\t},\r\n\tisContextual: true\r\n})\r\n\r\nfunction getExecutor(executor, context) {\r\n\tif (executor && context) {\r\n\t\treturn function(value) {\r\n\t\t\treturn context.executeWithin(function() {\r\n\t\t\t\tvar result = executor(value)\r\n\t\t\t\tif (result && result.then) {\r\n\t\t\t\t\treturn new ContextualPromiseFromPromise(result, context)\r\n\t\t\t\t}\r\n\t\t\t\treturn result\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\treturn executor\r\n}\r\nContextualPromise.resolve = function(value) {\r\n\tvar promise = (value && value.then) ? value : Promise.resolve(value)\r\n\treturn new ContextualPromiseFromPromise(promise, VariableExports.currentContext)\r\n}\r\nContextualPromise.reject = function(value) {\r\n\tvar promise = Promise.reject(value)\r\n\treturn new ContextualPromiseFromPromise(promise, VariableExports.currentContext)\r\n}\r\nContextualPromise.all = function(promises) {\r\n\tvar startedPromises = startPromises(promises)\r\n\tvar promise = new ContextualPromiseFromPromise(Promise.all(startedPromises), VariableExports.currentContext)\r\n\tif (startedPromises.assignAbort) {\r\n\t\tstartedPromises.assignAbort(promise)\r\n\t}\r\n\treturn promise\r\n}\r\nContextualPromise.race = function(promises) {\r\n\tvar startedPromises = startPromises(promises)\r\n\tvar promise = new ContextualPromiseFromPromise(Promise.race(startedPromises), VariableExports.currentContext)\r\n\tif (startedPromises.assignAbort) {\r\n\t\tstartedPromises.assignAbort(promise)\r\n\t}\r\n\treturn promise\r\n}\r\nfunction startPromises(promises) {\r\n\tvar contextualizedPromises = new Array(promises.length)\r\n\tvar hasAbort = ContextualPromise.propagateAbort\r\n\tfor (var i = 0, l = promises.length; i < l; i++) {\r\n\t\tvar value = promises[i]\r\n\t\tif (value && value.then) {\r\n\t\t\tif (value.notifies)\r\n\t\t\t\tvalue = value.then() // execute then immediately (still using the current context)\r\n\t\t\tif (!value.abort) {\r\n\t\t\t\thasAbort = false\r\n\t\t\t}\r\n\t\t}\r\n\t\tcontextualizedPromises[i] = value\r\n\t}\r\n\tif (hasAbort) {\r\n\t\tcontextualizedPromises.assignAbort = function(promise) {\r\n\t\t\tpromise.abort = function(message) {\r\n\t\t\t\tfor (var i = 0, l = promises.length; i < l; i++) {\r\n\t\t\t\t\tvar promise = promises[i]\r\n\t\t\t\t\tif (promise && promise.abort) {\r\n\t\t\t\t\t\tpromise.abort(message)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn contextualizedPromises\r\n}\r\nfunction ContextualPromiseFromPromise(promise, context, originalPromise) {\r\n\tthis.context = context\r\n\tthis.promise = promise\r\n\tif (ContextualPromise.propagateAbort && (originalPromise || promise).abort) {\r\n\t\tthis.abort = (originalPromise || promise).abort\r\n\t}\r\n}\r\nContextualPromiseFromPromise.prototype = ContextualPromise.prototype\r\nreturn ContextualPromise\r\n}))\r\n"],"sourceRoot":""}